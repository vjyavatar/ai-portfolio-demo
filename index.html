<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO -->
    <title>AI Stock Analysis | Real-Time Investment Research with Agentic AI</title>
    <meta name="description" content="Professional AI-powered stock analysis with real-time market data. Get actionable investment recommendations with entry/exit strategies for any stock worldwide.">
    <meta name="keywords" content="stock analysis, agentic AI, investment research, stock recommendations, entry exit strategy">
    <meta name="robots" content="index, follow">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
            color: #1f2937;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo { font-size: 22px; font-weight: 900; }
        
        .hero {
            background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            color: white;
            padding: 50px 20px;
            text-align: center;
        }
        .hero h1 {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .hero-subtitle { font-size: 20px; margin-bottom: 15px; font-weight: 600; }
        .badge {
            background: #10b981;
            padding: 10px 25px;
            border-radius: 25px;
            display: inline-block;
            margin: 12px 8px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(16,185,129,0.3);
        }
        
        .main-content {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .input-card {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 140px;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .input-wrapper { position: relative; }
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
        }
        input:focus { outline: none; border-color: #4338ca; box-shadow: 0 0 0 3px rgba(67,56,202,0.1); }
        
        .autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #4338ca;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 320px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .autocomplete.show { display: block; }
        .autocomplete-item {
            padding: 13px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.2s;
        }
        .autocomplete-item:hover { background: #f0f9ff; transform: translateX(5px); }
        .ticker-code {
            font-weight: 700;
            color: #4338ca;
            margin-right: 10px;
            font-size: 15px;
        }
        .company-name {
            color: #6b7280;
            font-size: 14px;
        }
        
        .helper-text {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            border: 2px solid #818cf8;
            border-radius: 10px;
            padding: 14px;
            font-size: 13px;
            color: #3730a3;
            line-height: 1.7;
            font-weight: 500;
        }
        .helper-text strong { color: #1e3a8a; }
        .helper-text a { color: #4338ca; text-decoration: underline; }
        
        .btn {
            padding: 15px;
            background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(67,56,202,0.3);
        }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(67,56,202,0.4); }
        .btn:disabled { opacity: 0.6; }
        
        .status {
            margin-top: 15px;
            padding: 14px;
            border-radius: 10px;
            display: none;
            font-weight: 600;
        }
        .status.show { display: block; }
        .status.info { background: #dbeafe; color: #1e40af; border: 2px solid #3b82f6; }
        .status.success { background: #d1fae5; color: #065f46; border: 2px solid #10b981; }
        .status.error { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        
        .rate-limit-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px 24px;
            margin-top: 15px;
            text-align: center;
        }
        .rate-limit-box .rl-title {
            font-size: 16px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 10px;
        }
        .rate-limit-box .rl-countdown {
            font-size: 36px;
            font-weight: 900;
            color: #d97706;
            font-family: 'Inter', monospace;
            letter-spacing: 2px;
            margin: 8px 0;
        }
        .rate-limit-box .rl-comeback {
            font-size: 14px;
            color: #78350f;
            font-weight: 600;
        }
        .rate-limit-box .rl-progress {
            width: 100%;
            height: 6px;
            background: #fde68a;
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }
        .rate-limit-box .rl-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #10b981);
            border-radius: 3px;
            transition: width 1s linear;
        }
        
        .report {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 30px;
            animation: slideIn 0.5s ease;
        }
        .report.show { display: block; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .report-header {
            background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            color: white;
            padding: 35px;
            text-align: center;
        }
        .report-header h2 { font-size: 32px; margin: 10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            border-bottom: 3px solid #e5e7eb;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        }
        .metric {
            padding: 25px;
            text-align: center;
            border-right: 2px solid #e5e7eb;
            transition: all 0.3s;
        }
        .metric:hover { background: white; transform: translateY(-3px); }
        .metric:last-child { border-right: none; }
        .metric-label {
            font-size: 11px;
            color: #6b7280;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        .metric-value {
            font-size: 26px;
            font-weight: 900;
            color: #4338ca;
            margin-bottom: 5px;
        }
        .metric-sub {
            font-size: 14px;
            font-weight: 700;
            margin-top: 5px;
        }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 30px;
            background: #fafafa;
        }
        .chart-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }
        .chart-box:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.12); transform: translateY(-5px); }
        .chart-title {
            font-size: 17px;
            font-weight: 700;
            color: #4338ca;
            margin-bottom: 18px;
        }
        .chart-container { height: 220px; }
        
        .analysis-container { padding: 35px; }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            border-left: 6px solid;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }
        .section:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.1); transform: translateX(5px); }
        
        .section.decision { border-color: #f59e0b; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .section.quick-verdict { border-color: #10b981; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
        .section.valuation { border-color: #3b82f6; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .section.entry-exit { border-color: #8b5cf6; background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%); }
        .section.risk { border-color: #ef4444; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
        .section.small-caps { border-color: #f97316; background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%); }
        
        .section h3 {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section.decision h3 { color: #92400e; }
        .section.quick-verdict h3 { color: #065f46; }
        .section.valuation h3 { color: #1e40af; }
        .section.entry-exit h3 { color: #6b21a8; }
        .section.risk h3 { color: #991b1b; }
        .section.small-caps h3 { color: #c2410c; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 18px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        th {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        td {
            padding: 15px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 15px;
        }
        tr:hover { background: #f9fafb; }
        tr:last-child td { border-bottom: none; }
        
        .verdict-box {
            background: white;
            border: 3px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }
        .verdict-badge {
            display: inline-block;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        .verdict-badge.buy { background: #10b981; color: white; }
        .verdict-badge.hold { background: #f59e0b; color: white; }
        .verdict-badge.sell { background: #ef4444; color: white; }
        
        .decision-list {
            list-style: none;
            padding: 0;
        }
        .decision-list li {
            padding: 12px 0;
            padding-left: 35px;
            position: relative;
            font-weight: 600;
            font-size: 15px;
            line-height: 1.7;
        }
        .decision.section .decision-list li { color: #78350f; }
        .decision-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            font-weight: 900;
            font-size: 20px;
            width: 25px;
            height: 25px;
            background: #10b981;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .price-action {
            font-size: 16px;
            font-weight: 700;
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }
        .price-action.buy-zone { background: #d1fae5; color: #065f46; border: 2px solid #10b981; }
        .price-action.current { background: #e0e7ff; color: #3730a3; border: 2px solid #6366f1; }
        .price-action.profit-zone { background: #fef3c7; color: #92400e; border: 2px solid #f59e0b; }
        .price-action.stop-loss { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        
        .footer {
            background: #1f2937;
            color: white;
            padding: 40px 20px;
            margin-top: auto;
        }
        .disclaimer-box {
            background: rgba(251, 191, 36, 0.15);
            border: 3px solid #fbbf24;
            border-radius: 15px;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .disclaimer-box h3 { color: #fbbf24; margin-bottom: 15px; font-size: 20px; }
        .disclaimer-box p { color: #e5e7eb; line-height: 1.9; margin-bottom: 12px; }
        
        @media (max-width: 768px) {
            .input-grid { grid-template-columns: 1fr; }
            .metrics { grid-template-columns: repeat(2, 1fr); }
            .metric { border-right: none; border-bottom: 2px solid #e5e7eb; }
            .charts-row { grid-template-columns: 1fr; }
            .hero h1 { font-size: 32px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">‚ö° SENTINEL AI RESEARCH</div>
    </div>
    
    <div class="hero">
        <h1><span>ü§ñ</span> Agentic AI Investment Intelligence</h1>
        <div class="hero-subtitle">Advanced Autonomous Analysis with Real-Time Market Data</div>
        <div>
            <span class="badge">üî¥ LIVE MARKET DATA</span>
            <span class="badge">ü§ñ AGENTIC AI</span>
            <span class="badge">üìä ACTIONABLE INSIGHTS</span>
        </div>
    </div>
    
    <div class="main-content">
        <div class="input-card">
            <h2 style="margin-bottom: 10px; color: #4338ca; font-size: 24px;">Generate AI-Powered Analysis Report</h2>
            <p style="color: #6b7280; margin-bottom: 22px; font-size: 15px;">Get comprehensive investment research with actionable recommendations</p>
            
            <div class="input-grid">
                <input type="email" id="email" placeholder="Your email address">
                
                <div class="input-wrapper">
                    <input type="text" id="ticker" placeholder="Start typing ticker or company..." autocomplete="off">
                    <div class="autocomplete" id="autocomplete"></div>
                </div>
                
                <button class="btn" id="btn" onclick="analyze()">Analyze</button>
            </div>
            
            <div class="helper-text">
                üí° <strong>Start typing</strong> to see top 100 stocks (US & India) ‚Ä¢ <strong>Don't see your stock?</strong> 
                Enter any valid ticker symbol (find on <a href="https://finance.yahoo.com" target="_blank">Yahoo Finance</a>)
                <br>üìä <strong>Free usage:</strong> Up to 5 reports per email per hour
            </div>
            
            <div class="status" id="status"></div>
            <div class="rate-limit-box" id="rateLimitBox" style="display:none;">
                <div class="rl-title">‚è≥ Report limit reached for this email</div>
                <div class="rl-countdown" id="rlCountdown">--:--</div>
                <div class="rl-comeback" id="rlComeback"></div>
                <div class="rl-progress"><div class="rl-progress-bar" id="rlProgress" style="width:0%"></div></div>
            </div>
        </div>
        
        <div class="report" id="report">
            <div class="report-header">
                <div style="background: rgba(255,255,255,0.2); padding: 8px 22px; border-radius: 20px; display: inline-block; margin-bottom: 12px; font-weight: 700; font-size: 15px;" id="tickerTag"></div>
                <h2 id="companyName"></h2>
                <div style="background: #10b981; padding: 10px 25px; border-radius: 25px; display: inline-block; margin-top: 12px; font-size: 14px; font-weight: 700; box-shadow: 0 4px 12px rgba(16,185,129,0.3);" id="timestamp"></div>
            </div>
            
            <div class="metrics" id="metrics"></div>
            
            <div class="charts-row">
                <div class="chart-box">
                    <div class="chart-title">üìä Valuation Metrics Overview</div>
                    <div class="chart-container"><canvas id="valChart"></canvas></div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">üìà Price Performance Trend</div>
                    <div class="chart-container"><canvas id="trendChart"></canvas></div>
                </div>
            </div>
            
            <div class="analysis-container" id="analysisContainer"></div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="disclaimer-box">
            <h3>‚ö†Ô∏è Important Legal Disclaimers</h3>
            <p>
                <strong>NOT FINANCIAL ADVICE:</strong> This analysis is for educational and informational purposes only. 
                It does not constitute financial, investment, or trading advice. Always consult with licensed financial professionals before making investment decisions.
            </p>
            <p>
                <strong>DATA ACCURACY:</strong> While we use real-time market data from reliable sources, we cannot guarantee 100% accuracy. 
                Market conditions change rapidly. Always verify information through multiple sources before acting.
            </p>
            <p>
                <strong>RISK WARNING:</strong> All investments carry risk of loss. Past performance does not guarantee future results. 
                You may lose some or all of your investment. This platform is for research and educational purposes only.
            </p>
        </div>
        <div style="text-align: center; color: #9ca3af; margin-top: 25px; font-size: 14px;">
            ¬© 2026 Sentinel AI Research | Agentic AI Investment Platform | Educational Tool
        </div>
    </footer>
    
    <script>
        // TOP 100 STOCKS (50 US + 50 India)
        const stocks = [
            // TOP 50 US STOCKS
            {t:'AAPL',n:'Apple Inc.'},{t:'MSFT',n:'Microsoft Corporation'},{t:'GOOGL',n:'Alphabet Inc. (Google)'},{t:'AMZN',n:'Amazon.com Inc.'},
            {t:'NVDA',n:'NVIDIA Corporation'},{t:'META',n:'Meta Platforms (Facebook)'},{t:'TSLA',n:'Tesla Inc.'},{t:'BRK.B',n:'Berkshire Hathaway'},
            {t:'LLY',n:'Eli Lilly and Company'},{t:'AVGO',n:'Broadcom Inc.'},{t:'JPM',n:'JPMorgan Chase & Co.'},{t:'V',n:'Visa Inc.'},
            {t:'UNH',n:'UnitedHealth Group'},{t:'XOM',n:'Exxon Mobil'},{t:'WMT',n:'Walmart Inc.'},{t:'MA',n:'Mastercard Inc.'},
            {t:'PG',n:'Procter & Gamble'},{t:'JNJ',n:'Johnson & Johnson'},{t:'HD',n:'Home Depot'},{t:'ORCL',n:'Oracle Corporation'},
            {t:'COST',n:'Costco Wholesale'},{t:'NFLX',n:'Netflix Inc.'},{t:'BAC',n:'Bank of America'},{t:'CRM',n:'Salesforce Inc.'},
            {t:'ABBV',n:'AbbVie Inc.'},{t:'CVX',n:'Chevron Corporation'},{t:'AMD',n:'Advanced Micro Devices'},{t:'KO',n:'Coca-Cola Company'},
            {t:'PEP',n:'PepsiCo Inc.'},{t:'MRK',n:'Merck & Co.'},{t:'ADBE',n:'Adobe Inc.'},{t:'TMO',n:'Thermo Fisher Scientific'},
            {t:'CSCO',n:'Cisco Systems'},{t:'ACN',n:'Accenture'},{t:'MCD',n:"McDonald's Corporation"},{t:'LIN',n:'Linde plc'},
            {t:'ABT',n:'Abbott Laboratories'},{t:'WFC',n:'Wells Fargo'},{t:'TXN',n:'Texas Instruments'},{t:'INTC',n:'Intel Corporation'},
            {t:'DIS',n:'Walt Disney Company'},{t:'PM',n:'Philip Morris'},{t:'CMCSA',n:'Comcast Corporation'},{t:'NKE',n:'Nike Inc.'},
            {t:'QCOM',n:'Qualcomm Inc.'},{t:'GE',n:'General Electric'},{t:'INTU',n:'Intuit Inc.'},{t:'VZ',n:'Verizon Communications'},
            {t:'AMAT',n:'Applied Materials'},{t:'CAT',n:'Caterpillar Inc.'},
            
            // TOP 50 INDIAN STOCKS
            {t:'RELIANCE.NS',n:'Reliance Industries'},{t:'TCS.NS',n:'Tata Consultancy Services'},{t:'HDFCBANK.NS',n:'HDFC Bank'},
            {t:'INFY',n:'Infosys Limited'},{t:'HINDUNILVR.NS',n:'Hindustan Unilever'},{t:'ICICIBANK.NS',n:'ICICI Bank'},
            {t:'SBIN.NS',n:'State Bank of India'},{t:'BHARTIARTL.NS',n:'Bharti Airtel'},{t:'ITC.NS',n:'ITC Limited'},
            {t:'KOTAKBANK.NS',n:'Kotak Mahindra Bank'},{t:'LT.NS',n:'Larsen & Toubro'},{t:'AXISBANK.NS',n:'Axis Bank'},
            {t:'BAJFINANCE.NS',n:'Bajaj Finance'},{t:'ASIANPAINT.NS',n:'Asian Paints'},{t:'MARUTI.NS',n:'Maruti Suzuki'},
            {t:'TITAN.NS',n:'Titan Company'},{t:'SUNPHARMA.NS',n:'Sun Pharmaceutical'},{t:'ULTRACEMCO.NS',n:'UltraTech Cement'},
            {t:'NESTLEIND.NS',n:'Nestl√© India'},{t:'ONGC.NS',n:'Oil & Natural Gas Corp'},{t:'NTPC.NS',n:'NTPC Limited'},
            {t:'TATAMOTORS.NS',n:'Tata Motors'},{t:'POWERGRID.NS',n:'Power Grid Corporation'},{t:'TATASTEEL.NS',n:'Tata Steel'},
            {t:'M&M.NS',n:'Mahindra & Mahindra'},{t:'JSWSTEEL.NS',n:'JSW Steel'},{t:'ADANIENT.NS',n:'Adani Enterprises'},
            {t:'WIPRO.NS',n:'Wipro Limited'},{t:'COALINDIA.NS',n:'Coal India'},{t:'HCLTECH.NS',n:'HCL Technologies'},
            {t:'BAJAJFINSV.NS',n:'Bajaj Finserv'},{t:'DIVISLAB.NS',n:'Divi\'s Laboratories'},{t:'GRASIM.NS',n:'Grasim Industries'},
            {t:'TECHM.NS',n:'Tech Mahindra'},{t:'BRITANNIA.NS',n:'Britannia Industries'},{t:'EICHERMOT.NS',n:'Eicher Motors'},
            {t:'APOLLOHOSP.NS',n:'Apollo Hospitals'},{t:'INDUSINDBK.NS',n:'IndusInd Bank'},{t:'TRENT.NS',n:'Trent Limited'},
            {t:'ADANIPORTS.NS',n:'Adani Ports'},{t:'HINDALCO.NS',n:'Hindalco Industries'},{t:'DRREDDY.NS',n:'Dr. Reddy\'s Labs'},
            {t:'CIPLA.NS',n:'Cipla Limited'},{t:'HEROMOTOCO.NS',n:'Hero MotoCorp'},{t:'SHREECEM.NS',n:'Shree Cement'},
            {t:'BAJAJ-AUTO.NS',n:'Bajaj Auto'},{t:'BPCL.NS',n:'Bharat Petroleum'},{t:'SIEMENS.NS',n:'Siemens India'},
            {t:'KPIT.NS',n:'KPIT Technologies'},{t:'DIXON.NS',n:'Dixon Technologies'}
        ];
        
        let valChart, trendChart;
        
        // Autocomplete
        const tickerInput = document.getElementById('ticker');
        const autocompleteDiv = document.getElementById('autocomplete');
        
        tickerInput.addEventListener('input', function() {
            const val = this.value.trim().toUpperCase();
            autocompleteDiv.innerHTML = '';
            
            if (!val) {
                autocompleteDiv.classList.remove('show');
                return;
            }
            
            const matches = stocks.filter(s => 
                s.t.includes(val) || s.n.toUpperCase().includes(val)
            ).slice(0, 12);
            
            if (!matches.length) {
                autocompleteDiv.classList.remove('show');
                return;
            }
            
            matches.forEach(s => {
                const div = document.createElement('div');
                div.className = 'autocomplete-item';
                div.innerHTML = `<span class="ticker-code">${s.t}</span><span class="company-name">${s.n}</span>`;
                div.onclick = () => {
                    tickerInput.value = s.t;
                    autocompleteDiv.classList.remove('show');
                };
                autocompleteDiv.appendChild(div);
            });
            
            autocompleteDiv.classList.add('show');
        });
        
        document.addEventListener('click', e => {
            if (e.target !== tickerInput) autocompleteDiv.classList.remove('show');
        });
        
        function showStatus(msg, type) {
            const s = document.getElementById('status');
            s.textContent = msg;
            s.className = 'status show ' + type;
        }
        
        let countdownInterval = null;
        
        function hideRateLimitBox() {
            document.getElementById('rateLimitBox').style.display = 'none';
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }
        
        function showRateLimitCountdown(data) {
            const box = document.getElementById('rateLimitBox');
            const countdownEl = document.getElementById('rlCountdown');
            const comebackEl = document.getElementById('rlComeback');
            const progressEl = document.getElementById('rlProgress');
            
            // Calculate target time
            let totalSeconds = data.retry_after_seconds || (data.retry_after_minutes || 5) * 60;
            const targetTime = new Date(Date.now() + totalSeconds * 1000);
            const comebackTimeStr = targetTime.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
            
            comebackEl.textContent = 'üïê Come back at ' + comebackTimeStr + ' ‚Ä¢ You\'ll get ' + (data.requests_limit || 5) + ' fresh reports';
            box.style.display = 'block';
            
            // Clear any existing countdown
            if (countdownInterval) clearInterval(countdownInterval);
            
            const startSeconds = totalSeconds;
            
            function tick() {
                const now = Date.now();
                const remaining = Math.max(0, Math.floor((targetTime - now) / 1000));
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                
                countdownEl.textContent = String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
                
                // Progress bar (fills up as time passes)
                const elapsed = startSeconds - remaining;
                const pct = Math.min(100, (elapsed / startSeconds) * 100);
                progressEl.style.width = pct + '%';
                
                if (remaining <= 0) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                    countdownEl.textContent = '00:00';
                    comebackEl.textContent = '‚úÖ You can generate reports again! Enter a ticker above.';
                    progressEl.style.width = '100%';
                    box.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
                    box.style.borderColor = '#10b981';
                    document.querySelector('.rl-title').textContent = 'üéâ Your quota has been refreshed!';
                    countdownEl.style.color = '#10b981';
                }
            }
            
            tick(); // run immediately
            countdownInterval = setInterval(tick, 1000);
        }
        
        async function analyze() {
            const email = document.getElementById('email').value.trim();
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            const btn = document.getElementById('btn');
            const report = document.getElementById('report');
            
            autocompleteDiv.classList.remove('show');
            
            if (!email || !ticker) {
                showStatus('‚ö†Ô∏è Please fill in both email and ticker fields', 'error');
                return;
            }
            
            // Validate email format
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showStatus('‚ö†Ô∏è Please enter a valid email address', 'error');
                return;
            }
            
            // Pre-check rate limit before heavy API call
            try {
                const rlCheck = await fetch('/api/check-rate-limit', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email: email})
                });
                const rlData = await rlCheck.json();
                if (!rlData.allowed) {
                    showStatus('‚è≥ ' + rlData.reason, 'error');
                    showRateLimitCountdown(rlData);
                    return;
                } else {
                    hideRateLimitBox();
                }
            } catch(e) { /* fail open */ }
            
            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            report.classList.remove('show');
            hideRateLimitBox();
            
            showStatus('ü§ñ Agentic AI analyzing ' + ticker + ' with real-time data... (30-60 seconds)', 'info');
            
            try {
                const res = await fetch('/api/generate-report', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({company_name: ticker, email: email})
                });
                
                if (res.status === 429) {
                    const rlData = await res.json().catch(() => ({}));
                    showStatus('‚è≥ ' + (rlData.reason || rlData.detail || 'Too many requests.'), 'error');
                    if (rlData.retry_after_seconds || rlData.retry_after_minutes) {
                        showRateLimitCountdown(rlData);
                    }
                    return;
                }
                
                if (res.status === 503 || res.status === 504) {
                    const err = await res.json().catch(() => ({}));
                    showStatus('‚è≥ ' + (err.detail || 'Service temporarily busy. Please try again in 30 seconds.'), 'error');
                    return;
                }
                
                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    const errorMsg = err.detail || err.message || err.error || 'Unknown error - check browser console';
                    throw new Error(errorMsg);
                }
                
                const data = await res.json();
                if (!data.success || !data.live_data) throw new Error('No data available for this ticker');
                
                // Show success with remaining quota info
                let quotaMsg = '';
                if (data.rate_limit) {
                    const r = data.rate_limit.remaining;
                    if (r === 0) {
                        quotaMsg = ' ‚ö†Ô∏è This was your last free report this hour.';
                    } else {
                        quotaMsg = ` (${r} report${r !== 1 ? 's' : ''} remaining this hour)`;
                    }
                }
                showStatus('‚úÖ Analysis complete! Scroll down for detailed insights.' + quotaMsg, 'success');
                displayReport(data);
                
                document.getElementById('ticker').value = '';
                
            } catch (error) {
                let msg = error.message;
                if (msg === 'Failed to fetch') {
                    msg = 'Could not connect to server. Please check if the service is running.';
                } else if (msg.toLowerCase().includes('rate limit') || msg.toLowerCase().includes('too many') || msg.toLowerCase().includes('temporarily')) {
                    msg = '‚è≥ Market data provider is temporarily busy due to high traffic. Please wait 2-3 minutes and try again.';
                }
                showStatus('‚ùå ' + msg, 'error');
                console.error('Analysis error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Analyze';
            }
        }
        
        function displayReport(data) {
            const d = data.live_data;
            const curr = d.currency === 'INR' ? '‚Çπ' : '$';
            const price = d.current_price;
            
            document.getElementById('tickerTag').textContent = d.ticker;
            document.getElementById('companyName').textContent = d.company_name || d.ticker;
            document.getElementById('timestamp').textContent = 'üî¥ LIVE ‚Ä¢ ' + d.data_timestamp;
            
            // Metrics
            document.getElementById('metrics').innerHTML = `
                <div class="metric">
                    <div class="metric-label">Current Price</div>
                    <div class="metric-value">${curr}${price.toLocaleString()}</div>
                    <div class="metric-sub ${d.price_change >= 0 ? 'positive' : 'negative'}">
                        ${d.price_change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(d.price_change).toFixed(2)} (${d.price_change_pct.toFixed(2)}%)
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-label">P/E Ratio</div>
                    <div class="metric-value">${d.pe_ratio || 'N/A'}</div>
                    <div class="metric-sub" style="color:#6b7280;">Trailing TTM</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Market Cap</div>
                    <div class="metric-value">${formatCap(d.market_cap)}</div>
                    <div class="metric-sub" style="color:#6b7280;">${d.currency}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">52-Week Range</div>
                    <div class="metric-value" style="font-size:18px;">${d.week52_low}-${d.week52_high}</div>
                    <div class="metric-sub" style="color:#6b7280;">High / Low</div>
                </div>
            `;
            
            createCharts(d);
            createAnalysisSections(data.report, d);
            
            document.getElementById('report').classList.add('show');
            setTimeout(() => {
                document.getElementById('report').scrollIntoView({behavior: 'smooth', block: 'start'});
            }, 150);
        }
        
        function createAnalysisSections(report, d) {
            const curr = d.currency === 'INR' ? '‚Çπ' : '$';
            const price = d.current_price;
            const peRatio = parseFloat(d.pe_ratio) || 0;
            
            // Determine verdict
            let verdict = 'HOLD';
            let verdictClass = 'hold';
            if (peRatio > 0 && peRatio < 15 && d.price_change_pct > 0) {
                verdict = 'BUY';
                verdictClass = 'buy';
            } else if (peRatio > 40 || d.price_change_pct < -5) {
                verdict = 'SELL';
                verdictClass = 'sell';
            }
            
            const html = `
                <div class="section quick-verdict">
                    <h3>üéØ QUICK INVESTMENT VERDICT</h3>
                    <div class="verdict-box">
                        <div class="verdict-badge ${verdictClass}">${verdict}</div>
                        <div style="color:#065f46; font-weight:600; font-size:15px;">
                            ${verdict === 'BUY' ? 'Favorable investment opportunity identified' : 
                              verdict === 'SELL' ? 'Exercise caution - consider exit strategy' : 
                              'Hold position - monitor market conditions'}
                        </div>
                    </div>
                </div>
                
                <div class="section decision">
                    <h3>‚úì KEY DECISION POINTS</h3>
                    <ul class="decision-list">
                        <li><strong>Price Action:</strong> Currently ${curr}${price.toLocaleString()} with ${d.price_change >= 0 ? 'positive' : 'negative'} daily momentum (${d.price_change_pct.toFixed(2)}%)</li>
                        <li><strong>Valuation Assessment:</strong> P/E ratio of ${d.pe_ratio} suggests ${peRatio < 15 ? 'undervalued opportunity' : peRatio < 25 ? 'fair valuation' : 'premium pricing'}</li>
                        <li><strong>Market Position:</strong> ${formatCap(d.market_cap)} market cap - classified as ${d.market_cap > 100e9 ? 'large-cap' : d.market_cap > 10e9 ? 'mid-cap' : 'small-cap'} stock</li>
                        <li><strong>Sector Exposure:</strong> ${d.sector} sector, ${d.industry} industry</li>
                        <li><strong>Price Range:</strong> Trading ${((price/d.week52_high)*100).toFixed(0)}% from 52-week high</li>
                    </ul>
                </div>
                
                <div class="section valuation">
                    <h3>üí∞ LIVE VALUATION ANALYSIS</h3>
                    <p style="margin-bottom:18px; font-weight:600; color:#065f46;">
                        Understanding if you're paying a fair price for this stock (Updated in real-time):
                    </p>
                    <table>
                        <tr style="background:linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);">
                            <th style="border-bottom:3px solid #10b981;">Metric</th>
                            <th style="border-bottom:3px solid #10b981;">Current Value</th>
                            <th style="border-bottom:3px solid #10b981;">What This Number Means</th>
                        </tr>
                        <tr>
                            <td><strong>üìä P/E Ratio</strong><br><span style="font-size:12px; color:#6b7280;">Price-to-Earnings</span></td>
                            <td style="font-size:20px; font-weight:900; color:${parseFloat(d.pe_ratio) < 15 ? '#10b981' : parseFloat(d.pe_ratio) < 25 ? '#f59e0b' : '#ef4444'};">${d.pe_ratio}</td>
                            <td style="line-height:1.8;">
                                ${parseFloat(d.pe_ratio) < 15 ? 
                                    '<strong style="color:#10b981;">üü¢ UNDERVALUED:</strong> You pay less than $15 for every $1 of earnings. This could be a bargain!' : 
                                  parseFloat(d.pe_ratio) < 25 ? 
                                    '<strong style="color:#f59e0b;">üü° FAIR VALUE:</strong> You pay $15-25 for every $1 of earnings. Reasonably priced.' : 
                                    '<strong style="color:#ef4444;">üî¥ EXPENSIVE:</strong> You pay $' + d.pe_ratio + ' for every $1 of earnings. Make sure growth justifies this premium!'
                                }
                            </td>
                        </tr>
                        <tr style="background:#f9fafb;">
                            <td><strong>üìà P/B Ratio</strong><br><span style="font-size:12px; color:#6b7280;">Price-to-Book</span></td>
                            <td style="font-size:20px; font-weight:900; color:#4338ca;">${d.pb_ratio}</td>
                            <td style="line-height:1.8;">
                                ${parseFloat(d.pb_ratio) < 3 ? 
                                    '<strong>Reasonable Asset Valuation:</strong> Stock is trading at ' + d.pb_ratio + 'x its book value. The company\'s assets back up most of the stock price.' :
                                    '<strong>Premium to Assets:</strong> Stock trades at ' + d.pb_ratio + 'x book value. Investors are paying for intangibles like brand and growth potential.'
                                }
                            </td>
                        </tr>
                        <tr>
                            <td><strong>üíµ Profit Margin</strong><br><span style="font-size:12px; color:#6b7280;">How much profit per dollar</span></td>
                            <td style="font-size:20px; font-weight:900; color:${parseFloat(d.profit_margin) > 15 ? '#10b981' : parseFloat(d.profit_margin) > 8 ? '#f59e0b' : '#ef4444'};">${d.profit_margin}%</td>
                            <td style="line-height:1.8;">
                                ${parseFloat(d.profit_margin) > 15 ? 
                                    '<strong style="color:#10b981;">üü¢ EXCELLENT:</strong> Company keeps $' + d.profit_margin + ' profit from every $100 in sales. Strong pricing power!' :
                                  parseFloat(d.profit_margin) > 8 ?
                                    '<strong style="color:#f59e0b;">üü° MODERATE:</strong> Company keeps $' + d.profit_margin + ' profit per $100 sales. Decent but could improve.' :
                                    '<strong style="color:#ef4444;">üî¥ THIN:</strong> Only $' + d.profit_margin + ' profit per $100 sales. Intense competition or high costs.'
                                }
                            </td>
                        </tr>
                        <tr style="background:#f9fafb;">
                            <td><strong>üéØ ROE</strong><br><span style="font-size:12px; color:#6b7280;">Return on Equity</span></td>
                            <td style="font-size:20px; font-weight:900; color:${parseFloat(d.roe) > 15 ? '#10b981' : '#f59e0b'};">${d.roe}%</td>
                            <td style="line-height:1.8;">
                                ${parseFloat(d.roe) > 15 ?
                                    '<strong style="color:#10b981;">üü¢ HIGH RETURNS:</strong> Company generates $' + d.roe + ' profit for every $100 invested by shareholders. Efficient use of capital!' :
                                    '<strong style="color:#f59e0b;">üü° MODERATE:</strong> Returns $' + d.roe + ' per $100 of shareholder money. Average capital efficiency.'
                                }
                            </td>
                        </tr>
                        <tr>
                            <td><strong>üí∞ Dividend Yield</strong><br><span style="font-size:12px; color:#6b7280;">Income you receive</span></td>
                            <td style="font-size:20px; font-weight:900; color:#8b5cf6;">${d.dividend_yield}%</td>
                            <td style="line-height:1.8;">
                                ${parseFloat(d.dividend_yield) > 3 ?
                                    '<strong>High Income:</strong> You earn $' + d.dividend_yield + ' per year for every $100 invested. Good for income-seeking investors!' :
                                  parseFloat(d.dividend_yield) > 1 ?
                                    '<strong>Moderate Income:</strong> You get $' + d.dividend_yield + ' yearly income per $100 invested. Some passive income plus growth.' :
                                    '<strong>Growth Focus:</strong> Low/no dividend. Company reinvests profits for growth instead of paying shareholders.'
                                }
                            </td>
                        </tr>
                    </table>
                    
                    <div style="background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding:18px; border-radius:10px; margin-top:20px; border-left:4px solid #3b82f6;">
                        <h5 style="color:#1e40af; font-weight:700; margin-bottom:10px;">üí° Quick Valuation Summary:</h5>
                        <p style="color:#1e3a8a; line-height:1.9; margin:0;">
                            ${parseFloat(d.pe_ratio) < 20 ?
                                '<strong>Value Opportunity:</strong> Multiple metrics suggest the stock may be undervalued or fairly priced. Good for value investors.' :
                                '<strong>Growth Premium:</strong> Stock trades at higher multiples. Suitable if you believe in strong future growth.'
                            }
                        </p>
                    </div>
                </div>
                
                <div class="section entry-exit">
                    <h3>üéØ STRATEGIC ENTRY & EXIT LEVELS</h3>
                    <p style="margin-bottom:18px; font-weight:600; color:#6b21a8;">
                        Based on technical analysis and current momentum, here are recommended action levels:
                    </p>
                    <table>
                        <tr>
                            <th>Action Level</th>
                            <th>Price Target</th>
                            <th>Strategic Recommendation</th>
                        </tr>
                        <tr style="background:#d1fae5;">
                            <td><strong>üü¢ BUY ZONE</strong></td>
                            <td class="price-action buy-zone">Below ${curr}${(price * 0.95).toFixed(2)}</td>
                            <td>Strong accumulation opportunity - consider building position</td>
                        </tr>
                        <tr style="background:#e0e7ff;">
                            <td><strong>üìç CURRENT PRICE</strong></td>
                            <td class="price-action current">${curr}${price.toLocaleString()}</td>
                            <td>Monitor for confirmation signals before adding</td>
                        </tr>
                        <tr style="background:#fef3c7;">
                            <td><strong>üü° TAKE PROFIT 1</strong></td>
                            <td class="price-action profit-zone">Above ${curr}${(price * 1.10).toFixed(2)}</td>
                            <td>Consider booking 30-50% profits at +10% gain</td>
                        </tr>
                        <tr style="background:#fde68a;">
                            <td><strong>üü° TAKE PROFIT 2</strong></td>
                            <td class="price-action profit-zone">Above ${curr}${(price * 1.20).toFixed(2)}</td>
                            <td>Exit remaining position at +20% for maximum gains</td>
                        </tr>
                        <tr style="background:#fee2e2;">
                            <td><strong>üî¥ STOP LOSS</strong></td>
                            <td class="price-action stop-loss">Below ${curr}${(price * 0.90).toFixed(2)}</td>
                            <td>Strict exit level to limit downside risk to 10%</td>
                        </tr>
                    </table>
                </div>
                
                <div class="section risk">
                    <h3>‚ö†Ô∏è COMPREHENSIVE RISK ANALYSIS</h3>
                    <table>
                        <tr>
                            <th>Risk Category</th>
                            <th>Current Metric</th>
                            <th>Risk Assessment</th>
                        </tr>
                        <tr>
                            <td><strong>Price Positioning</strong></td>
                            <td>${((price/d.week52_high)*100).toFixed(1)}% of 52-week high</td>
                            <td>${price/d.week52_high > 0.9 ? '‚ö† Near peak - limited upside, watch for reversal' : price/d.week52_high < 0.6 ? '‚úì Recovery potential from lows' : '‚Üî Mid-range - balanced risk/reward'}</td>
                        </tr>
                        <tr>
                            <td><strong>Financial Leverage</strong></td>
                            <td>Debt/Equity: ${d.debt_to_equity}</td>
                            <td>${parseFloat(d.debt_to_equity) > 2 ? '‚ö† High leverage - monitor debt servicing' : parseFloat(d.debt_to_equity) > 1 ? '‚Üî Moderate debt levels' : '‚úì Conservative balance sheet'}</td>
                        </tr>
                        <tr>
                            <td><strong>Liquidity Position</strong></td>
                            <td>Current Ratio: ${d.current_ratio}</td>
                            <td>${parseFloat(d.current_ratio) > 1.5 ? '‚úì Strong liquidity, can meet obligations' : parseFloat(d.current_ratio) > 1 ? '‚Üî Adequate short-term coverage' : '‚ö† Liquidity concerns - monitor cash flow'}</td>
                        </tr>
                        <tr>
                            <td><strong>Volatility (Beta)</strong></td>
                            <td>${d.beta}</td>
                            <td>${Math.abs(parseFloat(d.beta)) > 1.5 ? '‚ö† High volatility - expect larger price swings' : Math.abs(parseFloat(d.beta)) < 0.8 ? '‚úì Lower volatility than market' : '‚Üî Average market volatility'}</td>
                        </tr>
                        <tr>
                            <td><strong>Sector Dynamics</strong></td>
                            <td>${d.sector}</td>
                            <td>Monitor sector-specific trends and regulatory changes</td>
                        </tr>
                    </table>
                </div>
                
                <div class="section" style="border-color:#6b7280; background:white;">
                    <h3 style="color:#1f2937;">ü§ñ AI-POWERED COMPREHENSIVE ANALYSIS</h3>
                    <div style="background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding:20px; border-radius:12px; margin-bottom:20px; border-left:4px solid #0ea5e9;">
                        <h4 style="color:#0c4a6e; font-size:18px; font-weight:700; margin-bottom:12px;">üìä Market Overview & Positioning</h4>
                        <p style="line-height:1.9; color:#374151;">
                            ${d.company_name || d.ticker} operates in the ${d.sector} sector, specifically within ${d.industry}. 
                            The stock is currently trading at ${curr}${price.toLocaleString()}, positioning it at ${((price/d.week52_high)*100).toFixed(0)}% of its 52-week high. 
                            With a market capitalization of ${formatCap(d.market_cap)}, this is classified as a ${d.market_cap > 100e9 ? 'large-cap' : d.market_cap > 10e9 ? 'mid-cap' : 'small-cap'} investment opportunity.
                        </p>
                    </div>
                    
                    <div style="background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding:20px; border-radius:12px; margin-bottom:20px; border-left:4px solid #f59e0b;">
                        <h4 style="color:#92400e; font-size:18px; font-weight:700; margin-bottom:12px;">üí∞ Financial Health Snapshot</h4>
                        <p style="line-height:1.9; color:#374151;">
                            <strong>Profitability:</strong> Operating with a profit margin of ${d.profit_margin}% and generating a return on equity (ROE) of ${d.roe}%, 
                            the company demonstrates ${parseFloat(d.roe) > 15 ? 'strong' : 'moderate'} capital efficiency. 
                            <strong>Valuation:</strong> The P/E ratio of ${d.pe_ratio} suggests the stock is ${peRatio < 15 ? 'potentially undervalued' : peRatio < 25 ? 'fairly valued' : 'trading at a premium'} relative to earnings.
                            <strong>Shareholder Returns:</strong> Current dividend yield stands at ${d.dividend_yield}%.
                        </p>
                    </div>
                    
                    <div style="background:linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding:20px; border-radius:12px; margin-bottom:20px; border-left:4px solid #10b981;">
                        <h4 style="color:#065f46; font-size:18px; font-weight:700; margin-bottom:12px;">üìà Technical Analysis & Momentum</h4>
                        <p style="line-height:1.9; color:#374151;">
                            The stock has shown ${d.price_change >= 0 ? 'positive' : 'negative'} momentum today with a ${Math.abs(d.price_change_pct).toFixed(2)}% move. 
                            Trading range analysis shows the stock is ${price < d.week52_low * 1.1 ? 'near its 52-week lows, potentially offering a value entry point' : 
                            price > d.week52_high * 0.9 ? 'approaching 52-week highs, suggesting strong momentum but limited near-term upside' : 
                            'in the middle of its 52-week range, offering balanced risk-reward'}.
                            Beta of ${d.beta} indicates ${Math.abs(parseFloat(d.beta)) > 1.2 ? 'higher than average' : 'average'} volatility compared to the broader market.
                        </p>
                    </div>
                    
                    <div style="background:linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding:20px; border-radius:12px; margin-bottom:20px; border-left:4px solid #ef4444;">
                        <h4 style="color:#991b1b; font-size:18px; font-weight:700; margin-bottom:12px;">‚ö° Key Catalysts & Risks</h4>
                        <p style="line-height:1.9; color:#374151;">
                            <strong>Growth Drivers:</strong> Sector-specific tailwinds in ${d.sector} could provide upside momentum. 
                            Monitor quarterly earnings, guidance updates, and industry trends.
                            <strong>Risk Factors:</strong> Debt-to-equity ratio of ${d.debt_to_equity} indicates ${parseFloat(d.debt_to_equity) > 1.5 ? 'elevated leverage requiring monitoring' : 'manageable debt levels'}. 
                            Current ratio of ${d.current_ratio} suggests ${parseFloat(d.current_ratio) > 1.5 ? 'strong' : 'adequate'} liquidity to meet short-term obligations.
                        </p>
                    </div>
                    
                    <div style="background:linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%); padding:20px; border-radius:12px; margin-bottom:20px; border-left:4px solid #8b5cf6;">
                        <h4 style="color:#6b21a8; font-size:18px; font-weight:700; margin-bottom:12px;">üéØ Investment Recommendation</h4>
                        <p style="line-height:1.9; color:#374151; font-weight:600;">
                            ${verdict === 'BUY' ? 
                                '‚úÖ <strong>BUY RECOMMENDATION:</strong> The combination of attractive valuation, positive momentum, and solid fundamentals makes this a compelling investment opportunity at current levels. Consider initiating a position with appropriate position sizing.' :
                              verdict === 'SELL' ?
                                '‚ö†Ô∏è <strong>SELL/AVOID:</strong> Current valuation appears stretched and risk factors suggest limited upside potential. Consider taking profits or avoiding new positions until better entry points emerge.' :
                                '‚Üî <strong>HOLD RECOMMENDATION:</strong> The stock appears fairly valued at current levels. Existing investors should maintain positions while monitoring upcoming catalysts. New investors may wait for better entry points.'
                            }
                        </p>
                    </div>
                    
                    <div style="background:white; padding:25px; border-radius:12px; border:2px solid #e5e7eb;">
                        <h4 style="color:#1f2937; font-size:18px; font-weight:700; margin-bottom:15px;">üìù Full AI-Generated Analysis</h4>
                        <div id="aiAnalysisFormatted" style="line-height:2; color:#374151; font-size:15px;"></div>
                    </div>
                </div>
                
                <div class="section small-caps">
                    <h3>üåü 10-YEAR SMALL-CAP WEALTH BUILDERS</h3>
                    <p style="margin-bottom:18px; font-weight:600; color:#c2410c;">
                        High-potential small-cap opportunities in <strong id="smallCapSector"></strong> sector for long-term wealth creation:
                    </p>
                    <div id="smallCapTable"></div>
                    <p style="margin-top:18px; font-size:14px; color:#78350f; font-weight:600; background:white; padding:15px; border-radius:8px; border-left:4px solid #f59e0b;">
                        <strong>‚ö†Ô∏è Investment Advisory:</strong> Small-cap stocks carry higher risk but offer superior long-term wealth creation potential. 
                        These recommendations are in the same sector/region as <strong id="smallCapTicker"></strong>. 
                        Suitable for investors with 10+ year horizon and risk appetite. Diversify across 5-8 small-caps to mitigate individual stock risk.
                    </p>
                </div>
            `;
            
            // Set the HTML first to create the DOM elements
            document.getElementById('analysisContainer').innerHTML = html;
            
            // Now populate the dynamic content
            formatAIAnalysis(report);
            generateSmallCapRecommendations(d);
        }
        
        function formatAIAnalysis(rawText) {
            // Parse AI text and create beautiful, educational, interactive tables
            
            const sections = [
                {
                    title: 'üìä Valuation Check - Is The Price Right?',
                    icon: 'üí∞',
                    color: '#3b82f6',
                    data: extractValuationInsights(rawText)
                },
                {
                    title: 'üìà Price Momentum - Where Is It Heading?',
                    icon: 'üéØ',
                    color: '#10b981',
                    data: extractMomentumInsights(rawText)
                },
                {
                    title: '‚ö†Ô∏è Risk Factors - What Could Go Wrong?',
                    icon: 'üõ°Ô∏è',
                    color: '#ef4444',
                    data: extractRiskInsights(rawText)
                },
                {
                    title: 'üí° Investment Strategy - Should You Buy?',
                    icon: 'üéØ',
                    color: '#8b5cf6',
                    data: extractStrategyInsights(rawText)
                }
            ];
            
            let formattedHTML = `
                <div style="background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding:20px; border-radius:12px; margin-bottom:25px; border:3px solid #3b82f6;">
                    <h4 style="color:#1e40af; font-size:20px; font-weight:900; margin-bottom:12px; text-align:center;">
                        üéì EASY-TO-UNDERSTAND AI ANALYSIS
                    </h4>
                    <p style="text-align:center; color:#475569; font-size:15px; line-height:1.8;">
                        We've analyzed this stock and broken it down into simple, actionable insights.<br>
                        <strong>Look for üü¢ GREEN (good signs), üü° YELLOW (be careful), and üî¥ RED (warning signals)</strong>
                    </p>
                </div>
            `;
            
            sections.forEach(section => {
                formattedHTML += createEducationalSection(section);
            });
            
            // Add the raw AI analysis at the end for reference
            formattedHTML += `
                <div style="background:#f9fafb; padding:20px; border-radius:12px; margin-top:25px; border:2px solid #e5e7eb;">
                    <h4 style="color:#374151; font-size:16px; font-weight:700; margin-bottom:15px; cursor:pointer;" onclick="document.getElementById('fullAI').style.display = document.getElementById('fullAI').style.display === 'none' ? 'block' : 'none'">
                        üìÑ Full AI Analysis (Click to expand) ‚ñº
                    </h4>
                    <div id="fullAI" style="display:none; line-height:1.9; color:#4b5563; font-size:14px; white-space:pre-wrap;">${rawText}</div>
                </div>
            `;
            
            document.getElementById('aiAnalysisFormatted').innerHTML = formattedHTML;
        }
        
        function createEducationalSection(section) {
            if (!section.data || section.data.length === 0) {
                return ''; // Skip empty sections
            }
            
            return `
                <div style="background:white; padding:25px; border-radius:12px; margin-bottom:20px; border-left:6px solid ${section.color}; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
                    <h4 style="color:${section.color}; font-size:19px; font-weight:900; margin-bottom:18px; display:flex; align-items:center; gap:10px;">
                        <span style="font-size:28px;">${section.icon}</span>
                        ${section.title}
                    </h4>
                    
                    <table style="width:100%; border-collapse:collapse; margin-top:15px;">
                        <thead>
                            <tr style="background:linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);">
                                <th style="padding:15px; text-align:left; font-weight:700; color:#1f2937; border-bottom:3px solid ${section.color}; width:25%;">Factor</th>
                                <th style="padding:15px; text-align:left; font-weight:700; color:#1f2937; border-bottom:3px solid ${section.color}; width:25%;">Current Status</th>
                                <th style="padding:15px; text-align:left; font-weight:700; color:#1f2937; border-bottom:3px solid ${section.color}; width:50%;">What This Means For You</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${section.data.map(row => createTableRow(row)).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function createTableRow(row) {
            const signalColors = {
                'good': '#10b981',
                'caution': '#f59e0b',
                'concern': '#ef4444',
                'neutral': '#6b7280'
            };
            
            const signalIcons = {
                'good': 'üü¢',
                'caution': 'üü°',
                'concern': 'üî¥',
                'neutral': '‚ö™'
            };
            
            return `
                <tr style="border-bottom:1px solid #f3f4f6; transition:all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                    <td style="padding:15px; font-weight:700; color:#374151; font-size:15px;">
                        ${row.factor}
                    </td>
                    <td style="padding:15px; color:${signalColors[row.signal]}; font-weight:700; font-size:15px;">
                        ${signalIcons[row.signal]} ${row.status}
                    </td>
                    <td style="padding:15px; color:#4b5563; line-height:1.7; font-size:14px;">
                        ${row.explanation}
                    </td>
                </tr>
            `;
        }
        
        function extractValuationInsights(text) {
            // Parse AI text and extract valuation insights
            // This creates simple, educational rows
            const insights = [];
            
            // Look for P/E mentions
            if (text.toLowerCase().includes('p/e') || text.toLowerCase().includes('price-to-earnings')) {
                const peMatch = text.match(/p\/e.*?(\d+\.?\d*)/i);
                if (peMatch) {
                    const pe = parseFloat(peMatch[1]);
                    insights.push({
                        factor: 'Price-to-Earnings (P/E) Ratio',
                        status: pe < 15 ? 'Undervalued' : pe < 25 ? 'Fair Value' : 'Expensive',
                        signal: pe < 15 ? 'good' : pe < 25 ? 'neutral' : 'caution',
                        explanation: pe < 15 ? 
                            `Stock is trading below average market multiples. This could be a good buying opportunity if fundamentals are strong.` :
                            pe < 25 ?
                            `Stock is reasonably priced compared to its earnings. Not too cheap, not too expensive.` :
                            `Stock is trading at a premium. You're paying more for each dollar of earnings. Make sure growth justifies the price.`
                    });
                }
            }
            
            // Look for valuation keywords
            if (text.toLowerCase().includes('undervalued')) {
                insights.push({
                    factor: 'Overall Valuation',
                    status: 'Below Fair Value',
                    signal: 'good',
                    explanation: 'The stock appears to be trading below its intrinsic worth. This could present a buying opportunity for long-term investors.'
                });
            } else if (text.toLowerCase().includes('overvalued') || text.toLowerCase().includes('expensive')) {
                insights.push({
                    factor: 'Overall Valuation',
                    status: 'Above Fair Value',
                    signal: 'caution',
                    explanation: 'The stock may be trading above its fundamental value. Consider waiting for a better entry price or ensure growth prospects justify the premium.'
                });
            } else if (text.toLowerCase().includes('fairly valued') || text.toLowerCase().includes('reasonable')) {
                insights.push({
                    factor: 'Overall Valuation',
                    status: 'Fair Value',
                    signal: 'neutral',
                    explanation: 'The stock is priced appropriately based on current fundamentals. Neither a bargain nor overpriced.'
                });
            }
            
            // Profit margins
            if (text.toLowerCase().includes('margin')) {
                const marginMatch = text.match(/margin.*?(\d+\.?\d*)%/i);
                if (marginMatch) {
                    const margin = parseFloat(marginMatch[1]);
                    insights.push({
                        factor: 'Profit Margins',
                        status: margin > 15 ? 'Healthy' : margin > 8 ? 'Moderate' : 'Weak',
                        signal: margin > 15 ? 'good' : margin > 8 ? 'neutral' : 'concern',
                        explanation: margin > 15 ?
                            `Strong profit margins (${margin}%) indicate efficient operations and pricing power. The company keeps more of each dollar in revenue.` :
                            margin > 8 ?
                            `Moderate margins (${margin}%). Company is profitable but facing competitive pressure on pricing.` :
                            `Low margins (${margin}%) suggest intense competition or operational challenges. Monitor carefully.`
                    });
                }
            }
            
            // Growth
            if (text.toLowerCase().includes('growth')) {
                insights.push({
                    factor: 'Growth Prospects',
                    status: text.toLowerCase().includes('high growth') || text.toLowerCase().includes('strong growth') ? 'Strong Growth Expected' : 'Moderate Growth',
                    signal: text.toLowerCase().includes('high growth') || text.toLowerCase().includes('strong growth') ? 'good' : 'neutral',
                    explanation: text.toLowerCase().includes('high growth') || text.toLowerCase().includes('strong growth') ?
                        'Company is expected to grow revenues and earnings faster than the market average. This can justify higher valuations.' :
                        'Company shows steady but not spectacular growth. Suitable for conservative investors seeking stability.'
                });
            }
            
            return insights.length > 0 ? insights : [
                {
                    factor: 'Valuation Assessment',
                    status: 'Under Review',
                    signal: 'neutral',
                    explanation: 'AI is analyzing multiple valuation metrics to determine if the stock is fairly priced. Check detailed analysis below.'
                }
            ];
        }
        
        function extractMomentumInsights(text) {
            const insights = [];
            
            // Price trend
            if (text.toLowerCase().includes('uptrend') || text.toLowerCase().includes('rising') || text.toLowerCase().includes('bullish')) {
                insights.push({
                    factor: 'Price Trend',
                    status: 'Upward Momentum',
                    signal: 'good',
                    explanation: 'Stock price is in an upward trend. Buyers are in control, and sentiment is positive. Good for momentum investors.'
                });
            } else if (text.toLowerCase().includes('downtrend') || text.toLowerCase().includes('falling') || text.toLowerCase().includes('bearish')) {
                insights.push({
                    factor: 'Price Trend',
                    status: 'Downward Momentum',
                    signal: 'concern',
                    explanation: 'Stock price is trending down. Sellers dominate. Wait for stabilization before buying, or consider for short-term trading only.'
                });
            } else if (text.toLowerCase().includes('sideways') || text.toLowerCase().includes('range-bound')) {
                insights.push({
                    factor: 'Price Trend',
                    status: 'Consolidating',
                    signal: 'neutral',
                    explanation: 'Stock is moving sideways in a range. Market is undecided. Watch for a breakout in either direction.'
                });
            }
            
            // Volume
            if (text.toLowerCase().includes('volume')) {
                insights.push({
                    factor: 'Trading Volume',
                    status: text.toLowerCase().includes('high volume') ? 'High Interest' : 'Normal Activity',
                    signal: text.toLowerCase().includes('high volume') ? 'good' : 'neutral',
                    explanation: text.toLowerCase().includes('high volume') ?
                        'High trading volume confirms the price move. More buyers/sellers = more reliable trend.' :
                        'Normal trading activity. Price moves are less significant without volume confirmation.'
                });
            }
            
            // 52-week position
            if (text.includes('52') || text.includes('week high') || text.includes('week low')) {
                if (text.toLowerCase().includes('near.*high')) {
                    insights.push({
                        factor: '52-Week Position',
                        status: 'Near Yearly High',
                        signal: 'caution',
                        explanation: 'Stock is trading close to its highest price in the past year. Limited upside in short term. Be cautious about chasing.'
                    });
                } else if (text.toLowerCase().includes('near.*low')) {
                    insights.push({
                        factor: '52-Week Position',
                        status: 'Near Yearly Low',
                        signal: 'neutral',
                        explanation: 'Stock is near its lowest price this year. Could be a value opportunity if fundamentals are intact, or a value trap if problems persist.'
                    });
                }
            }
            
            return insights.length > 0 ? insights : [
                {
                    factor: 'Price Momentum',
                    status: 'Analyzing Trends',
                    signal: 'neutral',
                    explanation: 'AI is reviewing price patterns and momentum indicators. Check the price chart above for visual trends.'
                }
            ];
        }
        
        function extractRiskInsights(text) {
            const insights = [];
            
            // Debt levels
            if (text.toLowerCase().includes('debt')) {
                if (text.toLowerCase().includes('high debt') || text.toLowerCase().includes('leverage')) {
                    insights.push({
                        factor: 'Debt Burden',
                        status: 'High Leverage',
                        signal: 'concern',
                        explanation: 'Company carries significant debt. This increases risk during downturns as interest payments must be made. Monitor cash flow carefully.'
                    });
                } else if (text.toLowerCase().includes('low debt') || text.toLowerCase().includes('strong balance sheet')) {
                    insights.push({
                        factor: 'Financial Health',
                        status: 'Low Debt',
                        signal: 'good',
                        explanation: 'Company has manageable debt levels. This provides financial flexibility and reduces risk during economic downturns.'
                    });
                }
            }
            
            // Volatility
            if (text.toLowerCase().includes('volatile') || text.toLowerCase().includes('volatility')) {
                insights.push({
                    factor: 'Price Volatility',
                    status: 'High Swings',
                    signal: 'caution',
                    explanation: 'Stock experiences large price swings. Higher risk but also higher potential reward. Suitable for risk-tolerant investors only.'
                });
            }
            
            // Sector risks
            if (text.toLowerCase().includes('sector') || text.toLowerCase().includes('industry')) {
                insights.push({
                    factor: 'Industry Dynamics',
                    status: 'Sector-Specific Risks',
                    signal: 'neutral',
                    explanation: 'Monitor industry trends, regulatory changes, and competitive dynamics. These affect all companies in the sector.'
                });
            }
            
            // Market risk
            if (text.toLowerCase().includes('market') || text.toLowerCase().includes('economy')) {
                insights.push({
                    factor: 'Market Conditions',
                    status: 'Macro Environment',
                    signal: 'neutral',
                    explanation: 'Overall market conditions and economic factors affect this stock. Stay informed about interest rates, inflation, and economic indicators.'
                });
            }
            
            return insights.length > 0 ? insights : [
                {
                    factor: 'Risk Assessment',
                    status: 'Standard Market Risks',
                    signal: 'neutral',
                    explanation: 'All investments carry risk. Diversify your portfolio and invest only what you can afford to lose. Consider your risk tolerance.'
                }
            ];
        }
        
        function extractStrategyInsights(text) {
            const insights = [];
            
            // Buy/Sell/Hold recommendation
            if (text.toUpperCase().includes('BUY') && !text.toUpperCase().includes('DON\'T BUY')) {
                insights.push({
                    factor: 'Overall Recommendation',
                    status: 'BUY',
                    signal: 'good',
                    explanation: 'Based on analysis, this stock appears to be a good investment opportunity at current levels. Consider building a position gradually.'
                });
            } else if (text.toUpperCase().includes('SELL') || text.toUpperCase().includes('AVOID')) {
                insights.push({
                    factor: 'Overall Recommendation',
                    status: 'SELL / AVOID',
                    signal: 'concern',
                    explanation: 'Analysis suggests avoiding this stock or exiting positions. Risk factors outweigh potential rewards at current prices.'
                });
            } else if (text.toUpperCase().includes('HOLD')) {
                insights.push({
                    factor: 'Overall Recommendation',
                    status: 'HOLD',
                    signal: 'neutral',
                    explanation: 'If you own this stock, hold your position. If looking to buy, wait for a better entry point or more positive catalysts.'
                });
            }
            
            // Time horizon
            if (text.toLowerCase().includes('long-term') || text.toLowerCase().includes('long term')) {
                insights.push({
                    factor: 'Investment Horizon',
                    status: 'Long-Term Hold',
                    signal: 'good',
                    explanation: 'This stock is suitable for buy-and-hold investors with a 3-5+ year horizon. Short-term volatility should be expected and tolerated.'
                });
            } else if (text.toLowerCase().includes('short-term') || text.toLowerCase().includes('trading')) {
                insights.push({
                    factor: 'Investment Horizon',
                    status: 'Short-Term Trade',
                    signal: 'caution',
                    explanation: 'Better suited for active traders. Not ideal for long-term passive investors. Requires close monitoring and quick decisions.'
                });
            }
            
            // Position sizing
            insights.push({
                factor: 'Position Sizing',
                status: 'Diversify Appropriately',
                signal: 'neutral',
                explanation: 'Don\'t put all eggs in one basket. This stock should represent no more than 5-10% of your total portfolio. Spread risk across multiple investments.'
            });
            
            // Entry strategy
            if (text.toLowerCase().includes('dip') || text.toLowerCase().includes('pullback')) {
                insights.push({
                    factor: 'Entry Strategy',
                    status: 'Buy on Dips',
                    signal: 'good',
                    explanation: 'Consider building position gradually when stock pulls back. This gives better average entry price than buying all at once.'
                });
            }
            
            return insights.length > 0 ? insights : [
                {
                    factor: 'Investment Approach',
                    status: 'Do Your Research',
                    signal: 'neutral',
                    explanation: 'This AI analysis is a starting point. Always do your own research, consult financial advisors, and invest based on your personal goals and risk tolerance.'
                }
            ];
        }
        
        function generateSmallCapRecommendations(stockData) {
            const sector = stockData.sector || 'Technology';
            const ticker = stockData.ticker;
            const isIndian = ticker.includes('.NS') || ticker.includes('.BO');
            
            // Update display elements
            document.getElementById('smallCapSector').textContent = sector;
            document.getElementById('smallCapTicker').textContent = ticker;
            
            // Comprehensive small-cap database by sector and geography
            const smallCapDatabase = {
                // TECHNOLOGY - US
                'Technology_US': [
                    {name: 'CrowdStrike (CRWD)', sector: 'Cybersecurity', strengths: 'AI-powered endpoint protection, cloud-native platform', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Datadog (DDOG)', sector: 'Cloud Monitoring', strengths: 'SaaS observability platform, enterprise adoption', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Snowflake (SNOW)', sector: 'Data Cloud', strengths: 'Cloud data warehousing, multi-cloud support', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Cloudflare (NET)', sector: 'Edge Computing', strengths: 'Global CDN, security services', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'MongoDB (MDB)', sector: 'Database', strengths: 'NoSQL database leader, developer-friendly', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Zscaler (ZS)', sector: 'Cloud Security', strengths: 'Zero trust architecture, enterprise security', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'}
                ],
                
                // TECHNOLOGY - INDIA
                'Technology_India': [
                    {name: 'KPIT Technologies', sector: 'Auto Tech', strengths: 'EV software, ADAS solutions, Tier-1 automotive clients', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Persistent Systems', sector: 'IT Services', strengths: 'Digital engineering, product development services', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Coforge Limited', sector: 'IT Consulting', strengths: 'Banking IT, insurance tech, global delivery', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Tata Elxsi', sector: 'Design & Tech', strengths: 'Automotive design, embedded systems, IoT', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'L&T Technology', sector: 'Engineering R&D', strengths: 'ER&D services, digital manufacturing', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Cyient Limited', sector: 'Engineering', strengths: 'Aerospace, defense, semiconductor services', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'}
                ],
                
                // HEALTHCARE - US
                'Healthcare_US': [
                    {name: 'Exact Sciences (EXAS)', sector: 'Diagnostics', strengths: 'Cancer screening (Cologuard), liquid biopsy tech', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Insulet (PODD)', sector: 'Medical Devices', strengths: 'Omnipod insulin pump, tubeless technology', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Penumbra (PEN)', sector: 'Neurovascular', strengths: 'Stroke treatment devices, thrombectomy systems', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Natera (NTRA)', sector: 'Genetic Testing', strengths: 'Prenatal testing, oncology genomics', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'iRhythm Tech (IRTC)', sector: 'Digital Health', strengths: 'Cardiac monitoring (Zio), wearable devices', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Inspire Medical (INSP)', sector: 'Sleep Medicine', strengths: 'Sleep apnea implant, innovative therapy', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'}
                ],
                
                // HEALTHCARE - INDIA  
                'Healthcare_India': [
                    {name: 'Laurus Labs', sector: 'Pharma API', strengths: 'ARV APIs, oncology APIs, backward integration', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Suven Pharmaceuticals', sector: 'CRAMS', strengths: 'Contract manufacturing, niche APIs, US/Europe clients', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Solara Active Pharma', sector: 'API Mfg', strengths: 'Ibuprofen APIs, global presence, R&D focus', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Neuland Laboratories', sector: 'Specialty APIs', strengths: 'Custom synthesis, regulated markets', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Poly Medicure', sector: 'Medical Devices', strengths: 'IV sets, blood bags, export-oriented', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Granules India', sector: 'Pharma', strengths: 'APIs & formulations, US FDA approvals', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'}
                ],
                
                // FINANCIAL SERVICES - US
                'Financial Services_US': [
                    {name: 'SoFi Technologies (SOFI)', sector: 'Digital Banking', strengths: 'Student loans, personal finance, bank charter', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Affirm Holdings (AFRM)', sector: 'BNPL', strengths: 'Buy-now-pay-later, merchant partnerships', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Upstart Holdings (UPST)', sector: 'AI Lending', strengths: 'AI credit underwriting, banking partnerships', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'LendingClub (LC)', sector: 'Online Banking', strengths: 'Digital bank, marketplace lending', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Marqeta (MQ)', sector: 'Card Issuing', strengths: 'Modern card issuing platform, embedded finance', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Toast Inc (TOST)', sector: 'Restaurant Tech', strengths: 'POS systems, payment processing', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'}
                ],
                
                // FINANCIAL SERVICES - INDIA
                'Financial Services_India': [
                    {name: 'Bajaj Finance', sector: 'NBFC', strengths: 'Consumer finance leader, digital-first, cross-sell', potential: 'Exceptional', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Cholamandalam Investment', sector: 'NBFC', strengths: 'Vehicle finance, used car loans, asset quality', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Shriram Finance', sector: 'NBFC', strengths: 'Commercial vehicle finance, rural reach', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Aavas Financiers', sector: 'Housing Finance', strengths: 'Affordable housing, Tier 2/3 cities focus', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Home First Finance', sector: 'Housing Finance', strengths: 'Low-income housing, high growth potential', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'IIFL Finance', sector: 'NBFC', strengths: 'Gold loans, home loans, diverse portfolio', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'}
                ],
                
                // CONSUMER - US
                'Consumer_US': [
                    {name: 'Celsius Holdings (CELH)', sector: 'Beverages', strengths: 'Energy drinks, health-focused, rapid growth', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Dutch Bros (BROS)', sector: 'Coffee Shops', strengths: 'Drive-thru model, West Coast expansion', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Planet Fitness (PLNT)', sector: 'Fitness', strengths: 'Budget gym model, franchise expansion', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Boot Barn (BOOT)', sector: 'Specialty Retail', strengths: 'Western wear, work boots, lifestyle brand', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Floor & Decor (FND)', sector: 'Home Improvement', strengths: 'Flooring specialty, warehouse format', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Wingstop (WING)', sector: 'QSR', strengths: 'Chicken wings, franchise model, delivery', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'}
                ],
                
                // CONSUMER - INDIA
                'Consumer_India': [
                    {name: 'Trent Limited', sector: 'Retail', strengths: 'Westside & Zudio brands, rapid store expansion', potential: 'Exceptional', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Avenue Supermarts (D-Mart)', sector: 'Retail', strengths: 'Value retail leader, EDLP model, strong execution', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Vedant Fashions', sector: 'Ethnic Wear', strengths: 'Manyavar brand, wedding market leader', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Varun Beverages', sector: 'Beverages', strengths: 'PepsiCo franchisee, geographic expansion', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Jubilant FoodWorks', sector: 'QSR', strengths: 'Dominos India, Dunkin, store network', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Bata India', sector: 'Footwear', strengths: 'Brand heritage, retail presence, premiumization', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'}
                ],
                
                // INDUSTRIALS - US
                'Industrials_US': [
                    {name: 'Chart Industries (GTLS)', sector: 'Industrial Equipment', strengths: 'LNG equipment, hydrogen infrastructure', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Generac Holdings (GNRC)', sector: 'Power Equipment', strengths: 'Home generators, clean energy storage', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Bloom Energy (BE)', sector: 'Fuel Cells', strengths: 'Solid oxide fuel cells, distributed power', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'AAON Inc (AAON)', sector: 'HVAC', strengths: 'Commercial HVAC, energy efficiency', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'AZEK Company (AZEK)', sector: 'Building Products', strengths: 'Composite decking, sustainable materials', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Fluence Energy (FLNC)', sector: 'Energy Storage', strengths: 'Battery storage systems, renewable integration', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'}
                ],
                
                // INDUSTRIALS - INDIA
                'Industrials_India': [
                    {name: 'Kaynes Technology', sector: 'Defense Electronics', strengths: 'Defense & space electronics, IoT, govt contracts', potential: 'Exceptional', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Dixon Technologies', sector: 'Electronics Mfg', strengths: 'PLI beneficiary, contract mfg, diversified products', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Polycab India', sector: 'Cables & Wires', strengths: 'Infrastructure growth, brand strength, FMEG', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'KEI Industries', sector: 'Cables', strengths: 'Power cables, infrastructure demand', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Kalpataru Projects', sector: 'Infrastructure EPC', strengths: 'Power transmission, global projects', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Apar Industries', sector: 'Cables/Conductors', strengths: 'Specialty cables, transformer oils, exports', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'}
                ],
                
                // ENERGY - US
                'Energy_US': [
                    {name: 'Enphase Energy (ENPH)', sector: 'Solar Equipment', strengths: 'Microinverters, residential solar, battery storage', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Array Technologies (ARRY)', sector: 'Solar Trackers', strengths: 'Solar tracking systems, utility-scale projects', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Chord Energy (CHRD)', sector: 'Oil & Gas', strengths: 'Bakken Shale production, low-cost operator', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Magnolia Oil & Gas (MGY)', sector: 'Oil & Gas', strengths: 'Eagle Ford assets, efficient operations', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Shoals Technologies (SHLS)', sector: 'Solar Components', strengths: 'Electrical balance of systems, solar growth', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'NextEra Energy Partners (NEP)', sector: 'Renewable Energy', strengths: 'Wind & solar portfolio, stable dividends', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'}
                ],
                
                // ENERGY - INDIA
                'Energy_India': [
                    {name: 'Adani Green Energy', sector: 'Renewable Energy', strengths: 'Massive solar/wind capacity, govt support', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Tata Power', sector: 'Power Utility', strengths: 'Renewable transition, distribution network', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'SJVN Limited', sector: 'Hydro Power', strengths: 'Hydroelectric projects, PSU backing', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Borosil Renewables', sector: 'Solar Glass', strengths: 'Solar glass manufacturing, capacity expansion', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'},
                    {name: 'Suzlon Energy', sector: 'Wind Turbines', strengths: 'Wind power solutions, turnaround story', potential: 'High', stars: '‚≠ê‚≠ê‚≠ê'},
                    {name: 'Waaree Energies', sector: 'Solar Modules', strengths: 'Solar PV manufacturing, integrated player', potential: 'Very High', stars: '‚≠ê‚≠ê‚≠ê‚≠ê'}
                ]
            };
            
            // Normalize sector name and determine geography
            let sectorKey = sector.replace(' Services', '').replace('Financial', 'Financial Services').trim();
            let geography = isIndian ? 'India' : 'US';
            let lookupKey = `${sectorKey}_${geography}`;
            
            // Try exact match first
            let recommendations = smallCapDatabase[lookupKey];
            
            // Fallback logic
            if (!recommendations) {
                // Try without Services
                lookupKey = `${sector.split(' ')[0]}_${geography}`;
                recommendations = smallCapDatabase[lookupKey];
            }
            
            // Final fallback to Technology
            if (!recommendations) {
                recommendations = smallCapDatabase[`Technology_${geography}`];
            }
            
            // Build HTML table
            let tableHTML = `
                <table>
                    <tr>
                        <th>Company Name</th>
                        <th>Specific Focus</th>
                        <th>Key Competitive Advantages</th>
                        <th>10Y Potential</th>
                    </tr>
            `;
            
            recommendations.forEach(company => {
                const colorClass = company.potential.includes('Exceptional') || company.potential.includes('Very High') ? '#10b981' : '#f59e0b';
                tableHTML += `
                    <tr>
                        <td><strong>${company.name}</strong></td>
                        <td>${company.sector}</td>
                        <td>${company.strengths}</td>
                        <td style="color:${colorClass}; font-weight:700;">${company.stars} ${company.potential}</td>
                    </tr>
                `;
            });
            
            tableHTML += `</table>`;
            document.getElementById('smallCapTable').innerHTML = tableHTML;
        }
        
        function formatCap(cap) {
            if (!cap) return 'N/A';
            if (cap >= 1e12) return '$' + (cap / 1e12).toFixed(2) + 'T';
            if (cap >= 1e9) return '$' + (cap / 1e9).toFixed(2) + 'B';
            if (cap >= 1e6) return '$' + (cap / 1e6).toFixed(2) + 'M';
            return '$' + cap.toLocaleString();
        }
        
        function createCharts(d) {
            if (valChart) valChart.destroy();
            if (trendChart) trendChart.destroy();
            
            const vCtx = document.getElementById('valChart').getContext('2d');
            valChart = new Chart(vCtx, {
                type: 'bar',
                data: {
                    labels: ['P/E Ratio', 'P/B Ratio', 'Dividend Yield'],
                    datasets: [{
                        data: [parseFloat(d.pe_ratio) || 0, parseFloat(d.pb_ratio) || 0, parseFloat(d.dividend_yield) || 0],
                        backgroundColor: ['#4338ca', '#7c3aed', '#10b981'],
                        borderColor: ['#312e81', '#5b21b6', '#059669'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: false}},
                    scales: {y: {beginAtZero: true, grid: {color: 'rgba(0,0,0,0.05)'}}}
                }
            });
            
            const price = d.current_price || 100;
            const trend = [];
            for (let i = 6; i >= 0; i--) {
                trend.push(price * (1 + (Math.random() - 0.5) * 0.12 * i / 6));
            }
            
            const tCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(tCtx, {
                type: 'line',
                data: {
                    labels: ['6M Ago', '5M', '4M', '3M', '2M', '1M', 'Current'],
                    datasets: [{
                        data: trend,
                        borderColor: '#4338ca',
                        backgroundColor: 'rgba(67,56,202,0.15)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#4338ca',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: false}},
                    scales: {
                        y: {grid: {color: 'rgba(0,0,0,0.05)'}},
                        x: {grid: {display: false}}
                    }
                }
            });
        }
        
        document.getElementById('email').addEventListener('keypress', e => {
            if (e.key === 'Enter') document.getElementById('ticker').focus();
        });
        document.getElementById('ticker').addEventListener('keypress', e => {
            if (e.key === 'Enter') analyze();
        });
    </script>
</body>
</html>
