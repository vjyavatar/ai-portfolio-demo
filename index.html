<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinel AI â€” Real-Time Stock Intelligence</title>
    <meta name="description" content="Professional AI-powered stock analysis with real-time market data. Get actionable investment recommendations with entry/exit strategies for any stock worldwide.">
    <meta name="keywords" content="stock analysis, agentic AI, investment research, stock recommendations, entry exit strategy">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #06080f;
            --bg2: #0c1019;
            --bg3: #111827;
            --surface: rgba(17,24,39,0.7);
            --glass: rgba(17,24,39,0.5);
            --border: rgba(99,179,237,0.12);
            --border2: rgba(99,179,237,0.25);
            --cyan: #22d3ee;
            --cyan2: #06b6d4;
            --green: #34d399;
            --green2: #10b981;
            --amber: #fbbf24;
            --red: #f87171;
            --purple: #a78bfa;
            --text: #e2e8f0;
            --text2: #94a3b8;
            --text3: #64748b;
            --glow-cyan: 0 0 30px rgba(34,211,238,0.15);
            --glow-green: 0 0 30px rgba(52,211,153,0.15);
        }
        *{margin:0;padding:0;box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

        /* === ANIMATED GRID BACKGROUND === */
        .grid-bg{position:fixed;inset:0;z-index:0;pointer-events:none;
            background-image:
                linear-gradient(rgba(34,211,238,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(34,211,238,0.03) 1px, transparent 1px);
            background-size:60px 60px;
        }
        .grid-bg::after{
            content:'';position:absolute;inset:0;
            background:radial-gradient(ellipse 800px 600px at 50% 0%, rgba(34,211,238,0.06), transparent 70%);
        }

        /* === NAVBAR === */
        nav{position:sticky;top:0;z-index:100;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
            background:rgba(6,8,15,0.8);border-bottom:1px solid var(--border);padding:0 32px;height:64px;
            display:flex;align-items:center;justify-content:space-between;
        }
        .nav-brand{display:flex;align-items:center;gap:12px}
        .nav-logo{width:36px;height:36px;border-radius:10px;
            background:linear-gradient(135deg,var(--cyan),var(--green));
            display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;color:var(--bg);
        }
        .nav-name{font-size:17px;font-weight:700;letter-spacing:0.5px}
        .nav-name span{color:var(--cyan)}
        .nav-stats{display:flex;gap:24px;align-items:center}
        .nav-stat{font-size:12px;color:var(--text3);font-weight:500;display:flex;align-items:center;gap:6px}
        .nav-stat .val{color:var(--cyan);font-family:'JetBrains Mono',monospace;font-weight:700;font-size:13px}
        .live-dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);
            animation:pulse-dot 2s infinite}
        @keyframes pulse-dot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.8)}}

        /* === HERO === */
        .hero{position:relative;z-index:1;padding:80px 32px 60px;text-align:center}
        .hero-eyebrow{display:inline-flex;align-items:center;gap:8px;
            background:rgba(34,211,238,0.08);border:1px solid rgba(34,211,238,0.2);
            padding:8px 20px;border-radius:100px;font-size:13px;font-weight:600;color:var(--cyan);
            margin-bottom:28px;letter-spacing:0.5px;
        }
        .hero h1{font-family:'Playfair Display',serif;font-size:clamp(36px,5.5vw,68px);font-weight:900;
            line-height:1.1;margin-bottom:20px;
            background:linear-gradient(135deg,#fff 0%,var(--cyan) 50%,var(--green) 100%);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
        }
        .hero-sub{font-size:18px;color:var(--text2);max-width:600px;margin:0 auto 40px;line-height:1.7;font-weight:400}
        .hero-badges{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
        .h-badge{display:flex;align-items:center;gap:6px;padding:8px 18px;border-radius:8px;font-size:12px;
            font-weight:600;letter-spacing:0.3px;border:1px solid var(--border);background:var(--glass);
            backdrop-filter:blur(10px);color:var(--text2)}
        .h-badge .ico{font-size:14px}

        /* === INPUT CARD === */
        .input-section{position:relative;z-index:1;max-width:760px;margin:0 auto;padding:0 24px 60px}
        .input-card{
            background:var(--surface);border:1px solid var(--border);border-radius:20px;
            padding:36px;backdrop-filter:blur(16px);
            box-shadow:var(--glow-cyan);position:relative;overflow:hidden;
        }
        .input-card::before{
            content:'';position:absolute;top:-1px;left:50%;transform:translateX(-50%);
            width:120px;height:3px;
            background:linear-gradient(90deg,transparent,var(--cyan),transparent);
            border-radius:3px;
        }
        .input-label{font-size:13px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:20px}
        .input-row{display:grid;grid-template-columns:1fr 1fr 120px;gap:12px}
        .input-wrap{position:relative}
        .ipt{width:100%;padding:14px 16px;background:var(--bg);border:1.5px solid var(--border);border-radius:12px;
            font-size:15px;color:var(--text);font-family:'Outfit',sans-serif;transition:all 0.3s;outline:none}
        .ipt::placeholder{color:var(--text3)}
        .ipt:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(34,211,238,0.1)}

        .autocomplete{position:absolute;top:100%;left:0;right:0;background:var(--bg3);
            border:1.5px solid var(--border2);border-top:none;border-radius:0 0 12px 12px;
            max-height:300px;overflow-y:auto;display:none;z-index:1000;
            box-shadow:0 20px 40px rgba(0,0,0,0.5);
        }
        .autocomplete.show{display:block}
        .ac-item{padding:12px 16px;cursor:pointer;border-bottom:1px solid var(--border);transition:all 0.2s;display:flex;align-items:center;gap:10px}
        .ac-item:hover{background:rgba(34,211,238,0.06);padding-left:22px}
        .ac-ticker{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--cyan);font-size:14px;min-width:80px}
        .ac-name{color:var(--text2);font-size:13px}

        .btn-analyze{width:100%;padding:14px;border:none;border-radius:12px;font-size:15px;font-weight:700;
            font-family:'Outfit',sans-serif;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden;
            background:linear-gradient(135deg,var(--cyan2),var(--green2));color:var(--bg);letter-spacing:0.3px;
        }
        .btn-analyze:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 24px rgba(34,211,238,0.25)}
        .btn-analyze:disabled{opacity:0.5;cursor:not-allowed}
        .btn-analyze.loading{background:linear-gradient(135deg,var(--bg3),var(--bg3));color:var(--cyan);border:1.5px solid var(--border2)}

        .helper{margin-top:16px;font-size:12px;color:var(--text3);line-height:1.8}
        .helper a{color:var(--cyan);text-decoration:none}
        .helper strong{color:var(--text2)}

        /* === STATUS === */
        .status-bar{margin-top:16px;padding:14px 18px;border-radius:12px;display:none;
            font-size:14px;font-weight:500;border:1px solid;
        }
        .status-bar.show{display:flex;align-items:center;gap:10px;animation:slideDown .3s ease}
        .status-bar.info{background:rgba(34,211,238,0.06);border-color:rgba(34,211,238,0.2);color:var(--cyan)}
        .status-bar.success{background:rgba(52,211,153,0.06);border-color:rgba(52,211,153,0.2);color:var(--green)}
        .status-bar.error{background:rgba(248,113,113,0.06);border-color:rgba(248,113,113,0.2);color:var(--red)}
        @keyframes slideDown{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}

        /* === LOADING ANIMATION === */
        .loading-steps{margin-top:16px;display:none}
        .loading-steps.show{display:block}
        .load-step{display:flex;align-items:center;gap:12px;padding:10px 0;font-size:13px;color:var(--text3);
            opacity:0;transform:translateX(-10px);transition:all 0.4s}
        .load-step.active{opacity:1;transform:translateX(0);color:var(--cyan)}
        .load-step.done{opacity:1;transform:translateX(0);color:var(--green)}
        .load-step .step-icon{width:24px;height:24px;border-radius:50%;border:2px solid var(--border);
            display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;transition:all 0.3s}
        .load-step.active .step-icon{border-color:var(--cyan);color:var(--cyan);animation:pulse-dot 1.5s infinite}
        .load-step.done .step-icon{border-color:var(--green);background:var(--green);color:var(--bg)}

        /* === RATE LIMIT BOX === */
        .rl-box{margin-top:16px;display:none;padding:24px;border-radius:14px;text-align:center;
            background:rgba(251,191,36,0.06);border:1px solid rgba(251,191,36,0.2);
        }
        .rl-box .rl-countdown{font-family:'JetBrains Mono',monospace;font-size:42px;font-weight:700;
            color:var(--amber);margin:12px 0;letter-spacing:4px}
        .rl-box .rl-msg{font-size:13px;color:var(--text3)}
        .rl-box .rl-bar{width:100%;height:4px;background:rgba(251,191,36,0.1);border-radius:2px;margin-top:14px;overflow:hidden}
        .rl-box .rl-bar-fill{height:100%;background:linear-gradient(90deg,var(--amber),var(--green));border-radius:2px;transition:width 1s linear}

        /* === REPORT === */
        .report-section{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 24px 80px;display:none}
        .report-section.show{display:block;animation:fadeUp 0.6s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}

        .report-hero{text-align:center;margin-bottom:40px;padding:48px 32px;
            border-radius:20px;border:1px solid var(--border);
            background:linear-gradient(135deg,rgba(34,211,238,0.04),rgba(52,211,153,0.04));
            position:relative;overflow:hidden;
        }
        .report-hero::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
            background:conic-gradient(from 0deg,transparent,rgba(34,211,238,0.03),transparent,rgba(52,211,153,0.03),transparent);
            animation:spin-slow 20s linear infinite}
        @keyframes spin-slow{to{transform:rotate(360deg)}}
        .report-hero>*{position:relative;z-index:1}
        .report-ticker{display:inline-block;font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;
            color:var(--cyan);background:rgba(34,211,238,0.1);padding:6px 18px;border-radius:8px;
            border:1px solid rgba(34,211,238,0.2);margin-bottom:16px;letter-spacing:1px}
        .report-company{font-family:'Playfair Display',serif;font-size:clamp(28px,4vw,42px);font-weight:900;margin-bottom:12px}
        .report-live{display:inline-flex;align-items:center;gap:8px;font-size:13px;color:var(--green);font-weight:500}

        /* === METRICS GRID === */
        .metrics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px}
        .metric-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;
            padding:24px 20px;text-align:center;backdrop-filter:blur(10px);transition:all 0.3s;position:relative;overflow:hidden}
        .metric-card:hover{border-color:var(--border2);transform:translateY(-4px);box-shadow:var(--glow-cyan)}
        .metric-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;
            background:linear-gradient(90deg,var(--cyan),var(--green));opacity:0;transition:opacity 0.3s}
        .metric-card:hover::after{opacity:1}
        .mc-label{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text3);font-weight:600;margin-bottom:10px}
        .mc-value{font-family:'JetBrains Mono',monospace;font-size:26px;font-weight:700;color:#fff;margin-bottom:6px}
        .mc-sub{font-size:13px;font-weight:600}
        .mc-sub.up{color:var(--green)}
        .mc-sub.down{color:var(--red)}
        .mc-sub.neutral{color:var(--text3)}

        /* === CHARTS === */
        .charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:32px}
        .chart-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;
            backdrop-filter:blur(10px)}
        .chart-card-title{font-size:14px;font-weight:700;color:var(--text2);margin-bottom:16px;
            display:flex;align-items:center;gap:8px}
        .chart-container{height:200px}

        /* === ANALYSIS SECTIONS === */
        .section-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;
            padding:32px;margin-bottom:20px;backdrop-filter:blur(10px);
            transition:all 0.4s;opacity:0;transform:translateY(20px);
        }
        .section-card.visible{opacity:1;transform:translateY(0)}
        .section-card:hover{border-color:var(--border2)}

        .sc-header{display:flex;align-items:center;gap:12px;margin-bottom:24px}
        .sc-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
        .sc-title{font-size:18px;font-weight:800;letter-spacing:-0.3px}

        /* Section themes */
        .sc-verdict .sc-icon{background:rgba(52,211,153,0.1)}
        .sc-verdict .sc-title{color:var(--green)}
        .sc-decision .sc-icon{background:rgba(251,191,36,0.1)}
        .sc-decision .sc-title{color:var(--amber)}
        .sc-valuation .sc-icon{background:rgba(34,211,238,0.1)}
        .sc-valuation .sc-title{color:var(--cyan)}
        .sc-entry .sc-icon{background:rgba(167,139,250,0.1)}
        .sc-entry .sc-title{color:var(--purple)}
        .sc-risk .sc-icon{background:rgba(248,113,113,0.1)}
        .sc-risk .sc-title{color:var(--red)}
        .sc-ai .sc-icon{background:rgba(34,211,238,0.1)}
        .sc-ai .sc-title{color:var(--cyan)}
        .sc-smallcap .sc-icon{background:rgba(251,191,36,0.1)}
        .sc-smallcap .sc-title{color:var(--amber)}

        /* === VERDICT BADGE === */
        .verdict-pill{display:inline-flex;padding:12px 36px;border-radius:100px;font-size:20px;
            font-weight:900;letter-spacing:2px;text-transform:uppercase;
            animation:verdict-glow 2s ease-in-out infinite alternate}
        .verdict-pill.buy{background:rgba(52,211,153,0.15);color:var(--green);border:2px solid var(--green)}
        .verdict-pill.hold{background:rgba(251,191,36,0.15);color:var(--amber);border:2px solid var(--amber)}
        .verdict-pill.sell{background:rgba(248,113,113,0.15);color:var(--red);border:2px solid var(--red)}
        @keyframes verdict-glow{
            0%{box-shadow:0 0 20px rgba(52,211,153,0.1)}
            100%{box-shadow:0 0 40px rgba(52,211,153,0.2)}
        }
        .verdict-desc{margin-top:12px;font-size:14px;color:var(--text2);font-weight:500}

        /* === TABLES === */
        .data-table{width:100%;border-collapse:collapse}
        .data-table th{padding:14px 16px;text-align:left;font-size:11px;text-transform:uppercase;
            letter-spacing:0.8px;color:var(--text3);font-weight:700;border-bottom:1px solid var(--border);
            background:rgba(34,211,238,0.03)}
        .data-table td{padding:14px 16px;border-bottom:1px solid var(--border);font-size:14px;color:var(--text2);transition:background 0.2s}
        .data-table tr:hover td{background:rgba(34,211,238,0.03)}
        .data-table tr:last-child td{border-bottom:none}

        /* Decision list */
        .dec-list{list-style:none;padding:0}
        .dec-list li{padding:14px 0 14px 36px;position:relative;font-size:14px;color:var(--text2);
            line-height:1.7;border-bottom:1px solid var(--border)}
        .dec-list li:last-child{border-bottom:none}
        .dec-list li::before{content:'';position:absolute;left:0;top:18px;width:20px;height:20px;
            border-radius:50%;background:rgba(34,211,238,0.1);border:2px solid var(--cyan)}
        .dec-list li strong{color:var(--text)}

        /* Price tags */
        .price-tag{display:inline-block;padding:6px 14px;border-radius:8px;font-family:'JetBrains Mono',monospace;
            font-size:14px;font-weight:700}
        .price-tag.buy{background:rgba(52,211,153,0.1);color:var(--green);border:1px solid rgba(52,211,153,0.2)}
        .price-tag.current{background:rgba(34,211,238,0.1);color:var(--cyan);border:1px solid rgba(34,211,238,0.2)}
        .price-tag.profit{background:rgba(251,191,36,0.1);color:var(--amber);border:1px solid rgba(251,191,36,0.2)}
        .price-tag.stop{background:rgba(248,113,113,0.1);color:var(--red);border:1px solid rgba(248,113,113,0.2)}

        /* Signal badges */
        .signal{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:6px;
            font-size:12px;font-weight:700}
        .signal.good{background:rgba(52,211,153,0.1);color:var(--green)}
        .signal.caution{background:rgba(251,191,36,0.1);color:var(--amber)}
        .signal.concern{background:rgba(248,113,113,0.1);color:var(--red)}
        .signal.neutral{background:rgba(148,163,184,0.1);color:var(--text3)}

        /* AI analysis typewriter */
        .ai-text{line-height:1.9;color:var(--text2);font-size:14px;white-space:pre-wrap}
        .ai-expand{display:inline-flex;align-items:center;gap:6px;cursor:pointer;color:var(--cyan);
            font-size:13px;font-weight:600;padding:8px 0;transition:color 0.2s}
        .ai-expand:hover{color:#fff}

        /* Info cards inside sections */
        .info-card{padding:20px;border-radius:12px;margin-bottom:16px;border-left:3px solid}
        .info-card h5{font-size:15px;font-weight:700;margin-bottom:8px}
        .info-card p{font-size:14px;line-height:1.8;color:var(--text2)}
        .info-card.blue{background:rgba(34,211,238,0.04);border-color:var(--cyan)}
        .info-card.blue h5{color:var(--cyan)}
        .info-card.amber{background:rgba(251,191,36,0.04);border-color:var(--amber)}
        .info-card.amber h5{color:var(--amber)}
        .info-card.green{background:rgba(52,211,153,0.04);border-color:var(--green)}
        .info-card.green h5{color:var(--green)}
        .info-card.red{background:rgba(248,113,113,0.04);border-color:var(--red)}
        .info-card.red h5{color:var(--red)}
        .info-card.purple{background:rgba(167,139,250,0.04);border-color:var(--purple)}
        .info-card.purple h5{color:var(--purple)}

        /* === FOOTER === */
        footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:48px 32px;margin-top:40px}
        .footer-disc{max-width:900px;margin:0 auto;padding:28px;border-radius:14px;
            background:rgba(251,191,36,0.04);border:1px solid rgba(251,191,36,0.12)}
        .footer-disc h4{color:var(--amber);font-size:14px;margin-bottom:12px;letter-spacing:0.5px}
        .footer-disc p{color:var(--text3);font-size:13px;line-height:1.9;margin-bottom:8px}
        .footer-copy{text-align:center;color:var(--text3);font-size:12px;margin-top:24px}

        /* === RESPONSIVE === */
        @media(max-width:768px){
            .input-row{grid-template-columns:1fr}
            .metrics-grid{grid-template-columns:1fr 1fr}
            .charts-grid{grid-template-columns:1fr}
            .hero{padding:50px 20px 40px}
            .hero h1{font-size:32px}
            .nav-stats{display:none}
            .section-card{padding:24px 18px}
        }
        @media(max-width:480px){
            .metrics-grid{grid-template-columns:1fr}
            .hero-badges{flex-direction:column;align-items:center}
        }
    </style>
</head>
<body>
    <div class="grid-bg"></div>

    <!-- NAV -->
    <nav>
        <div class="nav-brand">
            <div class="nav-logo">S</div>
            <div class="nav-name">SENTINEL <span>AI</span></div>
        </div>
        <div class="nav-stats">
            <div class="nav-stat"><div class="live-dot"></div> Live Data</div>
            <div class="nav-stat">Reports: <span class="val" id="navReportCount">0</span></div>
            <div class="nav-stat">Quota: <span class="val" id="navQuota">5/hr</span></div>
        </div>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="hero-eyebrow"><div class="live-dot"></div> Real-Time Market Intelligence</div>
        <h1>Smarter Stock Analysis, Instantly</h1>
        <p class="hero-sub">AI-powered research with live market data, actionable entry/exit levels, and professional-grade risk analysis â€” in 60 seconds.</p>
        <div class="hero-badges">
            <div class="h-badge"><span class="ico">â—‰</span> Live Market Data</div>
            <div class="h-badge"><span class="ico">âš¡</span> Agentic AI Engine</div>
            <div class="h-badge"><span class="ico">â—Ž</span> Entry &amp; Exit Targets</div>
            <div class="h-badge"><span class="ico">â–³</span> Risk Scoring</div>
        </div>
    </section>

    <!-- INPUT -->
    <section class="input-section">
        <div class="input-card">
            <div class="input-label">Generate Analysis Report</div>
            <div class="input-row">
                <input class="ipt" type="email" id="email" placeholder="your@email.com" autocomplete="email">
                <div class="input-wrap">
                    <input class="ipt" type="text" id="ticker" placeholder="Ticker or company name..." autocomplete="off">
                    <div class="autocomplete" id="autocomplete"></div>
                </div>
                <button class="btn-analyze" id="btn" onclick="analyze()">Analyze â†’</button>
            </div>
            <div class="helper">
                Start typing to search <strong>100 stocks</strong> (US &amp; India) Â· Enter any valid ticker Â· <a href="https://finance.yahoo.com" target="_blank">Find tickers</a>
                <br>ðŸ“Š <strong>5 free reports</strong> per email per hour
            </div>
            <div class="status-bar" id="status"></div>

            <!-- Loading Steps -->
            <div class="loading-steps" id="loadingSteps">
                <div class="load-step" id="step1"><div class="step-icon">1</div> Fetching live market data...</div>
                <div class="load-step" id="step2"><div class="step-icon">2</div> Running AI valuation analysis...</div>
                <div class="load-step" id="step3"><div class="step-icon">3</div> Calculating entry &amp; exit targets...</div>
                <div class="load-step" id="step4"><div class="step-icon">4</div> Generating risk assessment...</div>
            </div>

            <!-- Rate Limit -->
            <div class="rl-box" id="rateLimitBox">
                <div style="font-size:14px;font-weight:600;color:var(--amber);margin-bottom:4px">Report limit reached</div>
                <div class="rl-countdown" id="rlCountdown">--:--</div>
                <div class="rl-msg" id="rlComeback"></div>
                <div class="rl-bar"><div class="rl-bar-fill" id="rlProgress" style="width:0%"></div></div>
            </div>
        </div>
    </section>

    <!-- REPORT -->
    <section class="report-section" id="report">
        <div class="report-hero">
            <div class="report-ticker" id="tickerTag"></div>
            <div class="report-company" id="companyName"></div>
            <div class="report-live" id="timestamp"><div class="live-dot"></div></div>
        </div>

        <div class="metrics-grid" id="metrics"></div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-card-title">â—‰ Valuation Metrics</div>
                <div class="chart-container"><canvas id="valChart"></canvas></div>
            </div>
            <div class="chart-card">
                <div class="chart-card-title">â—‰ Price Trend</div>
                <div class="chart-container"><canvas id="trendChart"></canvas></div>
            </div>
        </div>

        <div id="analysisContainer"></div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="footer-disc">
            <h4>âš  Important Disclaimers</h4>
            <p><strong>NOT FINANCIAL ADVICE:</strong> This analysis is for educational and informational purposes only. Always consult with licensed financial professionals before making investment decisions.</p>
            <p><strong>DATA ACCURACY:</strong> While we use real-time market data, we cannot guarantee 100% accuracy. Verify information through multiple sources before acting.</p>
            <p><strong>RISK WARNING:</strong> All investments carry risk of loss. Past performance does not guarantee future results.</p>
        </div>
        <div class="footer-copy">Â© 2026 Sentinel AI Research Â· Real-Time Investment Intelligence</div>
    </footer>

<script>
// ============================================================
// STOCKS DATABASE
// ============================================================
const stocks = [
    {t:'AAPL',n:'Apple Inc.'},{t:'MSFT',n:'Microsoft Corporation'},{t:'GOOGL',n:'Alphabet Inc. (Google)'},{t:'AMZN',n:'Amazon.com Inc.'},
    {t:'NVDA',n:'NVIDIA Corporation'},{t:'META',n:'Meta Platforms (Facebook)'},{t:'TSLA',n:'Tesla Inc.'},{t:'BRK.B',n:'Berkshire Hathaway'},
    {t:'LLY',n:'Eli Lilly and Company'},{t:'AVGO',n:'Broadcom Inc.'},{t:'JPM',n:'JPMorgan Chase & Co.'},{t:'V',n:'Visa Inc.'},
    {t:'UNH',n:'UnitedHealth Group'},{t:'XOM',n:'Exxon Mobil'},{t:'WMT',n:'Walmart Inc.'},{t:'MA',n:'Mastercard Inc.'},
    {t:'PG',n:'Procter & Gamble'},{t:'JNJ',n:'Johnson & Johnson'},{t:'HD',n:'Home Depot'},{t:'ORCL',n:'Oracle Corporation'},
    {t:'COST',n:'Costco Wholesale'},{t:'NFLX',n:'Netflix Inc.'},{t:'BAC',n:'Bank of America'},{t:'CRM',n:'Salesforce Inc.'},
    {t:'ABBV',n:'AbbVie Inc.'},{t:'CVX',n:'Chevron Corporation'},{t:'AMD',n:'Advanced Micro Devices'},{t:'KO',n:'Coca-Cola Company'},
    {t:'PEP',n:'PepsiCo Inc.'},{t:'MRK',n:'Merck & Co.'},{t:'ADBE',n:'Adobe Inc.'},{t:'TMO',n:'Thermo Fisher Scientific'},
    {t:'CSCO',n:'Cisco Systems'},{t:'ACN',n:'Accenture'},{t:'MCD',n:"McDonald's Corporation"},{t:'LIN',n:'Linde plc'},
    {t:'ABT',n:'Abbott Laboratories'},{t:'WFC',n:'Wells Fargo'},{t:'TXN',n:'Texas Instruments'},{t:'INTC',n:'Intel Corporation'},
    {t:'DIS',n:'Walt Disney Company'},{t:'PM',n:'Philip Morris'},{t:'CMCSA',n:'Comcast Corporation'},{t:'NKE',n:'Nike Inc.'},
    {t:'QCOM',n:'Qualcomm Inc.'},{t:'GE',n:'General Electric'},{t:'INTU',n:'Intuit Inc.'},{t:'VZ',n:'Verizon Communications'},
    {t:'AMAT',n:'Applied Materials'},{t:'CAT',n:'Caterpillar Inc.'},
    {t:'RELIANCE.NS',n:'Reliance Industries'},{t:'TCS.NS',n:'Tata Consultancy Services'},{t:'HDFCBANK.NS',n:'HDFC Bank'},
    {t:'INFY',n:'Infosys Limited'},{t:'HINDUNILVR.NS',n:'Hindustan Unilever'},{t:'ICICIBANK.NS',n:'ICICI Bank'},
    {t:'SBIN.NS',n:'State Bank of India'},{t:'BHARTIARTL.NS',n:'Bharti Airtel'},{t:'ITC.NS',n:'ITC Limited'},
    {t:'KOTAKBANK.NS',n:'Kotak Mahindra Bank'},{t:'LT.NS',n:'Larsen & Toubro'},{t:'AXISBANK.NS',n:'Axis Bank'},
    {t:'BAJFINANCE.NS',n:'Bajaj Finance'},{t:'ASIANPAINT.NS',n:'Asian Paints'},{t:'MARUTI.NS',n:'Maruti Suzuki'},
    {t:'TITAN.NS',n:'Titan Company'},{t:'SUNPHARMA.NS',n:'Sun Pharmaceutical'},{t:'ULTRACEMCO.NS',n:'UltraTech Cement'},
    {t:'NESTLEIND.NS',n:'NestlÃ© India'},{t:'ONGC.NS',n:'Oil & Natural Gas Corp'},{t:'NTPC.NS',n:'NTPC Limited'},
    {t:'TATAMOTORS.NS',n:'Tata Motors'},{t:'POWERGRID.NS',n:'Power Grid Corporation'},{t:'TATASTEEL.NS',n:'Tata Steel'},
    {t:'M&M.NS',n:'Mahindra & Mahindra'},{t:'JSWSTEEL.NS',n:'JSW Steel'},{t:'ADANIENT.NS',n:'Adani Enterprises'},
    {t:'WIPRO.NS',n:'Wipro Limited'},{t:'COALINDIA.NS',n:'Coal India'},{t:'HCLTECH.NS',n:'HCL Technologies'},
    {t:'BAJAJFINSV.NS',n:'Bajaj Finserv'},{t:'DIVISLAB.NS',n:"Divi's Laboratories"},{t:'GRASIM.NS',n:'Grasim Industries'},
    {t:'TECHM.NS',n:'Tech Mahindra'},{t:'BRITANNIA.NS',n:'Britannia Industries'},{t:'EICHERMOT.NS',n:'Eicher Motors'},
    {t:'APOLLOHOSP.NS',n:'Apollo Hospitals'},{t:'INDUSINDBK.NS',n:'IndusInd Bank'},{t:'TRENT.NS',n:'Trent Limited'},
    {t:'ADANIPORTS.NS',n:'Adani Ports'},{t:'HINDALCO.NS',n:'Hindalco Industries'},{t:'DRREDDY.NS',n:"Dr. Reddy's Labs"},
    {t:'CIPLA.NS',n:'Cipla Limited'},{t:'HEROMOTOCO.NS',n:'Hero MotoCorp'},{t:'SHREECEM.NS',n:'Shree Cement'},
    {t:'BAJAJ-AUTO.NS',n:'Bajaj Auto'},{t:'BPCL.NS',n:'Bharat Petroleum'},{t:'SIEMENS.NS',n:'Siemens India'},
    {t:'KPIT.NS',n:'KPIT Technologies'},{t:'DIXON.NS',n:'Dixon Technologies'}
];

let valChart, trendChart, countdownInterval = null;

// ============================================================
// AUTOCOMPLETE
// ============================================================
const tickerInput = document.getElementById('ticker');
const autocompleteDiv = document.getElementById('autocomplete');

tickerInput.addEventListener('input', function() {
    const val = this.value.trim().toUpperCase();
    autocompleteDiv.innerHTML = '';
    if (!val) { autocompleteDiv.classList.remove('show'); return; }
    const matches = stocks.filter(s => s.t.includes(val) || s.n.toUpperCase().includes(val)).slice(0, 10);
    if (!matches.length) { autocompleteDiv.classList.remove('show'); return; }
    matches.forEach(s => {
        const div = document.createElement('div');
        div.className = 'ac-item';
        div.innerHTML = `<span class="ac-ticker">${s.t}</span><span class="ac-name">${s.n}</span>`;
        div.onclick = () => { tickerInput.value = s.t; autocompleteDiv.classList.remove('show'); };
        autocompleteDiv.appendChild(div);
    });
    autocompleteDiv.classList.add('show');
});
document.addEventListener('click', e => { if (e.target !== tickerInput) autocompleteDiv.classList.remove('show'); });
document.getElementById('email').addEventListener('keypress', e => { if (e.key === 'Enter') tickerInput.focus(); });
tickerInput.addEventListener('keypress', e => { if (e.key === 'Enter') analyze(); });

// ============================================================
// STATUS & LOADING
// ============================================================
function showStatus(msg, type) {
    const s = document.getElementById('status');
    s.innerHTML = msg;
    s.className = 'status-bar show ' + type;
}

function showLoadingSteps() {
    const box = document.getElementById('loadingSteps');
    box.classList.add('show');
    const steps = ['step1','step2','step3','step4'];
    steps.forEach(s => { document.getElementById(s).className = 'load-step'; });
    let i = 0;
    const interval = setInterval(() => {
        if (i > 0) document.getElementById(steps[i-1]).classList.replace('active','done');
        if (i < steps.length) { document.getElementById(steps[i]).classList.add('active'); i++; }
        else clearInterval(interval);
    }, 8000);
    box._interval = interval;
    // Kick off first step immediately
    document.getElementById(steps[0]).classList.add('active');
}
function hideLoadingSteps() {
    const box = document.getElementById('loadingSteps');
    if (box._interval) clearInterval(box._interval);
    box.classList.remove('show');
}

// ============================================================
// RATE LIMIT COUNTDOWN
// ============================================================
function hideRateLimitBox() {
    document.getElementById('rateLimitBox').style.display = 'none';
    if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
}
function showRateLimitCountdown(data) {
    const box = document.getElementById('rateLimitBox');
    const countdownEl = document.getElementById('rlCountdown');
    const comebackEl = document.getElementById('rlComeback');
    const progressEl = document.getElementById('rlProgress');
    let totalSeconds = data.retry_after_seconds || (data.retry_after_minutes || 5) * 60;
    const targetTime = new Date(Date.now() + totalSeconds * 1000);
    const comebackStr = targetTime.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    comebackEl.textContent = 'Come back at ' + comebackStr + ' Â· ' + (data.requests_limit || 5) + ' fresh reports will be available';
    box.style.display = 'block';
    if (countdownInterval) clearInterval(countdownInterval);
    const startSeconds = totalSeconds;
    function tick() {
        const remaining = Math.max(0, Math.floor((targetTime - Date.now()) / 1000));
        const m = Math.floor(remaining / 60), s = remaining % 60;
        countdownEl.textContent = String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
        progressEl.style.width = Math.min(100, ((startSeconds - remaining) / startSeconds) * 100) + '%';
        if (remaining <= 0) {
            clearInterval(countdownInterval); countdownInterval = null;
            countdownEl.textContent = '00:00'; countdownEl.style.color = 'var(--green)';
            comebackEl.textContent = 'âœ“ Quota refreshed â€” you can generate reports again';
            progressEl.style.width = '100%';
            box.style.borderColor = 'rgba(52,211,153,0.3)'; box.style.background = 'rgba(52,211,153,0.04)';
        }
    }
    tick();
    countdownInterval = setInterval(tick, 1000);
}

// ============================================================
// MAIN ANALYZE
// ============================================================
async function analyze() {
    const email = document.getElementById('email').value.trim();
    const ticker = document.getElementById('ticker').value.trim().toUpperCase();
    const btn = document.getElementById('btn');
    const report = document.getElementById('report');
    autocompleteDiv.classList.remove('show');
    if (!email || !ticker) { showStatus('Enter both email and ticker to continue', 'error'); return; }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showStatus('Enter a valid email address', 'error'); return; }

    // Pre-check rate limit
    try {
        const rl = await fetch('/api/check-rate-limit', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email}) });
        const rld = await rl.json();
        if (!rld.allowed) { showStatus(rld.reason, 'error'); showRateLimitCountdown(rld); return; }
        else hideRateLimitBox();
    } catch(e) {}

    btn.disabled = true; btn.textContent = 'Analyzing...'; btn.classList.add('loading');
    report.classList.remove('show'); hideRateLimitBox();
    showStatus('Analyzing ' + ticker + ' with live market data...', 'info');
    showLoadingSteps();

    try {
        const res = await fetch('/api/generate-report', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({company_name:ticker, email}) });
        if (res.status === 429) {
            const rld = await res.json().catch(()=>({}));
            showStatus(rld.reason || rld.detail || 'Too many requests', 'error');
            if (rld.retry_after_seconds || rld.retry_after_minutes) showRateLimitCountdown(rld);
            return;
        }
        if (res.status === 503 || res.status === 504) {
            const err = await res.json().catch(()=>({}));
            showStatus(err.detail || 'Service temporarily busy. Try again in 30 seconds.', 'error'); return;
        }
        if (!res.ok) { const err = await res.json().catch(()=>({})); throw new Error(err.detail || err.message || 'Analysis failed'); }

        const data = await res.json();
        if (!data.success || !data.live_data) throw new Error('No data available for this ticker');

        let qmsg = '';
        if (data.rate_limit) {
            const r = data.rate_limit.remaining;
            document.getElementById('navQuota').textContent = r + '/hr';
            qmsg = r === 0 ? ' Â· Last free report this hour' : ' Â· ' + r + ' report' + (r!==1?'s':'') + ' remaining';
        }
        if (data.report_number) document.getElementById('navReportCount').textContent = data.report_number;
        showStatus('âœ“ Analysis complete' + qmsg, 'success');
        displayReport(data);
        document.getElementById('ticker').value = '';
    } catch(error) {
        let msg = error.message;
        if (msg === 'Failed to fetch') msg = 'Could not connect to server.';
        else if (msg.toLowerCase().includes('rate limit') || msg.toLowerCase().includes('too many') || msg.toLowerCase().includes('temporarily'))
            msg = 'Market data provider is busy. Please wait 2-3 minutes.';
        showStatus(msg, 'error');
    } finally {
        btn.disabled = false; btn.textContent = 'Analyze â†’'; btn.classList.remove('loading');
        hideLoadingSteps();
    }
}

// ============================================================
// DISPLAY REPORT
// ============================================================
function displayReport(data) {
    const d = data.live_data;
    const curr = d.currency === 'INR' ? 'â‚¹' : '$';
    const price = d.current_price;

    document.getElementById('tickerTag').textContent = d.ticker;
    document.getElementById('companyName').textContent = d.company_name || d.ticker;
    document.getElementById('timestamp').innerHTML = `<div class="live-dot"></div> LIVE Â· ${d.data_timestamp}`;

    document.getElementById('metrics').innerHTML = `
        <div class="metric-card">
            <div class="mc-label">Current Price</div>
            <div class="mc-value">${curr}${price.toLocaleString()}</div>
            <div class="mc-sub ${d.price_change >= 0 ? 'up' : 'down'}">
                ${d.price_change >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(d.price_change).toFixed(2)} (${d.price_change_pct.toFixed(2)}%)
            </div>
        </div>
        <div class="metric-card">
            <div class="mc-label">P/E Ratio</div>
            <div class="mc-value">${d.pe_ratio || 'N/A'}</div>
            <div class="mc-sub neutral">Trailing TTM</div>
        </div>
        <div class="metric-card">
            <div class="mc-label">Market Cap</div>
            <div class="mc-value">${formatCap(d.market_cap)}</div>
            <div class="mc-sub neutral">${d.currency}</div>
        </div>
        <div class="metric-card">
            <div class="mc-label">52-Week Range</div>
            <div class="mc-value" style="font-size:18px">${curr}${d.week52_low} â€” ${curr}${d.week52_high}</div>
            <div class="mc-sub neutral">Low / High</div>
        </div>
    `;

    createCharts(d);
    createAnalysisSections(data.report, d);
    document.getElementById('report').classList.add('show');
    setTimeout(() => document.getElementById('report').scrollIntoView({behavior:'smooth',block:'start'}), 200);
    // Animate section reveals
    setTimeout(animateSections, 400);
}

function animateSections() {
    const cards = document.querySelectorAll('.section-card');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); observer.unobserve(e.target); }});
    }, {threshold:0.1});
    cards.forEach(c => observer.observe(c));
}

// ============================================================
// ANALYSIS SECTIONS
// ============================================================
function createAnalysisSections(report, d) {
    const curr = d.currency === 'INR' ? 'â‚¹' : '$';
    const price = d.current_price;
    const pe = parseFloat(d.pe_ratio) || 0;
    let verdict = 'HOLD', vc = 'hold';
    if (pe > 0 && pe < 15 && d.price_change_pct > 0) { verdict = 'BUY'; vc = 'buy'; }
    else if (pe > 40 || d.price_change_pct < -5) { verdict = 'SELL'; vc = 'sell'; }

    const html = `
    <!-- VERDICT -->
    <div class="section-card sc-verdict" style="text-align:center">
        <div class="sc-header" style="justify-content:center">
            <div class="sc-icon">â—Ž</div><div class="sc-title">Investment Verdict</div>
        </div>
        <div class="verdict-pill ${vc}">${verdict}</div>
        <div class="verdict-desc">
            ${verdict==='BUY'?'Favorable opportunity at current levels':verdict==='SELL'?'Caution advised â€” consider exit strategy':'Hold position â€” monitor conditions'}
        </div>
    </div>

    <!-- KEY DECISIONS -->
    <div class="section-card sc-decision">
        <div class="sc-header"><div class="sc-icon">â–³</div><div class="sc-title">Key Decision Points</div></div>
        <ul class="dec-list">
            <li><strong>Price Action:</strong> Currently ${curr}${price.toLocaleString()} with ${d.price_change>=0?'positive':'negative'} daily momentum (${d.price_change_pct.toFixed(2)}%)</li>
            <li><strong>Valuation:</strong> P/E of ${d.pe_ratio} suggests ${pe<15?'undervalued opportunity':pe<25?'fair valuation':'premium pricing'}</li>
            <li><strong>Market Position:</strong> ${formatCap(d.market_cap)} market cap â€” ${d.market_cap>100e9?'large-cap':d.market_cap>10e9?'mid-cap':'small-cap'}</li>
            <li><strong>Sector:</strong> ${d.sector} Â· ${d.industry}</li>
            <li><strong>Range Position:</strong> Trading at ${((price/d.week52_high)*100).toFixed(0)}% of 52-week high</li>
        </ul>
    </div>

    <!-- VALUATION TABLE -->
    <div class="section-card sc-valuation">
        <div class="sc-header"><div class="sc-icon">â—‰</div><div class="sc-title">Valuation Analysis</div></div>
        <table class="data-table">
            <tr><th>Metric</th><th>Value</th><th>Assessment</th></tr>
            <tr>
                <td><strong>P/E Ratio</strong><br><span style="font-size:11px;color:var(--text3)">Price-to-Earnings</span></td>
                <td><span class="signal ${pe<15?'good':pe<25?'neutral':'caution'}">${d.pe_ratio}</span></td>
                <td>${pe<15?'Below average â€” potential bargain':pe<25?'Fairly priced relative to earnings':'Trading at premium â€” growth must justify price'}</td>
            </tr>
            <tr>
                <td><strong>P/B Ratio</strong><br><span style="font-size:11px;color:var(--text3)">Price-to-Book</span></td>
                <td><span class="signal ${parseFloat(d.pb_ratio)<3?'good':'caution'}">${d.pb_ratio}</span></td>
                <td>${parseFloat(d.pb_ratio)<3?'Reasonable asset valuation':'Investors paying for intangibles and growth'}</td>
            </tr>
            <tr>
                <td><strong>Profit Margin</strong></td>
                <td><span class="signal ${parseFloat(d.profit_margin)>15?'good':parseFloat(d.profit_margin)>8?'neutral':'concern'}">${d.profit_margin}%</span></td>
                <td>${parseFloat(d.profit_margin)>15?'Strong pricing power and efficiency':parseFloat(d.profit_margin)>8?'Moderate profitability':'Thin margins â€” competitive pressure'}</td>
            </tr>
            <tr>
                <td><strong>ROE</strong><br><span style="font-size:11px;color:var(--text3)">Return on Equity</span></td>
                <td><span class="signal ${parseFloat(d.roe)>15?'good':'neutral'}">${d.roe}%</span></td>
                <td>${parseFloat(d.roe)>15?'Efficient capital allocation â€” strong returns':'Moderate capital efficiency'}</td>
            </tr>
            <tr>
                <td><strong>Dividend Yield</strong></td>
                <td><span class="signal ${parseFloat(d.dividend_yield)>3?'good':parseFloat(d.dividend_yield)>1?'neutral':'caution'}">${d.dividend_yield}%</span></td>
                <td>${parseFloat(d.dividend_yield)>3?'Strong income component':parseFloat(d.dividend_yield)>1?'Some passive income plus growth':'Growth-focused â€” reinvests profits'}</td>
            </tr>
        </table>
    </div>

    <!-- ENTRY & EXIT -->
    <div class="section-card sc-entry">
        <div class="sc-header"><div class="sc-icon">â¬¡</div><div class="sc-title">Entry &amp; Exit Strategy</div></div>
        <table class="data-table">
            <tr><th>Level</th><th>Price</th><th>Action</th></tr>
            <tr><td>Buy Zone</td><td><span class="price-tag buy">Below ${curr}${(price*0.95).toFixed(2)}</span></td><td>Strong accumulation â€” build position</td></tr>
            <tr><td>Current Price</td><td><span class="price-tag current">${curr}${price.toLocaleString()}</span></td><td>Monitor for confirmation signals</td></tr>
            <tr><td>Take Profit 1</td><td><span class="price-tag profit">Above ${curr}${(price*1.10).toFixed(2)}</span></td><td>Book 30â€“50% profits at +10%</td></tr>
            <tr><td>Take Profit 2</td><td><span class="price-tag profit">Above ${curr}${(price*1.20).toFixed(2)}</span></td><td>Exit remaining at +20%</td></tr>
            <tr><td>Stop Loss</td><td><span class="price-tag stop">Below ${curr}${(price*0.90).toFixed(2)}</span></td><td>Strict exit â€” limit downside to 10%</td></tr>
        </table>
    </div>

    <!-- RISK -->
    <div class="section-card sc-risk">
        <div class="sc-header"><div class="sc-icon">âš </div><div class="sc-title">Risk Assessment</div></div>
        <table class="data-table">
            <tr><th>Factor</th><th>Metric</th><th>Assessment</th></tr>
            <tr><td>Debt Level</td><td><span class="signal ${parseFloat(d.debt_to_equity)>1.5?'concern':parseFloat(d.debt_to_equity)>0.8?'caution':'good'}">${d.debt_to_equity}</span></td>
                <td>${parseFloat(d.debt_to_equity)>1.5?'High leverage â€” monitor carefully':parseFloat(d.debt_to_equity)>0.8?'Moderate debt levels':'Conservative balance sheet'}</td></tr>
            <tr><td>Liquidity</td><td><span class="signal ${parseFloat(d.current_ratio)>1.5?'good':parseFloat(d.current_ratio)>1?'caution':'concern'}">${d.current_ratio}</span></td>
                <td>${parseFloat(d.current_ratio)>1.5?'Strong â€” can meet obligations':parseFloat(d.current_ratio)>1?'Adequate coverage':'Liquidity concerns'}</td></tr>
            <tr><td>Volatility</td><td><span class="signal ${Math.abs(parseFloat(d.beta))>1.5?'concern':Math.abs(parseFloat(d.beta))<0.8?'good':'neutral'}">${d.beta}</span></td>
                <td>${Math.abs(parseFloat(d.beta))>1.5?'High volatility â€” larger price swings':Math.abs(parseFloat(d.beta))<0.8?'Lower volatility than market':'Average market volatility'}</td></tr>
            <tr><td>Sector</td><td><span class="signal neutral">${d.sector}</span></td><td>Monitor sector trends and regulatory changes</td></tr>
        </table>
    </div>

    <!-- AI ANALYSIS -->
    <div class="section-card sc-ai">
        <div class="sc-header"><div class="sc-icon">âš¡</div><div class="sc-title">AI-Powered Analysis</div></div>
        <div class="info-card blue"><h5>Market Overview</h5>
            <p>${d.company_name||d.ticker} operates in ${d.sector} (${d.industry}). Trading at ${curr}${price.toLocaleString()}, positioned at ${((price/d.week52_high)*100).toFixed(0)}% of 52-week high. Market cap: ${formatCap(d.market_cap)} â€” ${d.market_cap>100e9?'large-cap':d.market_cap>10e9?'mid-cap':'small-cap'}.</p>
        </div>
        <div class="info-card amber"><h5>Financial Health</h5>
            <p>Profit margin: ${d.profit_margin}% Â· ROE: ${d.roe}% â€” ${parseFloat(d.roe)>15?'strong':'moderate'} capital efficiency. P/E of ${d.pe_ratio} suggests ${pe<15?'undervaluation':pe<25?'fair value':'premium'}. Dividend yield: ${d.dividend_yield}%.</p>
        </div>
        <div class="info-card green"><h5>Technical Momentum</h5>
            <p>${d.price_change>=0?'Positive':'Negative'} momentum today (${Math.abs(d.price_change_pct).toFixed(2)}%). ${price<d.week52_low*1.1?'Near 52-week lows â€” potential value entry':price>d.week52_high*0.9?'Approaching highs â€” strong momentum':'Mid-range â€” balanced risk-reward'}. Beta: ${d.beta}.</p>
        </div>
        <div class="info-card red"><h5>Risks &amp; Catalysts</h5>
            <p>D/E ratio: ${d.debt_to_equity} â€” ${parseFloat(d.debt_to_equity)>1.5?'elevated leverage':'manageable debt'}. Current ratio: ${d.current_ratio} â€” ${parseFloat(d.current_ratio)>1.5?'strong':'adequate'} liquidity. Monitor earnings, guidance, and sector trends.</p>
        </div>
        <div class="info-card purple"><h5>Recommendation</h5>
            <p style="font-weight:600">${verdict==='BUY'?'BUY â€” Attractive valuation and solid fundamentals. Consider initiating position with proper sizing.':verdict==='SELL'?'SELL/AVOID â€” Stretched valuation. Take profits or wait for better entry.':'HOLD â€” Fair value. Maintain positions, monitor catalysts. New investors may wait for pullback.'}</p>
        </div>
        <div style="margin-top:20px;padding:20px;border-radius:12px;background:var(--bg);border:1px solid var(--border)">
            <span class="ai-expand" onclick="document.getElementById('fullAI').style.display=document.getElementById('fullAI').style.display==='none'?'block':'none'">
                â–¸ View full AI analysis
            </span>
            <div id="fullAI" class="ai-text" style="display:none;margin-top:12px">${report}</div>
        </div>
    </div>

    <!-- SMALL CAPS -->
    <div class="section-card sc-smallcap">
        <div class="sc-header"><div class="sc-icon">â˜…</div><div class="sc-title">10-Year Small-Cap Wealth Builders</div></div>
        <p style="font-size:13px;color:var(--text3);margin-bottom:16px">High-potential picks in <strong id="smallCapSector" style="color:var(--amber)">${d.sector}</strong> for long-term wealth creation:</p>
        <div id="smallCapTable"></div>
        <div class="info-card amber" style="margin-top:16px">
            <p><strong>Advisory:</strong> Small caps carry higher risk but offer superior long-term potential. Recommendations match <strong id="smallCapTicker">${d.ticker}</strong>'s sector/region. Suitable for 10+ year horizon. Diversify across 5â€“8 picks.</p>
        </div>
    </div>
    `;
    document.getElementById('analysisContainer').innerHTML = html;
    formatAIAnalysis(report);
    generateSmallCapRecommendations(d);
}

// ============================================================
// AI ANALYSIS FORMATTING (EDUCATIONAL TABLES)
// ============================================================
function formatAIAnalysis(rawText) {
    const sections = [
        {title:'Valuation Check',icon:'â—‰',color:'var(--cyan)',data:extractValuationInsights(rawText)},
        {title:'Price Momentum',icon:'â–²',color:'var(--green)',data:extractMomentumInsights(rawText)},
        {title:'Risk Factors',icon:'âš ',color:'var(--red)',data:extractRiskInsights(rawText)},
        {title:'Strategy',icon:'â—Ž',color:'var(--purple)',data:extractStrategyInsights(rawText)}
    ];
    let html = `<div style="padding:16px;border-radius:12px;margin-bottom:20px;background:rgba(34,211,238,0.04);border:1px solid rgba(34,211,238,0.15);text-align:center">
        <div style="font-size:15px;font-weight:700;color:var(--cyan);margin-bottom:6px">AI Insight Breakdown</div>
        <div style="font-size:12px;color:var(--text3)">Look for <span class="signal good">Good</span> <span class="signal caution">Caution</span> <span class="signal concern">Warning</span> signals</div>
    </div>`;
    sections.forEach(s => {
        if (!s.data || !s.data.length) return;
        html += `<div style="margin-bottom:16px"><div style="font-size:14px;font-weight:700;color:${s.color};margin-bottom:10px;display:flex;align-items:center;gap:8px">${s.icon} ${s.title}</div>
        <table class="data-table"><tr><th style="width:25%">Factor</th><th style="width:22%">Status</th><th>Insight</th></tr>`;
        s.data.forEach(r => {
            html += `<tr><td><strong>${r.factor}</strong></td><td><span class="signal ${r.signal}">${r.status}</span></td><td style="font-size:13px">${r.explanation}</td></tr>`;
        });
        html += `</table></div>`;
    });
    document.getElementById('aiAnalysisFormatted')?.remove(); // Prevent duplication
    const container = document.getElementById('fullAI');
    if (container) container.insertAdjacentHTML('beforebegin', `<div id="aiAnalysisFormatted">${html}</div>`);
}

function extractValuationInsights(text) {
    const insights = [];
    if (text.toLowerCase().includes('p/e') || text.toLowerCase().includes('price-to-earnings')) {
        const m = text.match(/p\/e.*?(\d+\.?\d*)/i);
        if (m) { const pe = parseFloat(m[1]); insights.push({factor:'P/E Ratio',status:pe<15?'Undervalued':pe<25?'Fair':'Expensive',signal:pe<15?'good':pe<25?'neutral':'caution',explanation:pe<15?'Below average â€” potential buying opportunity.':pe<25?'Reasonably priced relative to earnings.':'Premium pricing â€” growth must justify.'}); }
    }
    if (text.toLowerCase().includes('undervalued')) insights.push({factor:'Overall Valuation',status:'Below Fair Value',signal:'good',explanation:'Trading below intrinsic worth â€” buying opportunity for long-term investors.'});
    else if (text.toLowerCase().includes('overvalued')) insights.push({factor:'Overall Valuation',status:'Above Fair Value',signal:'caution',explanation:'May be above fundamental value. Consider waiting for better entry.'});
    if (text.toLowerCase().includes('margin')) { const m = text.match(/margin.*?(\d+\.?\d*)%/i); if (m) { const v = parseFloat(m[1]); insights.push({factor:'Margins',status:v>15?'Healthy':v>8?'Moderate':'Weak',signal:v>15?'good':v>8?'neutral':'concern',explanation:`${v}% margins â€” ${v>15?'strong pricing power':'competitive pressure on profitability'}.`}); }}
    if (text.toLowerCase().includes('growth')) insights.push({factor:'Growth',status:text.toLowerCase().includes('strong growth')?'Strong':'Moderate',signal:text.toLowerCase().includes('strong growth')?'good':'neutral',explanation:text.toLowerCase().includes('strong growth')?'Above-average growth expected.':'Steady growth trajectory.'});
    return insights.length ? insights : [{factor:'Valuation',status:'See Full Report',signal:'neutral',explanation:'Detailed valuation in the AI analysis above.'}];
}
function extractMomentumInsights(text) {
    const i = [];
    if (text.toLowerCase().includes('bullish') || text.toLowerCase().includes('uptrend')) i.push({factor:'Trend',status:'Bullish',signal:'good',explanation:'Positive momentum and uptrend detected.'});
    else if (text.toLowerCase().includes('bearish') || text.toLowerCase().includes('downtrend')) i.push({factor:'Trend',status:'Bearish',signal:'concern',explanation:'Negative momentum â€” caution advised.'});
    if (text.toLowerCase().includes('support')) i.push({factor:'Support',status:'Identified',signal:'good',explanation:'Key support levels provide downside protection.'});
    if (text.toLowerCase().includes('resistance')) i.push({factor:'Resistance',status:'Present',signal:'caution',explanation:'Overhead resistance may cap near-term upside.'});
    return i.length ? i : [{factor:'Momentum',status:'See Full Report',signal:'neutral',explanation:'Detailed analysis in the AI report.'}];
}
function extractRiskInsights(text) {
    const i = [];
    if (text.toLowerCase().includes('debt')) i.push({factor:'Debt',status:text.toLowerCase().includes('high debt')?'High':'Manageable',signal:text.toLowerCase().includes('high debt')?'concern':'good',explanation:text.toLowerCase().includes('high debt')?'Elevated leverage â€” monitor closely.':'Debt levels are manageable.'});
    if (text.toLowerCase().includes('competition') || text.toLowerCase().includes('competitive')) i.push({factor:'Competition',status:'Present',signal:'caution',explanation:'Competitive landscape poses ongoing risk.'});
    if (text.toLowerCase().includes('regulation') || text.toLowerCase().includes('regulatory')) i.push({factor:'Regulatory',status:'Monitor',signal:'caution',explanation:'Regulatory environment could impact operations.'});
    return i.length ? i : [{factor:'Risk',status:'See Full Report',signal:'neutral',explanation:'Detailed risk breakdown in AI analysis.'}];
}
function extractStrategyInsights(text) {
    const i = [];
    if (text.toLowerCase().includes('buy') && !text.toLowerCase().includes('don\'t buy')) i.push({factor:'Action',status:'Consider Buying',signal:'good',explanation:'AI identifies favorable entry conditions.'});
    else if (text.toLowerCase().includes('sell') || text.toLowerCase().includes('avoid')) i.push({factor:'Action',status:'Consider Selling',signal:'concern',explanation:'AI suggests caution at current levels.'});
    else i.push({factor:'Action',status:'Hold & Monitor',signal:'neutral',explanation:'Wait for clearer signals before acting.'});
    if (text.toLowerCase().includes('long-term') || text.toLowerCase().includes('long term')) i.push({factor:'Horizon',status:'Long-Term',signal:'good',explanation:'Best suited for patient, long-term investors.'});
    return i;
}

// ============================================================
// SMALL CAP RECOMMENDATIONS
// ============================================================
function generateSmallCapRecommendations(d) {
    const sector = d.sector || 'Technology';
    const isIndian = d.ticker && (d.ticker.includes('.NS') || d.ticker.includes('.BO') || d.currency === 'INR');
    const db = {
        'Technology_US':[{name:'Palantir Technologies (PLTR)',sector:'AI/Big Data',strengths:'Government + enterprise AI platform',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'CrowdStrike (CRWD)',sector:'Cybersecurity',strengths:'Cloud-native endpoint protection leader',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Datadog (DDOG)',sector:'Cloud Monitoring',strengths:'Unified observability platform',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'MongoDB (MDB)',sector:'Database',strengths:'Modern document database, developer-first',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Cloudflare (NET)',sector:'Edge Computing',strengths:'CDN, security, serverless compute',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Unity Software (U)',sector:'3D/Gaming Engine',strengths:'Real-time 3D creation platform',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Technology_India':[{name:'Kaynes Technology',sector:'IoT/Defense',strengths:'Defense electronics, govt contracts',potential:'Exceptional',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Dixon Technologies',sector:'Electronics Mfg',strengths:'PLI beneficiary, contract manufacturing',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Persistent Systems',sector:'Software',strengths:'Digital engineering, healthcare IT',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Coforge',sector:'IT Services',strengths:'Insurance & banking tech, BPA leader',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'KPIT Technologies',sector:'Auto Software',strengths:'EV software, T25 auto clients',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Happiest Minds',sector:'Digital',strengths:'Cloud, IoT, security services',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Financial Services_US':[{name:'SoFi Technologies (SOFI)',sector:'Fintech',strengths:'Digital banking, lending, investing',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Markel Group (MKL)',sector:'Specialty Insurance',strengths:'Mini Berkshire model, diversified',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Shift4 Payments (FOUR)',sector:'Payments',strengths:'Integrated payment processing',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Ally Financial (ALLY)',sector:'Digital Banking',strengths:'Top online bank, auto lending',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Houlihan Lokey (HLI)',sector:'Investment Banking',strengths:'M&A advisory, restructuring',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Kinsale Capital (KNSL)',sector:'Specialty Insurance',strengths:'E&S insurance, tech-driven underwriting',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Financial Services_India':[{name:'Bajaj Finance',sector:'NBFC',strengths:'Consumer lending leader, digital push',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Chola Finance (CHOLAFIN)',sector:'Vehicle Finance',strengths:'Vehicle + home loans, rural reach',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'SBI Cards',sector:'Credit Cards',strengths:'SBI network, growing card market',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'CDSL',sector:'Depository',strengths:'Duopoly, demat account growth',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Angel One',sector:'Broking',strengths:'Discount broking, fintech platform',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Motilal Oswal',sector:'Financial Services',strengths:'Broking, AMC, PE, wealth mgmt',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Healthcare_US':[{name:'Intuitive Surgical (ISRG)',sector:'Robotic Surgery',strengths:'Da Vinci system monopoly',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Dexcom (DXCM)',sector:'Medical Devices',strengths:'CGM leader for diabetes',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Veeva Systems (VEEV)',sector:'Life Sciences IT',strengths:'Cloud for pharma, switching costs',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Shockwave Medical (SWAV)',sector:'Cardiology',strengths:'Intravascular lithotripsy',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Axonics (AXNX)',sector:'Neuromodulation',strengths:'Bladder/bowel therapy devices',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Inspire Medical (INSP)',sector:'Sleep Apnea',strengths:'Implantable neurostimulation',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Healthcare_India':[{name:'Max Healthcare',sector:'Hospitals',strengths:'Premium hospitals, strong brand',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Narayana Health',sector:'Hospitals',strengths:'Affordable healthcare model',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Laurus Labs',sector:'Pharma',strengths:'API + formulations, ARV leader',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Metropolis Healthcare',sector:'Diagnostics',strengths:'Premium diagnostics chain',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Syngene International',sector:'CRAMS',strengths:'Contract research for global pharma',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Gland Pharma',sector:'Injectables',strengths:'Global injectables leader',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Consumer Cyclical_US':[{name:'Airbnb (ABNB)',sector:'Travel Platform',strengths:'Global travel marketplace',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Lululemon (LULU)',sector:'Athletic Wear',strengths:'Premium athleisure, cult brand',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'DraftKings (DKNG)',sector:'Sports Betting',strengths:'Online gaming leader, state expansion',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Carvana (CVNA)',sector:'Auto E-commerce',strengths:'Online used car marketplace',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Floor & Decor (FND)',sector:'Home Improvement',strengths:'Specialty flooring, store growth',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Five Below (FIVE)',sector:'Discount Retail',strengths:'Teen/tween value retail',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Consumer Cyclical_India':[{name:'Trent Limited',sector:'Retail',strengths:'Zara India + Westside + Zudio',potential:'Exceptional',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Page Industries',sector:'Innerwear',strengths:'Jockey India, pricing power',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Devyani International',sector:'QSR',strengths:'KFC + Pizza Hut India franchise',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Varun Beverages',sector:'Beverages',strengths:'PepsiCo franchise, geographic expansion',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Jubilant FoodWorks',sector:'QSR',strengths:'Dominos India, store network',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Bata India',sector:'Footwear',strengths:'Brand heritage, premiumization',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Industrials_US':[{name:'Chart Industries (GTLS)',sector:'Industrial Equipment',strengths:'LNG, hydrogen infrastructure',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Generac (GNRC)',sector:'Power Equipment',strengths:'Home generators, clean energy storage',potential:'High',stars:'â˜…â˜…â˜…â˜…'},{name:'Bloom Energy (BE)',sector:'Fuel Cells',strengths:'Solid oxide fuel cells',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'AAON Inc (AAON)',sector:'HVAC',strengths:'Commercial HVAC, energy efficiency',potential:'High',stars:'â˜…â˜…â˜…'},{name:'AZEK (AZEK)',sector:'Building Products',strengths:'Sustainable composite decking',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Fluence Energy (FLNC)',sector:'Energy Storage',strengths:'Battery storage systems',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'}],
        'Industrials_India':[{name:'Kaynes Technology',sector:'Defense Electronics',strengths:'Defense & space, IoT, govt contracts',potential:'Exceptional',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Dixon Technologies',sector:'Electronics Mfg',strengths:'PLI beneficiary, diversified products',potential:'Very High',stars:'â˜…â˜…â˜…â˜…â˜…'},{name:'Polycab India',sector:'Cables & Wires',strengths:'Infrastructure growth, FMEG',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'KEI Industries',sector:'Cables',strengths:'Power cables, infra demand',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Kalpataru Projects',sector:'EPC',strengths:'Power transmission, global projects',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Apar Industries',sector:'Conductors',strengths:'Specialty cables, transformer oils',potential:'High',stars:'â˜…â˜…â˜…â˜…'}],
        'Energy_US':[{name:'Enphase Energy (ENPH)',sector:'Solar',strengths:'Microinverters, residential solar',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Array Technologies (ARRY)',sector:'Solar Trackers',strengths:'Utility-scale tracking systems',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Chord Energy (CHRD)',sector:'Oil & Gas',strengths:'Bakken Shale, low-cost operator',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Magnolia Oil (MGY)',sector:'Oil & Gas',strengths:'Eagle Ford, efficient ops',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Shoals Tech (SHLS)',sector:'Solar Components',strengths:'Electrical balance of systems',potential:'High',stars:'â˜…â˜…â˜…'},{name:'NextEra Partners (NEP)',sector:'Renewables',strengths:'Wind & solar portfolio',potential:'High',stars:'â˜…â˜…â˜…'}],
        'Energy_India':[{name:'Adani Green Energy',sector:'Renewables',strengths:'Massive solar/wind capacity',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Tata Power',sector:'Power',strengths:'Renewable transition, distribution',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'SJVN Limited',sector:'Hydro Power',strengths:'Hydroelectric, PSU backing',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Borosil Renewables',sector:'Solar Glass',strengths:'Solar glass manufacturing',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'},{name:'Suzlon Energy',sector:'Wind Turbines',strengths:'Wind power, turnaround story',potential:'High',stars:'â˜…â˜…â˜…'},{name:'Waaree Energies',sector:'Solar Modules',strengths:'PV manufacturing, integrated',potential:'Very High',stars:'â˜…â˜…â˜…â˜…'}]
    };
    let geo = isIndian ? 'India' : 'US';
    let key = `${sector.replace(' Services','').replace('Financial','Financial Services').trim()}_${geo}`;
    let recs = db[key] || db[`${sector.split(' ')[0]}_${geo}`] || db[`Technology_${geo}`];
    let tbl = `<table class="data-table"><tr><th>Company</th><th>Focus</th><th>Strengths</th><th>Potential</th></tr>`;
    recs.forEach(c => {
        const clr = c.potential.includes('Exceptional')||c.potential.includes('Very High')?'var(--green)':'var(--amber)';
        tbl += `<tr><td><strong>${c.name}</strong></td><td>${c.sector}</td><td style="font-size:13px">${c.strengths}</td><td style="color:${clr};font-weight:700;font-size:13px">${c.stars}<br>${c.potential}</td></tr>`;
    });
    tbl += '</table>';
    document.getElementById('smallCapTable').innerHTML = tbl;
}

// ============================================================
// UTILITIES
// ============================================================
function formatCap(cap) {
    if (!cap) return 'N/A';
    if (cap >= 1e12) return '$' + (cap/1e12).toFixed(2) + 'T';
    if (cap >= 1e9) return '$' + (cap/1e9).toFixed(2) + 'B';
    if (cap >= 1e6) return '$' + (cap/1e6).toFixed(2) + 'M';
    return '$' + cap.toLocaleString();
}

function createCharts(d) {
    if (valChart) valChart.destroy();
    if (trendChart) trendChart.destroy();
    const chartFont = {family:"'Outfit',sans-serif",size:11};
    const gridColor = 'rgba(99,179,237,0.06)';

    valChart = new Chart(document.getElementById('valChart').getContext('2d'), {
        type:'bar',
        data:{labels:['P/E','P/B','Div Yield'],datasets:[{data:[parseFloat(d.pe_ratio)||0,parseFloat(d.pb_ratio)||0,parseFloat(d.dividend_yield)||0],backgroundColor:['rgba(34,211,238,0.3)','rgba(167,139,250,0.3)','rgba(52,211,153,0.3)'],borderColor:['#22d3ee','#a78bfa','#34d399'],borderWidth:2,borderRadius:6}]},
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:gridColor},ticks:{color:'#64748b',font:chartFont}},x:{grid:{display:false},ticks:{color:'#94a3b8',font:chartFont}}}}
    });

    const price = d.current_price||100, trend=[];
    for (let i=6;i>=0;i--) trend.push(price*(1+(Math.random()-0.5)*0.12*i/6));

    trendChart = new Chart(document.getElementById('trendChart').getContext('2d'), {
        type:'line',
        data:{labels:['6M','5M','4M','3M','2M','1M','Now'],datasets:[{data:trend,borderColor:'#22d3ee',backgroundColor:'rgba(34,211,238,0.08)',fill:true,tension:0.4,borderWidth:2.5,pointBackgroundColor:'#22d3ee',pointBorderColor:'#0c1019',pointBorderWidth:2,pointRadius:4,pointHoverRadius:7}]},
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{grid:{color:gridColor},ticks:{color:'#64748b',font:chartFont}},x:{grid:{display:false},ticks:{color:'#94a3b8',font:chartFont}}}}
    });
}
</script>
</body>
</html>
