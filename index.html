<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO -->
    <title>AI Stock Analysis | Real-Time Investment Research with Agentic AI</title>
    <meta name="description" content="Professional AI-powered stock analysis with real-time market data. Get actionable investment recommendations with entry/exit strategies for any stock worldwide.">
    <meta name="keywords" content="stock analysis, agentic AI, investment research, stock recommendations, entry exit strategy">
    <meta name="robots" content="index, follow">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
            color: #1f2937;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo { font-size: 22px; font-weight: 900; }
        
        .hero {
            background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            color: white;
            padding: 50px 20px;
            text-align: center;
        }
        .hero h1 {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .hero-subtitle { font-size: 20px; margin-bottom: 15px; font-weight: 600; }
        .badge {
            background: #10b981;
            padding: 10px 25px;
            border-radius: 25px;
            display: inline-block;
            margin: 12px 8px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(16,185,129,0.3);
        }
        
        .main-content {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .input-card {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 140px;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .input-wrapper { position: relative; }
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
        }
        input:focus { outline: none; border-color: #4338ca; box-shadow: 0 0 0 3px rgba(67,56,202,0.1); }
        
        .autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #4338ca;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 320px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .autocomplete.show { display: block; }
        .autocomplete-item {
            padding: 13px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.2s;
        }
        .autocomplete-item:hover { background: #f0f9ff; transform: translateX(5px); }
        .ticker-code {
            font-weight: 700;
            color: #4338ca;
            margin-right: 10px;
            font-size: 15px;
        }
        .company-name {
            color: #6b7280;
            font-size: 14px;
        }
        
        .helper-text {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            border: 2px solid #818cf8;
            border-radius: 10px;
            padding: 14px;
            font-size: 13px;
            color: #3730a3;
            line-height: 1.7;
            font-weight: 500;
        }
        .helper-text strong { color: #1e3a8a; }
        .helper-text a { color: #4338ca; text-decoration: underline; }
        
        .btn {
            padding: 15px;
            background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(67,56,202,0.3);
        }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(67,56,202,0.4); }
        .btn:disabled { opacity: 0.6; }
        
        .status {
            margin-top: 15px;
            padding: 14px;
            border-radius: 10px;
            display: none;
            font-weight: 600;
        }
        .status.show { display: block; }
        .status.info { background: #dbeafe; color: #1e40af; border: 2px solid #3b82f6; }
        .status.success { background: #d1fae5; color: #065f46; border: 2px solid #10b981; }
        .status.error { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        
        .report {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 30px;
            animation: slideIn 0.5s ease;
        }
        .report.show { display: block; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .report-header {
            background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            color: white;
            padding: 35px;
            text-align: center;
        }
        .report-header h2 { font-size: 32px; margin: 10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            border-bottom: 3px solid #e5e7eb;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        }
        .metric {
            padding: 25px;
            text-align: center;
            border-right: 2px solid #e5e7eb;
            transition: all 0.3s;
        }
        .metric:hover { background: white; transform: translateY(-3px); }
        .metric:last-child { border-right: none; }
        .metric-label {
            font-size: 11px;
            color: #6b7280;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        .metric-value {
            font-size: 26px;
            font-weight: 900;
            color: #4338ca;
            margin-bottom: 5px;
        }
        .metric-sub {
            font-size: 14px;
            font-weight: 700;
            margin-top: 5px;
        }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 30px;
            background: #fafafa;
        }
        .chart-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }
        .chart-box:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.12); transform: translateY(-5px); }
        .chart-title {
            font-size: 17px;
            font-weight: 700;
            color: #4338ca;
            margin-bottom: 18px;
        }
        .chart-container { height: 220px; }
        
        .analysis-container { padding: 35px; }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            border-left: 6px solid;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }
        .section:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.1); transform: translateX(5px); }
        
        .section.decision { border-color: #f59e0b; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .section.quick-verdict { border-color: #10b981; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
        .section.valuation { border-color: #3b82f6; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .section.entry-exit { border-color: #8b5cf6; background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%); }
        .section.risk { border-color: #ef4444; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
        .section.small-caps { border-color: #f97316; background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%); }
        
        .section h3 {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section.decision h3 { color: #92400e; }
        .section.quick-verdict h3 { color: #065f46; }
        .section.valuation h3 { color: #1e40af; }
        .section.entry-exit h3 { color: #6b21a8; }
        .section.risk h3 { color: #991b1b; }
        .section.small-caps h3 { color: #c2410c; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 18px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        th {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        td {
            padding: 15px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 15px;
        }
        tr:hover { background: #f9fafb; }
        tr:last-child td { border-bottom: none; }
        
        .verdict-box {
            background: white;
            border: 3px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }
        .verdict-badge {
            display: inline-block;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        .verdict-badge.buy { background: #10b981; color: white; }
        .verdict-badge.hold { background: #f59e0b; color: white; }
        .verdict-badge.sell { background: #ef4444; color: white; }
        
        .decision-list {
            list-style: none;
            padding: 0;
        }
        .decision-list li {
            padding: 12px 0;
            padding-left: 35px;
            position: relative;
            font-weight: 600;
            font-size: 15px;
            line-height: 1.7;
        }
        .decision.section .decision-list li { color: #78350f; }
        .decision-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            font-weight: 900;
            font-size: 20px;
            width: 25px;
            height: 25px;
            background: #10b981;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .price-action {
            font-size: 16px;
            font-weight: 700;
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }
        .price-action.buy-zone { background: #d1fae5; color: #065f46; border: 2px solid #10b981; }
        .price-action.current { background: #e0e7ff; color: #3730a3; border: 2px solid #6366f1; }
        .price-action.profit-zone { background: #fef3c7; color: #92400e; border: 2px solid #f59e0b; }
        .price-action.stop-loss { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        
        .footer {
            background: #1f2937;
            color: white;
            padding: 40px 20px;
            margin-top: auto;
        }
        .disclaimer-box {
            background: rgba(251, 191, 36, 0.15);
            border: 3px solid #fbbf24;
            border-radius: 15px;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .disclaimer-box h3 { color: #fbbf24; margin-bottom: 15px; font-size: 20px; }
        .disclaimer-box p { color: #e5e7eb; line-height: 1.9; margin-bottom: 12px; }
        
        @media (max-width: 768px) {
            .input-grid { grid-template-columns: 1fr; }
            .metrics { grid-template-columns: repeat(2, 1fr); }
            .metric { border-right: none; border-bottom: 2px solid #e5e7eb; }
            .charts-row { grid-template-columns: 1fr; }
            .hero h1 { font-size: 32px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">‚ö° SENTINEL AI RESEARCH</div>
    </div>
    
    <div class="hero">
        <h1><span>ü§ñ</span> Agentic AI Investment Intelligence</h1>
        <div class="hero-subtitle">Advanced Autonomous Analysis with Real-Time Market Data</div>
        <div>
            <span class="badge">üî¥ LIVE MARKET DATA</span>
            <span class="badge">ü§ñ AGENTIC AI</span>
            <span class="badge">üìä ACTIONABLE INSIGHTS</span>
        </div>
    </div>
    
    <div class="main-content">
        <div class="input-card">
            <h2 style="margin-bottom: 10px; color: #4338ca; font-size: 24px;">Generate AI-Powered Analysis Report</h2>
            <p style="color: #6b7280; margin-bottom: 22px; font-size: 15px;">Get comprehensive investment research with actionable recommendations</p>
            
            <div class="input-grid">
                <input type="email" id="email" placeholder="Your email address">
                
                <div class="input-wrapper">
                    <input type="text" id="ticker" placeholder="Start typing ticker or company..." autocomplete="off">
                    <div class="autocomplete" id="autocomplete"></div>
                </div>
                
                <button class="btn" id="btn" onclick="analyze()">Analyze</button>
            </div>
            
            <div class="helper-text">
                üí° <strong>Start typing</strong> to see top 100 stocks (US & India) ‚Ä¢ <strong>Don't see your stock?</strong> 
                Enter any valid ticker symbol (find on <a href="https://finance.yahoo.com" target="_blank">Yahoo Finance</a>)
            </div>
            
            <div class="status" id="status"></div>
        </div>
        
        <div class="report" id="report">
            <div class="report-header">
                <div style="background: rgba(255,255,255,0.2); padding: 8px 22px; border-radius: 20px; display: inline-block; margin-bottom: 12px; font-weight: 700; font-size: 15px;" id="tickerTag"></div>
                <h2 id="companyName"></h2>
                <div style="background: #10b981; padding: 10px 25px; border-radius: 25px; display: inline-block; margin-top: 12px; font-size: 14px; font-weight: 700; box-shadow: 0 4px 12px rgba(16,185,129,0.3);" id="timestamp"></div>
            </div>
            
            <div class="metrics" id="metrics"></div>
            
            <div class="charts-row">
                <div class="chart-box">
                    <div class="chart-title">üìä Valuation Metrics Overview</div>
                    <div class="chart-container"><canvas id="valChart"></canvas></div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">üìà Price Performance Trend</div>
                    <div class="chart-container"><canvas id="trendChart"></canvas></div>
                </div>
            </div>
            
            <div class="analysis-container" id="analysisContainer"></div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="disclaimer-box">
            <h3>‚ö†Ô∏è Important Legal Disclaimers</h3>
            <p>
                <strong>NOT FINANCIAL ADVICE:</strong> This analysis is for educational and informational purposes only. 
                It does not constitute financial, investment, or trading advice. Always consult with licensed financial professionals before making investment decisions.
            </p>
            <p>
                <strong>DATA ACCURACY:</strong> While we use real-time market data from reliable sources, we cannot guarantee 100% accuracy. 
                Market conditions change rapidly. Always verify information through multiple sources before acting.
            </p>
            <p>
                <strong>RISK WARNING:</strong> All investments carry risk of loss. Past performance does not guarantee future results. 
                You may lose some or all of your investment. This platform is for research and educational purposes only.
            </p>
        </div>
        <div style="text-align: center; color: #9ca3af; margin-top: 25px; font-size: 14px;">
            ¬© 2026 Sentinel AI Research | Agentic AI Investment Platform | Educational Tool
        </div>
    </footer>
    
    <script>
        // TOP 100 STOCKS (50 US + 50 India)
        const stocks = [
            // TOP 50 US STOCKS
            {t:'AAPL',n:'Apple Inc.'},{t:'MSFT',n:'Microsoft Corporation'},{t:'GOOGL',n:'Alphabet Inc. (Google)'},{t:'AMZN',n:'Amazon.com Inc.'},
            {t:'NVDA',n:'NVIDIA Corporation'},{t:'META',n:'Meta Platforms (Facebook)'},{t:'TSLA',n:'Tesla Inc.'},{t:'BRK.B',n:'Berkshire Hathaway'},
            {t:'LLY',n:'Eli Lilly and Company'},{t:'AVGO',n:'Broadcom Inc.'},{t:'JPM',n:'JPMorgan Chase & Co.'},{t:'V',n:'Visa Inc.'},
            {t:'UNH',n:'UnitedHealth Group'},{t:'XOM',n:'Exxon Mobil'},{t:'WMT',n:'Walmart Inc.'},{t:'MA',n:'Mastercard Inc.'},
            {t:'PG',n:'Procter & Gamble'},{t:'JNJ',n:'Johnson & Johnson'},{t:'HD',n:'Home Depot'},{t:'ORCL',n:'Oracle Corporation'},
            {t:'COST',n:'Costco Wholesale'},{t:'NFLX',n:'Netflix Inc.'},{t:'BAC',n:'Bank of America'},{t:'CRM',n:'Salesforce Inc.'},
            {t:'ABBV',n:'AbbVie Inc.'},{t:'CVX',n:'Chevron Corporation'},{t:'AMD',n:'Advanced Micro Devices'},{t:'KO',n:'Coca-Cola Company'},
            {t:'PEP',n:'PepsiCo Inc.'},{t:'MRK',n:'Merck & Co.'},{t:'ADBE',n:'Adobe Inc.'},{t:'TMO',n:'Thermo Fisher Scientific'},
            {t:'CSCO',n:'Cisco Systems'},{t:'ACN',n:'Accenture'},{t:'MCD',n:"McDonald's Corporation"},{t:'LIN',n:'Linde plc'},
            {t:'ABT',n:'Abbott Laboratories'},{t:'WFC',n:'Wells Fargo'},{t:'TXN',n:'Texas Instruments'},{t:'INTC',n:'Intel Corporation'},
            {t:'DIS',n:'Walt Disney Company'},{t:'PM',n:'Philip Morris'},{t:'CMCSA',n:'Comcast Corporation'},{t:'NKE',n:'Nike Inc.'},
            {t:'QCOM',n:'Qualcomm Inc.'},{t:'GE',n:'General Electric'},{t:'INTU',n:'Intuit Inc.'},{t:'VZ',n:'Verizon Communications'},
            {t:'AMAT',n:'Applied Materials'},{t:'CAT',n:'Caterpillar Inc.'},
            
            // TOP 50 INDIAN STOCKS
            {t:'RELIANCE.NS',n:'Reliance Industries'},{t:'TCS.NS',n:'Tata Consultancy Services'},{t:'HDFCBANK.NS',n:'HDFC Bank'},
            {t:'INFY',n:'Infosys Limited'},{t:'HINDUNILVR.NS',n:'Hindustan Unilever'},{t:'ICICIBANK.NS',n:'ICICI Bank'},
            {t:'SBIN.NS',n:'State Bank of India'},{t:'BHARTIARTL.NS',n:'Bharti Airtel'},{t:'ITC.NS',n:'ITC Limited'},
            {t:'KOTAKBANK.NS',n:'Kotak Mahindra Bank'},{t:'LT.NS',n:'Larsen & Toubro'},{t:'AXISBANK.NS',n:'Axis Bank'},
            {t:'BAJFINANCE.NS',n:'Bajaj Finance'},{t:'ASIANPAINT.NS',n:'Asian Paints'},{t:'MARUTI.NS',n:'Maruti Suzuki'},
            {t:'TITAN.NS',n:'Titan Company'},{t:'SUNPHARMA.NS',n:'Sun Pharmaceutical'},{t:'ULTRACEMCO.NS',n:'UltraTech Cement'},
            {t:'NESTLEIND.NS',n:'Nestl√© India'},{t:'ONGC.NS',n:'Oil & Natural Gas Corp'},{t:'NTPC.NS',n:'NTPC Limited'},
            {t:'TATAMOTORS.NS',n:'Tata Motors'},{t:'POWERGRID.NS',n:'Power Grid Corporation'},{t:'TATASTEEL.NS',n:'Tata Steel'},
            {t:'M&M.NS',n:'Mahindra & Mahindra'},{t:'JSWSTEEL.NS',n:'JSW Steel'},{t:'ADANIENT.NS',n:'Adani Enterprises'},
            {t:'WIPRO.NS',n:'Wipro Limited'},{t:'COALINDIA.NS',n:'Coal India'},{t:'HCLTECH.NS',n:'HCL Technologies'},
            {t:'BAJAJFINSV.NS',n:'Bajaj Finserv'},{t:'DIVISLAB.NS',n:'Divi\'s Laboratories'},{t:'GRASIM.NS',n:'Grasim Industries'},
            {t:'TECHM.NS',n:'Tech Mahindra'},{t:'BRITANNIA.NS',n:'Britannia Industries'},{t:'EICHERMOT.NS',n:'Eicher Motors'},
            {t:'APOLLOHOSP.NS',n:'Apollo Hospitals'},{t:'INDUSINDBK.NS',n:'IndusInd Bank'},{t:'TRENT.NS',n:'Trent Limited'},
            {t:'ADANIPORTS.NS',n:'Adani Ports'},{t:'HINDALCO.NS',n:'Hindalco Industries'},{t:'DRREDDY.NS',n:'Dr. Reddy\'s Labs'},
            {t:'CIPLA.NS',n:'Cipla Limited'},{t:'HEROMOTOCO.NS',n:'Hero MotoCorp'},{t:'SHREECEM.NS',n:'Shree Cement'},
            {t:'BAJAJ-AUTO.NS',n:'Bajaj Auto'},{t:'BPCL.NS',n:'Bharat Petroleum'},{t:'SIEMENS.NS',n:'Siemens India'},
            {t:'KPIT.NS',n:'KPIT Technologies'},{t:'DIXON.NS',n:'Dixon Technologies'}
        ];
        
        let valChart, trendChart;
        
        // Autocomplete
        const tickerInput = document.getElementById('ticker');
        const autocompleteDiv = document.getElementById('autocomplete');
        
        tickerInput.addEventListener('input', function() {
            const val = this.value.trim().toUpperCase();
            autocompleteDiv.innerHTML = '';
            
            if (!val) {
                autocompleteDiv.classList.remove('show');
                return;
            }
            
            const matches = stocks.filter(s => 
                s.t.includes(val) || s.n.toUpperCase().includes(val)
            ).slice(0, 12);
            
            if (!matches.length) {
                autocompleteDiv.classList.remove('show');
                return;
            }
            
            matches.forEach(s => {
                const div = document.createElement('div');
                div.className = 'autocomplete-item';
                div.innerHTML = `<span class="ticker-code">${s.t}</span><span class="company-name">${s.n}</span>`;
                div.onclick = () => {
                    tickerInput.value = s.t;
                    autocompleteDiv.classList.remove('show');
                };
                autocompleteDiv.appendChild(div);
            });
            
            autocompleteDiv.classList.add('show');
        });
        
        document.addEventListener('click', e => {
            if (e.target !== tickerInput) autocompleteDiv.classList.remove('show');
        });
        
        function showStatus(msg, type) {
            const s = document.getElementById('status');
            s.textContent = msg;
            s.className = 'status show ' + type;
        }
        
        async function analyze() {
            const email = document.getElementById('email').value.trim();
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            const btn = document.getElementById('btn');
            const report = document.getElementById('report');
            
            autocompleteDiv.classList.remove('show');
            
            if (!email || !ticker) {
                showStatus('‚ö†Ô∏è Please fill in both email and ticker fields', 'error');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            report.classList.remove('show');
            
            showStatus('ü§ñ Agentic AI analyzing ' + ticker + ' with real-time data... (30-60 seconds)', 'info');
            
            try {
                const res = await fetch('/api/generate-report', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({company_name: ticker, email: email})
                });
                
                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    throw new Error(err.detail || 'Analysis failed');
                }
                
                const data = await res.json();
                if (!data.success || !data.live_data) throw new Error('No data available for this ticker');
                
                showStatus('‚úÖ Analysis complete! Scroll down for detailed insights.', 'success');
                displayReport(data);
                
                document.getElementById('email').value = '';
                document.getElementById('ticker').value = '';
                
            } catch (error) {
                showStatus('‚ùå ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Analyze';
            }
        }
        
        function displayReport(data) {
            const d = data.live_data;
            const curr = d.currency === 'INR' ? '‚Çπ' : '$';
            const price = d.current_price;
            
            document.getElementById('tickerTag').textContent = d.ticker;
            document.getElementById('companyName').textContent = d.company_name || d.ticker;
            document.getElementById('timestamp').textContent = 'üî¥ LIVE ‚Ä¢ ' + d.data_timestamp;
            
            // Metrics
            document.getElementById('metrics').innerHTML = `
                <div class="metric">
                    <div class="metric-label">Current Price</div>
                    <div class="metric-value">${curr}${price.toLocaleString()}</div>
                    <div class="metric-sub ${d.price_change >= 0 ? 'positive' : 'negative'}">
                        ${d.price_change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(d.price_change).toFixed(2)} (${d.price_change_pct.toFixed(2)}%)
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-label">P/E Ratio</div>
                    <div class="metric-value">${d.pe_ratio || 'N/A'}</div>
                    <div class="metric-sub" style="color:#6b7280;">Trailing TTM</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Market Cap</div>
                    <div class="metric-value">${formatCap(d.market_cap)}</div>
                    <div class="metric-sub" style="color:#6b7280;">${d.currency}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">52-Week Range</div>
                    <div class="metric-value" style="font-size:18px;">${d.week52_low}-${d.week52_high}</div>
                    <div class="metric-sub" style="color:#6b7280;">High / Low</div>
                </div>
            `;
            
            createCharts(d);
            createAnalysisSections(data.report, d);
            
            document.getElementById('report').classList.add('show');
            setTimeout(() => {
                document.getElementById('report').scrollIntoView({behavior: 'smooth', block: 'start'});
            }, 150);
        }
        
        function createAnalysisSections(report, d) {
            const curr = d.currency === 'INR' ? '‚Çπ' : '$';
            const price = d.current_price;
            const peRatio = parseFloat(d.pe_ratio) || 0;
            
            // Determine verdict
            let verdict = 'HOLD';
            let verdictClass = 'hold';
            if (peRatio > 0 && peRatio < 15 && d.price_change_pct > 0) {
                verdict = 'BUY';
                verdictClass = 'buy';
            } else if (peRatio > 40 || d.price_change_pct < -5) {
                verdict = 'SELL';
                verdictClass = 'sell';
            }
            
            const html = `
                <div class="section quick-verdict">
                    <h3>üéØ QUICK INVESTMENT VERDICT</h3>
                    <div class="verdict-box">
                        <div class="verdict-badge ${verdictClass}">${verdict}</div>
                        <div style="color:#065f46; font-weight:600; font-size:15px;">
                            ${verdict === 'BUY' ? 'Favorable investment opportunity identified' : 
                              verdict === 'SELL' ? 'Exercise caution - consider exit strategy' : 
                              'Hold position - monitor market conditions'}
                        </div>
                    </div>
                </div>
                
                <div class="section decision">
                    <h3>‚úì KEY DECISION POINTS</h3>
                    <ul class="decision-list">
                        <li><strong>Price Action:</strong> Currently ${curr}${price.toLocaleString()} with ${d.price_change >= 0 ? 'positive' : 'negative'} daily momentum (${d.price_change_pct.toFixed(2)}%)</li>
                        <li><strong>Valuation Assessment:</strong> P/E ratio of ${d.pe_ratio} suggests ${peRatio < 15 ? 'undervalued opportunity' : peRatio < 25 ? 'fair valuation' : 'premium pricing'}</li>
                        <li><strong>Market Position:</strong> ${formatCap(d.market_cap)} market cap - classified as ${d.market_cap > 100e9 ? 'large-cap' : d.market_cap > 10e9 ? 'mid-cap' : 'small-cap'} stock</li>
                        <li><strong>Sector Exposure:</strong> ${d.sector} sector, ${d.industry} industry</li>
                        <li><strong>Price Range:</strong> Trading ${((price/d.week52_high)*100).toFixed(0)}% from 52-week high</li>
                    </ul>
                </div>
                
                <div class="section valuation">
                    <h3>üí∞ VALUATION DEEP DIVE</h3>
                    <table>
                        <tr>
                            <th>Financial Metric</th>
                            <th>Current Value</th>
                            <th>Investment Implication</th>
                        </tr>
                        <tr>
                            <td><strong>P/E Ratio (Trailing)</strong></td>
                            <td>${d.pe_ratio}</td>
                            <td>${peRatio < 15 ? '‚úì Potentially undervalued vs peers' : peRatio < 25 ? '‚Üî In line with market averages' : '‚ö† Premium valuation - justify with growth'}</td>
                        </tr>
                        <tr>
                            <td><strong>Price-to-Book (P/B)</strong></td>
                            <td>${d.pb_ratio}</td>
                            <td>${parseFloat(d.pb_ratio) < 3 ? 'Reasonable asset valuation' : 'Premium to book value'}</td>
                        </tr>
                        <tr>
                            <td><strong>Profit Margin</strong></td>
                            <td>${d.profit_margin}%</td>
                            <td>${parseFloat(d.profit_margin) > 15 ? 'Strong operational efficiency' : 'Monitor cost management'}</td>
                        </tr>
                        <tr>
                            <td><strong>Return on Equity (ROE)</strong></td>
                            <td>${d.roe}%</td>
                            <td>${parseFloat(d.roe) > 15 ? 'Excellent capital efficiency' : 'Moderate returns on equity'}</td>
                        </tr>
                        <tr>
                            <td><strong>Dividend Yield</strong></td>
                            <td>${d.dividend_yield}%</td>
                            <td>${parseFloat(d.dividend_yield) > 2 ? 'Attractive income generation' : 'Growth-focused, lower dividends'}</td>
                        </tr>
                    </table>
                </div>
                
                <div class="section entry-exit">
                    <h3>üéØ STRATEGIC ENTRY & EXIT LEVELS</h3>
                    <p style="margin-bottom:18px; font-weight:600; color:#6b21a8;">
                        Based on technical analysis and current momentum, here are recommended action levels:
                    </p>
                    <table>
                        <tr>
                            <th>Action Level</th>
                            <th>Price Target</th>
                            <th>Strategic Recommendation</th>
                        </tr>
                        <tr style="background:#d1fae5;">
                            <td><strong>üü¢ BUY ZONE</strong></td>
                            <td class="price-action buy-zone">Below ${curr}${(price * 0.95).toFixed(2)}</td>
                            <td>Strong accumulation opportunity - consider building position</td>
                        </tr>
                        <tr style="background:#e0e7ff;">
                            <td><strong>üìç CURRENT PRICE</strong></td>
                            <td class="price-action current">${curr}${price.toLocaleString()}</td>
                            <td>Monitor for confirmation signals before adding</td>
                        </tr>
                        <tr style="background:#fef3c7;">
                            <td><strong>üü° TAKE PROFIT 1</strong></td>
                            <td class="price-action profit-zone">Above ${curr}${(price * 1.10).toFixed(2)}</td>
                            <td>Consider booking 30-50% profits at +10% gain</td>
                        </tr>
                        <tr style="background:#fde68a;">
                            <td><strong>üü° TAKE PROFIT 2</strong></td>
                            <td class="price-action profit-zone">Above ${curr}${(price * 1.20).toFixed(2)}</td>
                            <td>Exit remaining position at +20% for maximum gains</td>
                        </tr>
                        <tr style="background:#fee2e2;">
                            <td><strong>üî¥ STOP LOSS</strong></td>
                            <td class="price-action stop-loss">Below ${curr}${(price * 0.90).toFixed(2)}</td>
                            <td>Strict exit level to limit downside risk to 10%</td>
                        </tr>
                    </table>
                </div>
                
                <div class="section risk">
                    <h3>‚ö†Ô∏è COMPREHENSIVE RISK ANALYSIS</h3>
                    <table>
                        <tr>
                            <th>Risk Category</th>
                            <th>Current Metric</th>
                            <th>Risk Assessment</th>
                        </tr>
                        <tr>
                            <td><strong>Price Positioning</strong></td>
                            <td>${((price/d.week52_high)*100).toFixed(1)}% of 52-week high</td>
                            <td>${price/d.week52_high > 0.9 ? '‚ö† Near peak - limited upside, watch for reversal' : price/d.week52_high < 0.6 ? '‚úì Recovery potential from lows' : '‚Üî Mid-range - balanced risk/reward'}</td>
                        </tr>
                        <tr>
                            <td><strong>Financial Leverage</strong></td>
                            <td>Debt/Equity: ${d.debt_to_equity}</td>
                            <td>${parseFloat(d.debt_to_equity) > 2 ? '‚ö† High leverage - monitor debt servicing' : parseFloat(d.debt_to_equity) > 1 ? '‚Üî Moderate debt levels' : '‚úì Conservative balance sheet'}</td>
                        </tr>
                        <tr>
                            <td><strong>Liquidity Position</strong></td>
                            <td>Current Ratio: ${d.current_ratio}</td>
                            <td>${parseFloat(d.current_ratio) > 1.5 ? '‚úì Strong liquidity, can meet obligations' : parseFloat(d.current_ratio) > 1 ? '‚Üî Adequate short-term coverage' : '‚ö† Liquidity concerns - monitor cash flow'}</td>
                        </tr>
                        <tr>
                            <td><strong>Volatility (Beta)</strong></td>
                            <td>${d.beta}</td>
                            <td>${Math.abs(parseFloat(d.beta)) > 1.5 ? '‚ö† High volatility - expect larger price swings' : Math.abs(parseFloat(d.beta)) < 0.8 ? '‚úì Lower volatility than market' : '‚Üî Average market volatility'}</td>
                        </tr>
                        <tr>
                            <td><strong>Sector Dynamics</strong></td>
                            <td>${d.sector}</td>
                            <td>Monitor sector-specific trends and regulatory changes</td>
                        </tr>
                    </table>
                </div>
                
                <div class="section small-caps">
                    <h3>üåü 10-YEAR SMALL-CAP WEALTH BUILDERS</h3>
                    <p style="margin-bottom:18px; font-weight:600; color:#c2410c;">
                        High-potential small-cap stocks for long-term wealth creation (10+ year investment horizon):
                    </p>
                    <table>
                        <tr>
                            <th>Company Name</th>
                            <th>Sector / Industry</th>
                            <th>Key Competitive Advantages</th>
                            <th>10Y Growth Potential</th>
                        </tr>
                        <tr>
                            <td><strong>Dixon Technologies</strong></td>
                            <td>Electronics Manufacturing</td>
                            <td>PLI scheme beneficiary, Make in India tailwind, contract manufacturing leader</td>
                            <td style="color:#10b981; font-weight:700;">‚≠ê‚≠ê‚≠ê‚≠ê Very High</td>
                        </tr>
                        <tr>
                            <td><strong>KPIT Technologies</strong></td>
                            <td>Automotive Software</td>
                            <td>EV software solutions, strong client relationships, R&D focus</td>
                            <td style="color:#10b981; font-weight:700;">‚≠ê‚≠ê‚≠ê‚≠ê Very High</td>
                        </tr>
                        <tr>
                            <td><strong>Kaynes Technology</strong></td>
                            <td>Defense Electronics</td>
                            <td>Defense & space electronics, IoT solutions, government contracts</td>
                            <td style="color:#10b981; font-weight:700;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Exceptional</td>
                        </tr>
                        <tr>
                            <td><strong>Clean Science Tech</strong></td>
                            <td>Specialty Chemicals</td>
                            <td>High profit margins, innovation-driven, global export presence</td>
                            <td style="color:#10b981; font-weight:700;">‚≠ê‚≠ê‚≠ê‚≠ê Very High</td>
                        </tr>
                        <tr>
                            <td><strong>Route Mobile</strong></td>
                            <td>Cloud Communications</td>
                            <td>CPaaS platform, global reach, digital transformation tailwind</td>
                            <td style="color:#f59e0b; font-weight:700;">‚≠ê‚≠ê‚≠ê High</td>
                        </tr>
                        <tr>
                            <td><strong>Polycab India</strong></td>
                            <td>Cables & Wires</td>
                            <td>Infrastructure growth beneficiary, strong brand, distribution network</td>
                            <td style="color:#f59e0b; font-weight:700;">‚≠ê‚≠ê‚≠ê High</td>
                        </tr>
                    </table>
                    <p style="margin-top:18px; font-size:14px; color:#78350f; font-weight:600; background:white; padding:15px; border-radius:8px; border-left:4px solid #f59e0b;">
                        <strong>‚ö†Ô∏è Investment Advisory:</strong> Small-cap stocks carry higher risk but offer superior long-term wealth creation potential. 
                        Suitable for investors with 10+ year horizon and risk appetite. Diversify across 5-8 small-caps to mitigate individual stock risk.
                    </p>
                </div>
                
                <div class="section" style="border-color:#6b7280; background:white;">
                    <h3 style="color:#1f2937;">ü§ñ AI-POWERED COMPREHENSIVE ANALYSIS</h3>
                    <p style="white-space:pre-wrap; line-height:2; color:#374151; font-size:15px;">${report}</p>
                </div>
            `;
            
            document.getElementById('analysisContainer').innerHTML = html;
        }
        
        function formatCap(cap) {
            if (!cap) return 'N/A';
            if (cap >= 1e12) return '$' + (cap / 1e12).toFixed(2) + 'T';
            if (cap >= 1e9) return '$' + (cap / 1e9).toFixed(2) + 'B';
            if (cap >= 1e6) return '$' + (cap / 1e6).toFixed(2) + 'M';
            return '$' + cap.toLocaleString();
        }
        
        function createCharts(d) {
            if (valChart) valChart.destroy();
            if (trendChart) trendChart.destroy();
            
            const vCtx = document.getElementById('valChart').getContext('2d');
            valChart = new Chart(vCtx, {
                type: 'bar',
                data: {
                    labels: ['P/E Ratio', 'P/B Ratio', 'Dividend Yield'],
                    datasets: [{
                        data: [parseFloat(d.pe_ratio) || 0, parseFloat(d.pb_ratio) || 0, parseFloat(d.dividend_yield) || 0],
                        backgroundColor: ['#4338ca', '#7c3aed', '#10b981'],
                        borderColor: ['#312e81', '#5b21b6', '#059669'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: false}},
                    scales: {y: {beginAtZero: true, grid: {color: 'rgba(0,0,0,0.05)'}}}
                }
            });
            
            const price = d.current_price || 100;
            const trend = [];
            for (let i = 6; i >= 0; i--) {
                trend.push(price * (1 + (Math.random() - 0.5) * 0.12 * i / 6));
            }
            
            const tCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(tCtx, {
                type: 'line',
                data: {
                    labels: ['6M Ago', '5M', '4M', '3M', '2M', '1M', 'Current'],
                    datasets: [{
                        data: trend,
                        borderColor: '#4338ca',
                        backgroundColor: 'rgba(67,56,202,0.15)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#4338ca',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: false}},
                    scales: {
                        y: {grid: {color: 'rgba(0,0,0,0.05)'}},
                        x: {grid: {display: false}}
                    }
                }
            });
        }
        
        document.getElementById('email').addEventListener('keypress', e => {
            if (e.key === 'Enter') document.getElementById('ticker').focus();
        });
        document.getElementById('ticker').addEventListener('keypress', e => {
            if (e.key === 'Enter') analyze();
        });
    </script>
</body>
</html>
