<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sentinel AI Research — Free Real-Time Stock Analysis in 60 Seconds</title>
<meta name="description" content="Free AI stock analysis with real-time data. Get exact buy/sell prices, risk scoring, deep valuation breakdown, and hidden small-cap picks — all in 60 seconds. No signup required.">
<meta name="keywords" content="stock analysis, AI stock research, free stock analysis, real-time stock data, stock valuation, entry exit strategy, stop loss calculator, PE ratio checker, stock risk assessment, small cap stocks, Indian stocks, US stocks, investment research, stock screener, AI investment tool, portfolio analysis, stock recommendation, market intelligence">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large">
<meta name="author" content="Sentinel AI Research">
<link rel="canonical" href="https://sentinelai.research">

<!-- Open Graph / Social Sharing -->
<meta property="og:type" content="website">
<meta property="og:title" content="Sentinel AI Research — Free AI Stock Analysis">
<meta property="og:description" content="Get professional-grade stock analysis in 60 seconds. Real-time data, AI valuation, exact buy/sell prices, risk scoring, and hidden small-cap picks. Completely free.">
<meta property="og:site_name" content="Sentinel AI Research">
<meta property="og:locale" content="en_US">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Sentinel AI Research — Free AI Stock Analysis">
<meta name="twitter:description" content="Stop guessing. Get AI-powered stock analysis with real-time data, exact entry/exit prices, and risk scoring — free, in 60 seconds.">

<!-- Additional SEO -->
<meta name="theme-color" content="#060a13">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Sentinel AI">

<!-- Structured Data / JSON-LD -->
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebApplication","name":"Sentinel AI Research","description":"Free AI-powered stock analysis with real-time market data, valuation metrics, entry/exit strategies, risk assessment, and small-cap recommendations.","url":"https://sentinelai.research","applicationCategory":"FinanceApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"featureList":["Real-time stock data","AI-powered analysis","Entry and exit price targets","Risk scoring","Small-cap recommendations","52-week price mapping","Financial health radar","Margin vs industry comparison"]}

)});

// Highlight active section on scroll
let ticking=false;
window.addEventListener('scroll',()=>{
if(!ticking){requestAnimationFrame(()=>{
const scrollY=window.scrollY+200;
let activeIdx=0;
sectionIds.forEach((id,i)=>{
const el=document.getElementById(id);
if(el&&el.getBoundingClientRect().top+window.pageYOffset<=scrollY)activeIdx=i;
});
btns.forEach((b,i)=>{b.classList.toggle('active',i===activeIdx)});
ticking=false});ticking=true}
},{passive:true});
}

// Anti-copy protection
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if(e.ctrlKey&&(e.key==='u'||e.key==='s'||e.key==='c'||e.key==='a'||e.key==='p'))e.preventDefault();if(e.key==='F12')e.preventDefault()});
document.addEventListener('copy',e=>e.preventDefault());
document.addEventListener('cut',e=>e.preventDefault());
</script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Sora:wght@600;700;800&family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Anti-copy protection
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if(e.ctrlKey&&(e.key==='u'||e.key==='s'||e.key==='c'||e.key==='a'||e.key==='p'))e.preventDefault();if(e.key==='F12')e.preventDefault()});
document.addEventListener('copy',e=>e.preventDefault());
document.addEventListener('cut',e=>e.preventDefault());
</script>
<style>
:root{--bg:#060a13;--bg2:#0b1120;--bg3:#111a2e;--surface:rgba(11,17,32,0.85);--glass:rgba(11,17,32,0.6);--border:rgba(59,130,246,0.1);--border2:rgba(59,130,246,0.25);--blue:#3b82f6;--blue2:#2563eb;--cyan:#06b6d4;--green:#10b981;--green2:#059669;--amber:#f59e0b;--red:#ef4444;--purple:#8b5cf6;--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;--mono:'IBM Plex Mono',monospace}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

/* Grid background */
.gridbg{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(59,130,246,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(59,130,246,0.025) 1px,transparent 1px);background-size:48px 48px}
.gridbg::after{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 900px 500px at 50% 0%,rgba(59,130,246,0.06),transparent 70%)}

/* NAV */
nav{position:sticky;top:0;z-index:100;backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);background:rgba(6,10,19,0.88);border-bottom:1px solid var(--border);height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 32px}
.nbrand{display:flex;align-items:center;gap:11px}
.nlogo{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,var(--blue),var(--cyan));display:flex;align-items:center;justify-content:center;font-family:'Sora',sans-serif;font-size:16px;font-weight:800;color:#fff;box-shadow:0 0 16px rgba(59,130,246,.2)}
.nname{font-family:'Sora',sans-serif;font-size:15px;font-weight:700;letter-spacing:.3px;color:#fff}.nname span{color:var(--blue)}.ntag{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;font-weight:600;margin-top:-2px;display:block}
.ncenter{display:flex;gap:6px;align-items:center}
.npill{display:flex;align-items:center;gap:5px;padding:5px 12px;border-radius:100px;font-size:11px;font-weight:500;background:rgba(59,130,246,.06);border:1px solid var(--border);color:var(--text3)}
.npill .v{color:var(--blue);font-family:var(--mono);font-weight:600}
.nright{display:flex;align-items:center;gap:6px}
.nlive{display:flex;align-items:center;gap:5px;padding:5px 12px;border-radius:100px;font-size:11px;font-weight:600;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);color:var(--green)}
.ldot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pdot 2s infinite}
@keyframes pdot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.7)}}

/* HERO */
.hero{position:relative;z-index:1;padding:64px 28px 48px;text-align:center}
.hero-eye{display:inline-flex;align-items:center;gap:6px;background:rgba(59,130,246,0.08);border:1px solid rgba(59,130,246,0.2);padding:7px 18px;border-radius:100px;font-size:12px;font-weight:600;color:var(--blue);margin-bottom:24px;letter-spacing:.3px}
.hero h1{font-family:'Sora',sans-serif;font-size:clamp(32px,5vw,56px);font-weight:800;line-height:1.15;margin-bottom:16px;background:linear-gradient(135deg,#fff 0%,var(--blue) 60%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:16px;color:var(--text2);max-width:580px;margin:0 auto 32px;line-height:1.7}
.hbadges{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.hb{display:flex;align-items:center;gap:5px;padding:7px 14px;border-radius:8px;font-size:11px;font-weight:600;letter-spacing:.2px;border:1px solid var(--border);background:var(--glass);color:var(--text2)}

/* INPUT */
.isection{position:relative;z-index:1;max-width:720px;margin:0 auto;padding:0 20px 48px}
.icard{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:28px;backdrop-filter:blur(16px);position:relative;overflow:hidden}
.icard::before{content:'';position:absolute;top:-1px;left:50%;transform:translateX(-50%);width:100px;height:2px;background:linear-gradient(90deg,transparent,var(--blue),transparent);border-radius:2px}
.ilabel{font-size:12px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-bottom:16px}
.irow{display:grid;grid-template-columns:1fr 1fr 110px;gap:10px}
.iwrap{position:relative}
.ipt{width:100%;padding:12px 14px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;font-size:14px;color:var(--text);font-family:'DM Sans',sans-serif;transition:all .3s;outline:none}
.ipt::placeholder{color:var(--text3)}.ipt:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(59,130,246,.08)}
.ac{position:absolute;top:100%;left:0;right:0;background:var(--bg3);border:1.5px solid var(--border2);border-top:none;border-radius:0 0 10px 10px;max-height:280px;overflow-y:auto;display:none;z-index:1000;box-shadow:0 16px 40px rgba(0,0,0,.5)}
.ac.show{display:block}
.aci{padding:10px 14px;cursor:pointer;border-bottom:1px solid var(--border);transition:all .2s;display:flex;align-items:center;gap:8px}
.aci:hover{background:rgba(59,130,246,.05);padding-left:18px}
.act{font-family:var(--mono);font-weight:600;color:var(--blue);font-size:13px;min-width:75px}.acn{color:var(--text2);font-size:12px}
.btn{width:100%;padding:12px;border:none;border-radius:10px;font-size:14px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .3s;background:linear-gradient(135deg,var(--blue2),var(--blue));color:#fff;letter-spacing:.2px}
.btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(59,130,246,.25)}.btn:disabled{opacity:.5;cursor:not-allowed}
.btn.ld{background:var(--bg3);color:var(--blue);border:1.5px solid var(--border2)}
.hlp{margin-top:14px;font-size:11px;color:var(--text3);line-height:1.7}.hlp a{color:var(--blue);text-decoration:none}.hlp strong{color:var(--text2)}

/* STATUS */
.sbar{margin-top:14px;padding:12px 16px;border-radius:10px;display:none;font-size:13px;font-weight:500;border:1px solid;align-items:center;gap:8px}
.sbar.show{display:flex;animation:sld .3s ease}.sbar.info{background:rgba(59,130,246,.06);border-color:rgba(59,130,246,.2);color:var(--blue)}
.sbar.success{background:rgba(16,185,129,.06);border-color:rgba(16,185,129,.2);color:var(--green)}.sbar.error{background:rgba(239,68,68,.06);border-color:rgba(239,68,68,.2);color:var(--red)}
@keyframes sld{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}

/* LOADING */
.lsteps{margin-top:14px;display:none}.lsteps.show{display:block}
.ls{display:flex;align-items:center;gap:10px;padding:8px 0;font-size:12px;color:var(--text3);opacity:0;transform:translateX(-8px);transition:all .4s}
.ls.on{opacity:1;transform:translateX(0);color:var(--blue)}.ls.ok{opacity:1;transform:translateX(0);color:var(--green)}
.lsi{width:22px;height:22px;border-radius:50%;border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0;font-family:var(--mono);transition:all .3s}
.ls.on .lsi{border-color:var(--blue);color:var(--blue);animation:pdot 1.5s infinite}.ls.ok .lsi{border-color:var(--green);background:var(--green);color:var(--bg)}

/* RATE LIMIT */
.rlbox{margin-top:14px;display:none;padding:20px;border-radius:12px;text-align:center;background:rgba(245,158,11,.05);border:1px solid rgba(245,158,11,.2)}
.rlbox .rlcd{font-family:var(--mono);font-size:38px;font-weight:700;color:var(--amber);margin:8px 0;letter-spacing:3px}
.rlbox .rlmsg{font-size:12px;color:var(--text3)}
.rlbox .rlbar{width:100%;height:3px;background:rgba(245,158,11,.1);border-radius:2px;margin-top:12px;overflow:hidden}
.rlbox .rlbf{height:100%;background:linear-gradient(90deg,var(--amber),var(--green));border-radius:2px;transition:width 1s linear}

/* REPORT */
.rpt{position:relative;z-index:1;max-width:1080px;margin:0 auto;padding:0 20px 64px;display:none}
.rpt.show{display:block;animation:fu .6s ease}
@keyframes fu{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

.rphero{text-align:center;margin-bottom:32px;padding:40px 28px;border-radius:16px;border:1px solid var(--border);background:linear-gradient(135deg,rgba(59,130,246,.03),rgba(6,182,212,.03));position:relative;overflow:hidden}
.rphero::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,rgba(59,130,246,.02),transparent,rgba(6,182,212,.02),transparent);animation:spin 25s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.rphero>*{position:relative;z-index:1}
.rptk{display:inline-block;font-family:var(--mono);font-size:13px;font-weight:600;color:var(--blue);background:rgba(59,130,246,.1);padding:5px 16px;border-radius:6px;border:1px solid rgba(59,130,246,.2);margin-bottom:12px;letter-spacing:.8px}
.rpco{font-family:'Sora',sans-serif;font-size:clamp(24px,3.5vw,36px);font-weight:800;margin-bottom:10px}
.rplv{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--green);font-weight:500}

/* METRICS */
.mgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}
.mcard{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px 16px;text-align:center;backdrop-filter:blur(10px);transition:all .3s;position:relative;overflow:hidden}
.mcard:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 8px 24px rgba(59,130,246,.08)}
.mcard::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--blue),var(--cyan));opacity:0;transition:opacity .3s}.mcard:hover::after{opacity:1}
.ml{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);font-weight:600;margin-bottom:8px}
.mv{font-family:var(--mono);font-size:24px;font-weight:700;color:#fff;margin-bottom:4px}
.ms{font-size:12px;font-weight:600}.ms.up{color:var(--green)}.ms.dn{color:var(--red)}.ms.nu{color:var(--text3)}

/* CHARTS */
.cgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px}
.cgrid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
.ccard{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px;backdrop-filter:blur(10px)}
.cct{font-size:13px;font-weight:700;color:var(--text2);margin-bottom:14px;display:flex;align-items:center;gap:6px}
.cc{height:180px}
.cc2{height:200px}

/* STICKY INPUT */
.isection{position:relative;z-index:1}

/* SECTIONS - Always open, no accordion */
.sc{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:0;margin-bottom:12px;backdrop-filter:blur(10px);transition:all .4s;opacity:0;transform:translateY(16px);overflow:visible}
.sc.vis{opacity:1;transform:translateY(0)}.sc:hover{border-color:var(--border2)}
.sh{display:flex;align-items:center;gap:10px;padding:18px 24px 0}
.si{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.st{font-family:'Sora',sans-serif;font-size:14px;font-weight:700;letter-spacing:-.2px;flex:1}
.sbody{padding:16px 24px 24px;overflow:visible}

/* Verdict */
.vpill{display:inline-flex;padding:10px 32px;border-radius:100px;font-family:'Sora',sans-serif;font-size:18px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;animation:vg 2s ease-in-out infinite alternate}
.vpill.buy{background:rgba(16,185,129,.12);color:var(--green);border:2px solid var(--green)}
.vpill.hold{background:rgba(245,158,11,.12);color:var(--amber);border:2px solid var(--amber)}
.vpill.sell{background:rgba(239,68,68,.12);color:var(--red);border:2px solid var(--red)}
@keyframes vg{0%{box-shadow:0 0 16px rgba(59,130,246,.05)}100%{box-shadow:0 0 32px rgba(59,130,246,.12)}}

/* Tables */
.dt{width:100%;border-collapse:collapse}
.dt th{padding:12px 14px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:.7px;color:var(--text3);font-weight:600;border-bottom:1px solid var(--border);background:rgba(59,130,246,.02)}
.dt td{padding:12px 14px;border-bottom:1px solid var(--border);font-size:13px;color:var(--text2);transition:background .2s}
.dt tr:hover td{background:rgba(59,130,246,.02)}.dt tr:last-child td{border-bottom:none}

/* Decision list */
.dl{list-style:none;padding:0}.dl li{padding:12px 0 12px 32px;position:relative;font-size:13px;color:var(--text2);line-height:1.7;border-bottom:1px solid var(--border)}
.dl li:last-child{border-bottom:none}.dl li::before{content:'';position:absolute;left:0;top:16px;width:18px;height:18px;border-radius:50%;background:rgba(59,130,246,.1);border:1.5px solid var(--blue)}
.dl li strong{color:var(--text)}

/* Price tags */
.ptag{display:inline-block;padding:5px 12px;border-radius:6px;font-family:var(--mono);font-size:13px;font-weight:600}
.ptag.buy{background:rgba(16,185,129,.08);color:var(--green);border:1px solid rgba(16,185,129,.2)}
.ptag.cur{background:rgba(59,130,246,.08);color:var(--blue);border:1px solid rgba(59,130,246,.2)}
.ptag.pro{background:rgba(245,158,11,.08);color:var(--amber);border:1px solid rgba(245,158,11,.2)}
.ptag.stp{background:rgba(239,68,68,.08);color:var(--red);border:1px solid rgba(239,68,68,.2)}

/* Signals */
.sig{display:inline-flex;align-items:center;gap:3px;padding:3px 8px;border-radius:5px;font-size:11px;font-weight:700}
.sig.g{background:rgba(16,185,129,.1);color:var(--green)}.sig.c{background:rgba(245,158,11,.1);color:var(--amber)}
.sig.r{background:rgba(239,68,68,.1);color:var(--red)}.sig.n{background:rgba(148,163,184,.08);color:var(--text3)}

/* Info cards */
.ic{padding:18px;border-radius:10px;margin-bottom:12px;border-left:3px solid}
.ic h5{font-size:14px;font-weight:700;margin-bottom:6px}.ic p{font-size:13px;line-height:1.8;color:var(--text2)}
.ic.bl{background:rgba(59,130,246,.03);border-color:var(--blue)}.ic.bl h5{color:var(--blue)}
.ic.am{background:rgba(245,158,11,.03);border-color:var(--amber)}.ic.am h5{color:var(--amber)}
.ic.gr{background:rgba(16,185,129,.03);border-color:var(--green)}.ic.gr h5{color:var(--green)}
.ic.rd{background:rgba(239,68,68,.03);border-color:var(--red)}.ic.rd h5{color:var(--red)}
.ic.pu{background:rgba(139,92,246,.03);border-color:var(--purple)}.ic.pu h5{color:var(--purple)}

.aix{display:inline-flex;align-items:center;gap:5px;cursor:pointer;color:var(--blue);font-size:12px;font-weight:600;padding:6px 0;transition:color .2s}.aix:hover{color:#fff}
.ait{line-height:1.9;color:var(--text2);font-size:13px;white-space:pre-wrap}
.ait::-webkit-scrollbar{width:5px}.ait::-webkit-scrollbar-track{background:var(--bg);border-radius:3px}.ait::-webkit-scrollbar-thumb{background:rgba(59,130,246,.25);border-radius:3px}.ait::-webkit-scrollbar-thumb:hover{background:rgba(59,130,246,.4)}

/* 52-week position bar */
.w52bar{position:relative;height:8px;background:rgba(148,163,184,.1);border-radius:4px;margin:16px 0 8px;overflow:visible}
.w52fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--red),var(--amber),var(--green))}
.w52dot{position:absolute;top:50%;transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;background:var(--blue);border:2px solid #fff;box-shadow:0 0 12px rgba(59,130,246,.4);z-index:2}
.w52labels{display:flex;justify-content:space-between;font-family:var(--mono);font-size:11px;color:var(--text3)}

/* Score bar */
.scorebar{height:6px;background:rgba(148,163,184,.1);border-radius:3px;overflow:hidden;margin:6px 0}
.scorefill{height:100%;border-radius:3px;transition:width .8s ease}

/* Footer */
footer{position:relative;z-index:1;margin-top:32px;background:rgba(6,10,19,.95);border-top:1px solid var(--border)}
.ftop{max-width:1080px;margin:0 auto;padding:48px 28px 32px;display:grid;grid-template-columns:1.4fr 1fr 1fr;gap:40px}
.ftop h5{font-family:'Sora',sans-serif;font-size:14px;font-weight:700;color:#fff;margin-bottom:14px}
.ftop p{font-size:12px;color:var(--text3);line-height:1.8;margin-bottom:8px}
.fbrand{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.fblogo{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,var(--blue),var(--cyan));display:flex;align-items:center;justify-content:center;font-family:'Sora',sans-serif;font-size:14px;font-weight:800;color:#fff}
.fbname{font-family:'Sora',sans-serif;font-size:14px;font-weight:700;color:#fff}.fbname span{color:var(--blue)}
.ffeature{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text3);padding:5px 0}
.ffeature::before{content:'\2713';color:var(--green);font-weight:700;font-size:10px}
.fdisc{max-width:1080px;margin:0 auto;padding:0 28px 32px}
.fdbox{padding:24px;border-radius:12px;background:rgba(239,68,68,.05);border:1.5px solid rgba(239,68,68,.2);position:relative;overflow:hidden}
.fdbox::before{content:'\26A0';position:absolute;top:12px;right:16px;font-size:44px;opacity:.06}
.fdbox h4{color:var(--red);font-size:13px;font-weight:800;margin-bottom:12px;letter-spacing:.5px;text-transform:uppercase;display:flex;align-items:center;gap:6px}
.fdbox p{color:var(--text2);font-size:12px;line-height:1.8;margin-bottom:8px;padding-left:14px;border-left:2px solid rgba(239,68,68,.15)}
.fdbox p strong{color:var(--red);font-weight:700}
.fdbox p:last-child{margin-bottom:0}
.fbot{max-width:1080px;margin:0 auto;padding:24px 28px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.fcopy{font-size:11px;color:var(--text3)}.fcopy strong{color:var(--text2)}
.flinks{display:flex;gap:16px}.flinks a{font-size:11px;color:var(--text3);text-decoration:none;transition:color .2s}.flinks a:hover{color:var(--blue)}

@media(max-width:768px){.irow{grid-template-columns:1fr}.mgrid{grid-template-columns:1fr 1fr}.cgrid,.cgrid2{grid-template-columns:1fr}.hero{padding:40px 16px 32px}.ncenter,.nright{display:none}.sc{padding:20px 16px}.ftop{grid-template-columns:1fr;gap:24px}.fbot{flex-direction:column;text-align:center}}
@media(max-width:480px){.mgrid{grid-template-columns:1fr}.hbadges{flex-direction:column;align-items:center}}

/* FLOATING FEEDBACK PANEL */
.fab{position:fixed;bottom:24px;right:24px;z-index:200;display:flex;align-items:center;gap:6px;padding:10px 20px;border-radius:100px;font-size:13px;font-weight:700;color:#fff;background:linear-gradient(135deg,var(--blue2),var(--purple));cursor:pointer;box-shadow:0 4px 20px rgba(59,130,246,.3);transition:all .3s;border:none;font-family:'DM Sans',sans-serif;letter-spacing:.2px}
.fab:hover{transform:translateY(-3px) scale(1.03);box-shadow:0 8px 30px rgba(59,130,246,.4)}
.fab .pulse{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pdot 2s infinite}

/* Slide panel */
.fpanel{position:fixed;top:0;right:-480px;width:460px;max-width:92vw;height:100vh;z-index:300;background:var(--bg2);border-left:1px solid var(--border2);overflow-y:auto;transition:right .4s cubic-bezier(.16,1,.3,1);box-shadow:-8px 0 40px rgba(0,0,0,.5)}
.fpanel.open{right:0}
.fpanel::-webkit-scrollbar{width:5px}.fpanel::-webkit-scrollbar-thumb{background:rgba(59,130,246,.2);border-radius:3px}
.fphdr{position:sticky;top:0;z-index:1;padding:20px 24px;background:rgba(11,17,32,.95);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.fphdr h3{font-family:'Sora',sans-serif;font-size:16px;font-weight:800;background:linear-gradient(135deg,var(--amber),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.fpclose{width:32px;height:32px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text3);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.fpclose:hover{background:rgba(239,68,68,.1);color:var(--red);border-color:rgba(239,68,68,.2)}
.fpbody{padding:20px 24px 32px}
.fpbody .sub{font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:24px}

/* Feature cards (panel version) */
.pfcard{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px;transition:all .3s}
.pfcard:hover{border-color:var(--border2)}
.pfcard .pfrow{display:flex;align-items:flex-start;gap:12px}
.pfcard .pficon{font-size:24px;flex-shrink:0;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(59,130,246,.05)}
.pfcard .pfinfo{flex:1;min-width:0}
.pfcard .pfname{font-family:'Sora',sans-serif;font-size:13px;font-weight:700;color:#fff;margin-bottom:3px;display:flex;align-items:center;gap:6px}
.pfcard .pfdesc{font-size:11px;color:var(--text3);line-height:1.6}
.pfcard .ftag{display:inline-block;font-size:8px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;padding:2px 7px;border-radius:100px}
.ftag.hot{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.15)}
.ftag.new{background:rgba(16,185,129,.1);color:var(--green);border:1px solid rgba(16,185,129,.15)}
.ftag.pro{background:rgba(139,92,246,.1);color:var(--purple);border:1px solid rgba(139,92,246,.15)}

/* Vote buttons */
.pvbtns{display:flex;gap:6px;margin-top:10px}
.pvbtn{display:flex;align-items:center;gap:4px;padding:5px 12px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;border:1px solid var(--border);background:transparent;color:var(--text3);font-family:'DM Sans',sans-serif}
.pvbtn:hover{transform:scale(1.05)}
.pvbtn.up:hover,.pvbtn.up.voted{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.3);color:var(--green)}
.pvbtn.dn:hover,.pvbtn.dn.voted{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.3);color:var(--red)}
.pvbtn .cnt{font-family:var(--mono);font-size:10px}
.pvbar{margin-top:6px;height:3px;border-radius:2px;background:rgba(148,163,184,.08);overflow:hidden}
.pvbar .vfill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--green),var(--blue));transition:width .5s ease}

/* Vote chart in panel */
.vgp{margin-top:20px;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:12px}
.vgp h4{font-family:'Sora',sans-serif;font-size:13px;font-weight:700;color:#fff;margin-bottom:4px;text-align:center}
.vgp .vsub{font-size:10px;color:var(--text3);text-align:center;margin-bottom:12px}
.vgp .cc{height:200px}

.sendbox{text-align:center;margin-top:16px}
.sendbtn{display:inline-flex;align-items:center;gap:6px;padding:9px 20px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:1.5px solid rgba(59,130,246,.3);background:rgba(59,130,246,.06);color:var(--blue);transition:all .3s;font-family:'DM Sans',sans-serif;width:100%}
.sendbtn:hover{background:rgba(59,130,246,.12)}

/* Backdrop */
.fpbk{position:fixed;inset:0;z-index:250;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .3s}
.fpbk.open{opacity:1;pointer-events:auto}

@media(max-width:768px){.fab{bottom:16px;right:16px;padding:8px 16px;font-size:12px}}

/* Anti-copy protection */
body{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.ipt,input,textarea{-webkit-user-select:text;-moz-user-select:text;user-select:text}

</style>
</head>
<body>
<div class="gridbg"></div>

<nav>
<div class="nbrand">
<div class="nlogo">S</div>
<div><div class="nname">SENTINEL <span>AI</span></div><div class="ntag">Research Platform</div></div>
</div>
<div class="ncenter">
<div class="npill">Reports: <span class="v" id="navRC">0</span></div>
<div class="npill">Quota: <span class="v" id="navQ">5/hr</span></div>
</div>
<div class="nright">
<div class="nlive"><div class="ldot"></div> Live Market Data</div>

</div>
</nav>

<section class="hero">
<div class="hero-eye"><div class="ldot"></div> Live Market Data &middot; Updated Every Minute</div>
<h1>Stop Guessing. Start Knowing.</h1>
<p class="hero-sub">Premium research firms charge hundreds per report for this. You get it in 60 seconds, for free. Real-time data, AI-powered insights, exact buy/sell prices — everything you need to make your next move.</p>
<div class="hbadges">
<div class="hb">&#9678; Real-Time Market Data</div>
<div class="hb">&#9889; AI Deep Analysis</div>
<div class="hb">&#9678; Exact Entry &amp; Exit Prices</div>
<div class="hb">&#9651; Risk Scoring</div>
<div class="hb">&#9733; Hidden Gem Small-Caps</div>
</div>

</section>

<section class="isection">
<div class="icard">
<div class="ilabel">Your next smart move starts here</div>
<div class="irow">
<input class="ipt" type="email" id="email" placeholder="your@email.com" autocomplete="email">
<div class="iwrap"><input class="ipt" type="text" id="ticker" placeholder="Ticker or company..." autocomplete="off"><div class="ac" id="autocomplete"></div></div>
<button class="btn" id="btn" onclick="analyze()">Analyze &#8594;</button>
</div>
<div class="hlp">
Type to search <strong>100 stocks</strong> (US &amp; India) &middot; Or enter any valid ticker symbol<br>
&#128293; <strong>5 free deep-dive reports</strong> per email per hour &middot; No signup, no credit card<br>
&#128270; <strong>Ticker not showing?</strong> <a href="https://finance.yahoo.com/lookup" target="_blank" rel="noopener">Search for your stock ticker here</a> and paste it above
</div>
<div style="text-align:center;margin-top:10px;font-size:12px;color:var(--text3)">
&#128200; <strong style="color:var(--blue);font-family:var(--mono)" id="globalRC">0</strong> reports generated and counting
</div>

<div class="sbar" id="status"></div>
<div class="lsteps" id="lsteps">
<div class="ls" id="s1"><div class="lsi">1</div> Pulling live market data &amp; financials...</div>
<div class="ls" id="s2"><div class="lsi">2</div> AI crunching valuation &amp; fundamentals...</div>
<div class="ls" id="s3"><div class="lsi">3</div> Computing entry, exit &amp; stop-loss prices...</div>
<div class="ls" id="s4"><div class="lsi">4</div> Scoring risk &amp; finding hidden gem small-caps...</div>
</div>
<div class="rlbox" id="rateLimitBox">
<div style="font-size:13px;font-weight:600;color:var(--amber)">Report limit reached</div>
<div class="rlcd" id="rlCountdown">--:--</div>
<div class="rlmsg" id="rlComeback"></div>
<div class="rlbar"><div class="rlbf" id="rlProgress" style="width:0%"></div></div>
</div>
</div>
</section>

<section class="rpt" id="report">
<!-- PRE-REPORT DISCLAIMER -->
<div style="margin-bottom:16px;padding:12px 18px;border-radius:10px;background:rgba(239,68,68,.05);border:1px solid rgba(239,68,68,.15);display:flex;align-items:center;gap:8px;font-size:12px;color:var(--text2)">
<span style="font-size:16px">&#9888;</span>
<span><strong style="color:var(--red)">Reminder:</strong> AI-generated research for education only. Not financial advice. Always verify with a licensed professional.</span>
</div>
<div class="rphero">
<div class="rptk" id="tickerTag"></div>
<div class="rpco" id="companyName"></div>
<div class="rplv" id="timestamp"><div class="ldot"></div></div>
</div>
<div class="mgrid" id="metrics"></div>

<!-- 3 CHARTS ROW -->
<div class="cgrid">
<div class="ccard"><div class="cct">&#9678; Valuation Metrics <span style="font-size:10px;color:var(--text3);font-weight:400">&middot; hover bars for details</span></div><div class="cc"><canvas id="valChart"></canvas></div></div>
<div class="ccard"><div class="cct">&#9678; Financial Health <span style="font-size:10px;color:var(--text3);font-weight:400">&middot; hover dots for details</span></div><div class="cc"><canvas id="healthChart"></canvas></div></div>
<div class="ccard"><div class="cct">&#9678; Risk Profile <span style="font-size:10px;color:var(--text3);font-weight:400">&middot; hover dots for details</span></div><div class="cc"><canvas id="riskChart"></canvas></div></div>
</div>
<!-- 2 CHARTS ROW -->
<div class="cgrid2">
<div class="ccard"><div class="cct">&#9678; Price Trend (6M) <span style="font-size:10px;color:var(--text3);font-weight:400">&middot; hover points to track</span></div><div class="cc2"><canvas id="trendChart"></canvas></div></div>
<div class="ccard"><div class="cct">&#9678; Margin vs Industry <span style="font-size:10px;color:var(--text3);font-weight:400">&middot; hover to compare</span></div><div class="cc2"><canvas id="marginChart"></canvas></div></div>
</div>

<!-- 52-WEEK POSITION -->
<div class="sc vis" id="w52section" style="opacity:1;transform:none"></div>

<div id="analysisContainer"></div>

<!-- POST-REPORT DISCLAIMER -->
<div style="margin-top:16px;padding:12px 18px;border-radius:10px;background:rgba(239,68,68,.05);border:1px solid rgba(239,68,68,.15);display:flex;align-items:center;gap:8px;font-size:12px;color:var(--text2)">
<span style="font-size:16px">&#9888;</span>
<span><strong style="color:var(--red)">Reminder:</strong> Past performance does not guarantee future results. You can lose money investing. Always do your own research.</span>
</div>
</section>

<footer>
<div style="max-width:1080px;margin:0 auto;padding:28px 28px 20px">
<!-- Compact brand row -->
<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;margin-bottom:20px">
<div style="display:flex;align-items:center;gap:10px">
<div class="fblogo">S</div>
<div><div class="fbname">SENTINEL <span>AI</span></div><div style="font-size:9px;color:var(--text3);letter-spacing:1px;text-transform:uppercase">Research Platform</div></div>
</div>
<div style="display:flex;gap:16px;font-size:11px;color:var(--text3);flex-wrap:wrap">
<span>✓ Real-time data</span>
<span>✓ AI analysis</span>
<span>✓ Entry/exit prices</span>
<span>✓ Risk scoring</span>
<span>✓ Small-cap picks</span>
</div>
</div>
<!-- Disclaimer -->
<div class="fdbox">
<h4>&#9888; Read This Before You Trade</h4>
<p><strong>NOT FINANCIAL ADVICE:</strong> This tool is for education only. Not a replacement for licensed financial advisors. Never invest money you cannot afford to lose.</p>
<p><strong>DATA MAY BE DELAYED:</strong> Market data from third-party providers may be delayed or incomplete. Always cross-check with your broker.</p>
<p><strong>YOU CAN LOSE MONEY:</strong> All investments carry real risk. Past performance never guarantees future results. No affiliation with any brokerage.</p>
</div>
<!-- Bottom bar -->
<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border)">
<div style="font-size:11px;color:var(--text3)"><strong style="color:var(--text2)">&copy; 2026 Sentinel AI Research</strong> &middot; All rights reserved</div>
<div style="display:flex;gap:16px"><a href="#" style="font-size:11px;color:var(--text3);text-decoration:none">Privacy</a><a href="#" style="font-size:11px;color:var(--text3);text-decoration:none">Terms</a><a href="#" style="font-size:11px;color:var(--text3);text-decoration:none">Contact</a></div>
</div>
</div>
</footer>

<script>

const stocks=[
{t:'AAPL',n:'Apple Inc.'},{t:'MSFT',n:'Microsoft Corporation'},{t:'GOOGL',n:'Alphabet Inc. (Google)'},{t:'AMZN',n:'Amazon.com Inc.'},
{t:'NVDA',n:'NVIDIA Corporation'},{t:'META',n:'Meta Platforms (Facebook)'},{t:'TSLA',n:'Tesla Inc.'},{t:'BRK.B',n:'Berkshire Hathaway'},
{t:'LLY',n:'Eli Lilly and Company'},{t:'AVGO',n:'Broadcom Inc.'},{t:'JPM',n:'JPMorgan Chase & Co.'},{t:'V',n:'Visa Inc.'},
{t:'UNH',n:'UnitedHealth Group'},{t:'XOM',n:'Exxon Mobil'},{t:'WMT',n:'Walmart Inc.'},{t:'MA',n:'Mastercard Inc.'},
{t:'PG',n:'Procter & Gamble'},{t:'JNJ',n:'Johnson & Johnson'},{t:'HD',n:'Home Depot'},{t:'ORCL',n:'Oracle Corporation'},
{t:'COST',n:'Costco Wholesale'},{t:'NFLX',n:'Netflix Inc.'},{t:'BAC',n:'Bank of America'},{t:'CRM',n:'Salesforce Inc.'},
{t:'ABBV',n:'AbbVie Inc.'},{t:'CVX',n:'Chevron Corporation'},{t:'AMD',n:'Advanced Micro Devices'},{t:'KO',n:'Coca-Cola Company'},
{t:'PEP',n:'PepsiCo Inc.'},{t:'MRK',n:'Merck & Co.'},{t:'ADBE',n:'Adobe Inc.'},{t:'TMO',n:'Thermo Fisher Scientific'},
{t:'CSCO',n:'Cisco Systems'},{t:'ACN',n:'Accenture'},{t:'MCD',n:"McDonald's Corporation"},{t:'LIN',n:'Linde plc'},
{t:'ABT',n:'Abbott Laboratories'},{t:'WFC',n:'Wells Fargo'},{t:'TXN',n:'Texas Instruments'},{t:'INTC',n:'Intel Corporation'},
{t:'DIS',n:'Walt Disney Company'},{t:'PM',n:'Philip Morris'},{t:'CMCSA',n:'Comcast Corporation'},{t:'NKE',n:'Nike Inc.'},
{t:'QCOM',n:'Qualcomm Inc.'},{t:'GE',n:'General Electric'},{t:'INTU',n:'Intuit Inc.'},{t:'VZ',n:'Verizon Communications'},
{t:'AMAT',n:'Applied Materials'},{t:'CAT',n:'Caterpillar Inc.'},
{t:'RELIANCE.NS',n:'Reliance Industries'},{t:'TCS.NS',n:'Tata Consultancy Services'},{t:'HDFCBANK.NS',n:'HDFC Bank'},
{t:'INFY',n:'Infosys Limited'},{t:'HINDUNILVR.NS',n:'Hindustan Unilever'},{t:'ICICIBANK.NS',n:'ICICI Bank'},
{t:'SBIN.NS',n:'State Bank of India'},{t:'BHARTIARTL.NS',n:'Bharti Airtel'},{t:'ITC.NS',n:'ITC Limited'},
{t:'KOTAKBANK.NS',n:'Kotak Mahindra Bank'},{t:'LT.NS',n:'Larsen & Toubro'},{t:'AXISBANK.NS',n:'Axis Bank'},
{t:'BAJFINANCE.NS',n:'Bajaj Finance'},{t:'ASIANPAINT.NS',n:'Asian Paints'},{t:'MARUTI.NS',n:'Maruti Suzuki'},
{t:'TITAN.NS',n:'Titan Company'},{t:'SUNPHARMA.NS',n:'Sun Pharmaceutical'},{t:'ULTRACEMCO.NS',n:'UltraTech Cement'},
{t:'NESTLEIND.NS',n:'Nestlé India'},{t:'ONGC.NS',n:'Oil & Natural Gas Corp'},{t:'NTPC.NS',n:'NTPC Limited'},
{t:'TATAMOTORS.NS',n:'Tata Motors'},{t:'POWERGRID.NS',n:'Power Grid Corporation'},{t:'TATASTEEL.NS',n:'Tata Steel'},
{t:'M&M.NS',n:'Mahindra & Mahindra'},{t:'JSWSTEEL.NS',n:'JSW Steel'},{t:'ADANIENT.NS',n:'Adani Enterprises'},
{t:'WIPRO.NS',n:'Wipro Limited'},{t:'COALINDIA.NS',n:'Coal India'},{t:'HCLTECH.NS',n:'HCL Technologies'},
{t:'BAJAJFINSV.NS',n:'Bajaj Finserv'},{t:'DIVISLAB.NS',n:"Divi's Laboratories"},{t:'GRASIM.NS',n:'Grasim Industries'},
{t:'TECHM.NS',n:'Tech Mahindra'},{t:'BRITANNIA.NS',n:'Britannia Industries'},{t:'EICHERMOT.NS',n:'Eicher Motors'},
{t:'APOLLOHOSP.NS',n:'Apollo Hospitals'},{t:'INDUSINDBK.NS',n:'IndusInd Bank'},{t:'TRENT.NS',n:'Trent Limited'},
{t:'ADANIPORTS.NS',n:'Adani Ports'},{t:'HINDALCO.NS',n:'Hindalco Industries'},{t:'DRREDDY.NS',n:"Dr. Reddy's Labs"},
{t:'CIPLA.NS',n:'Cipla Limited'},{t:'HEROMOTOCO.NS',n:'Hero MotoCorp'},{t:'SHREECEM.NS',n:'Shree Cement'},
{t:'BAJAJ-AUTO.NS',n:'Bajaj Auto'},{t:'BPCL.NS',n:'Bharat Petroleum'},{t:'SIEMENS.NS',n:'Siemens India'},
{t:'KPIT.NS',n:'KPIT Technologies'},{t:'DIXON.NS',n:'Dixon Technologies'}
];
let valChart,trendChart,healthChart,riskChart,marginChart,countdownInterval=null;
const TI=document.getElementById('ticker'),AC=document.getElementById('autocomplete');
TI.addEventListener('input',function(){const v=this.value.trim().toUpperCase();AC.innerHTML='';if(!v){AC.classList.remove('show');return}
const m=stocks.filter(s=>s.t.includes(v)||s.n.toUpperCase().includes(v)).slice(0,10);if(!m.length){AC.classList.remove('show');return}
m.forEach(s=>{const d=document.createElement('div');d.className='aci';d.innerHTML=`<span class="act">${s.t}</span><span class="acn">${s.n}</span>`;d.onclick=()=>{TI.value=s.t;AC.classList.remove('show')};AC.appendChild(d)});AC.classList.add('show')});
document.addEventListener('click',e=>{if(e.target!==TI)AC.classList.remove('show')});
document.getElementById('email').addEventListener('keypress',e=>{if(e.key==='Enter')TI.focus()});
TI.addEventListener('keypress',e=>{if(e.key==='Enter')analyze()});

function showStatus(m,t){const s=document.getElementById('status');s.innerHTML=m;s.className='sbar show '+t}
function showLS(){const b=document.getElementById('lsteps');b.classList.add('show');['s1','s2','s3','s4'].forEach(s=>{document.getElementById(s).className='ls'});
let i=0;const ids=['s1','s2','s3','s4'];b._iv=setInterval(()=>{if(i>0)document.getElementById(ids[i-1]).classList.replace('on','ok');if(i<ids.length){document.getElementById(ids[i]).classList.add('on');i++}else clearInterval(b._iv)},7000);document.getElementById(ids[0]).classList.add('on')}
function hideLS(){const b=document.getElementById('lsteps');if(b._iv)clearInterval(b._iv);b.classList.remove('show')}
function hideRL(){document.getElementById('rateLimitBox').style.display='none';if(countdownInterval){clearInterval(countdownInterval);countdownInterval=null}}
function showRL(data){const box=document.getElementById('rateLimitBox'),cd=document.getElementById('rlCountdown'),cb=document.getElementById('rlComeback'),pr=document.getElementById('rlProgress');
let ts=data.retry_after_seconds||(data.retry_after_minutes||5)*60;const tt=new Date(Date.now()+ts*1000);
cb.textContent='Come back at '+tt.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})+' \u00B7 '+(data.requests_limit||5)+' fresh reports';box.style.display='block';
if(countdownInterval)clearInterval(countdownInterval);const ss=ts;
function tick(){const r=Math.max(0,Math.floor((tt-Date.now())/1000)),mn=Math.floor(r/60),sc=r%60;
cd.textContent=String(mn).padStart(2,'0')+':'+String(sc).padStart(2,'0');pr.style.width=Math.min(100,((ss-r)/ss)*100)+'%';
if(r<=0){clearInterval(countdownInterval);countdownInterval=null;cd.textContent='00:00';cd.style.color='var(--green)';
cb.textContent='\u2713 Quota refreshed \u2014 generate reports again';pr.style.width='100%';box.style.borderColor='rgba(16,185,129,.3)';box.style.background='rgba(16,185,129,.04)'}}
tick();countdownInterval=setInterval(tick,1000)}

async function analyze(){const email=document.getElementById('email').value.trim(),ticker=TI.value.trim().toUpperCase(),btn=document.getElementById('btn'),rpt=document.getElementById('report');
AC.classList.remove('show');if(!email||!ticker){showStatus('Enter both email and ticker','error');return}
if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){showStatus('Enter a valid email','error');return}
try{const rl=await fetch('/api/check-rate-limit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});const rld=await rl.json();
if(!rld.allowed){showStatus(rld.reason,'error');showRL(rld);return}else hideRL()}catch(e){}
btn.disabled=true;btn.textContent='Analyzing...';btn.classList.add('ld');rpt.classList.remove('show');hideRL();
showStatus('Crunching the numbers on '+ticker+'...','info');showLS();
try{const res=await fetch('/api/generate-report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({company_name:ticker,email})});
if(res.status===429){const r=await res.json().catch(()=>({}));showStatus(r.reason||r.detail||'Too many requests','error');if(r.retry_after_seconds||r.retry_after_minutes)showRL(r);return}
if(res.status===503||res.status===504){const e=await res.json().catch(()=>({}));showStatus(e.detail||'Service busy. Try again in 30s.','error');return}
if(!res.ok){const e=await res.json().catch(()=>({}));throw new Error(e.detail||e.message||'Analysis failed')}
const data=await res.json();if(!data.success||!data.live_data)throw new Error('No data for this ticker');
let q='';if(data.rate_limit){const r=data.rate_limit.remaining;document.getElementById('navQ').textContent=r+'/hr';
q=r===0?' \u00B7 Last free report this hour':' \u00B7 '+r+' remaining'}
if(data.report_number)document.getElementById('navRC').textContent=data.report_number;
if(data.report_number)document.getElementById('globalRC').textContent=data.report_number.toLocaleString();
showStatus('\u2713 Your report is ready. Scroll down \u2014 this is the good stuff.'+q,'success');displayReport(data);TI.value='';
}catch(e){let m=e.message;if(m==='Failed to fetch')m='Cannot connect to server.';
else if(m.toLowerCase().includes('rate limit')||m.toLowerCase().includes('too many')||m.toLowerCase().includes('temporarily'))m='Market data busy. Wait 2-3 min.';
showStatus(m,'error')}finally{btn.disabled=false;btn.textContent='Analyze \u2192';btn.classList.remove('ld');hideLS()}}

function displayReport(data){const d=data.live_data,curr=d.currency==='INR'?'\u20B9':'$',price=d.current_price;
document.getElementById('tickerTag').textContent=d.ticker;document.getElementById('companyName').textContent=d.company_name||d.ticker;
document.getElementById('timestamp').innerHTML='<div class="ldot"></div> LIVE \u00B7 '+d.data_timestamp;

// 8 METRICS (expanded from 4)
document.getElementById('metrics').innerHTML=`
<div class="mcard"><div class="ml">Price</div><div class="mv">${curr}${price.toLocaleString()}</div><div class="ms ${d.price_change>=0?'up':'dn'}">${d.price_change>=0?'\u25B2':'\u25BC'} ${Math.abs(d.price_change).toFixed(2)} (${d.price_change_pct.toFixed(2)}%)</div></div>
<div class="mcard"><div class="ml">P/E Ratio</div><div class="mv">${d.pe_ratio||'N/A'}</div><div class="ms nu">TTM</div></div>
<div class="mcard"><div class="ml">Market Cap</div><div class="mv">${formatCap(d.market_cap)}</div><div class="ms nu">${d.currency}</div></div>
<div class="mcard"><div class="ml">52W Range</div><div class="mv" style="font-size:16px">${curr}${d.week52_low}\u2014${curr}${d.week52_high}</div><div class="ms nu">Low / High</div></div>`;

// 52-WEEK POSITION BAR
const w52pct=Math.min(100,Math.max(0,((price-d.week52_low)/(d.week52_high-d.week52_low))*100));
document.getElementById('w52section').innerHTML=`
<div class="sh"><div class="si" style="background:rgba(59,130,246,.1)">&#9678;</div><div class="st" style="color:var(--blue)">Where Is the Price Sitting? 52-Week Map</div></div>
<p style="font-size:13px;color:var(--text2);margin-bottom:12px">This shows you at a glance whether the stock is closer to its yearly low (potential deal) or yearly high (riding momentum).</p>
<div class="w52bar"><div class="w52fill" style="width:100%"></div><div class="w52dot" style="left:${w52pct}%"></div></div>
<div class="w52labels"><span>${curr}${d.week52_low} (Low)</span><span style="color:var(--blue);font-weight:600">${curr}${price} (Now: ${w52pct.toFixed(0)}%)</span><span>${curr}${d.week52_high} (High)</span></div>
<div style="margin-top:14px;padding:14px;border-radius:8px;background:rgba(59,130,246,.04);border:1px solid rgba(59,130,246,.1)">
<p style="font-size:13px;color:var(--text2);line-height:1.7">${w52pct<25?'<strong style="color:var(--green)">\u25CF Bargain Alert:</strong> Trading near the yearly floor. If the fundamentals are solid (check below), this could be your chance to buy what others are panic-selling.':w52pct>75?'<strong style="color:var(--amber)">\u25CF Hot Streak:</strong> This stock is on fire \u2014 near its yearly peak. Great momentum, but do not chase blindly. Watch for resistance and potential pullbacks.':'<strong style="color:var(--blue)">\u25CF Middle Ground:</strong> Not too hot, not too cold. The stock is sitting in a neutral zone. Look at the fundamentals below to decide your next move.'}</p></div>`;

createCharts(d);createAnalysisSections(data.report,d);
document.getElementById('report').classList.add('show');
setTimeout(()=>document.getElementById('report').scrollIntoView({behavior:'smooth',block:'start'}),200);
setTimeout(animSections,400)}

function animSections(){
const obs=new IntersectionObserver(e=>{e.forEach(x=>{if(x.isIntersecting){x.target.classList.add('vis');obs.unobserve(x.target)}})},{threshold:.08});
document.querySelectorAll('.sc:not(.vis)').forEach(c=>obs.observe(c));
// Add scroll indicators to overflowing sections
setTimeout(()=>{
document.querySelectorAll('.sc').forEach(el=>{
if(el.scrollHeight>el.clientHeight+20){
const ind=document.createElement('div');
ind.className='sind';
ind.innerHTML='\u2193 scroll for more';
el.appendChild(ind);
el.addEventListener('scroll',function(){
const atBottom=this.scrollHeight-this.scrollTop<=this.clientHeight+30;
ind.style.opacity=atBottom?'0':'1';
},{passive:true});
}});
},600)}

function createAnalysisSections(report,d){
const curr=d.currency==='INR'?'\u20B9':'$',price=d.current_price,pe=parseFloat(d.pe_ratio)||0;
let verdict='HOLD',vc='hold';
if(pe>0&&pe<15&&d.price_change_pct>0){verdict='BUY';vc='buy'}else if(pe>40||d.price_change_pct<-5){verdict='SELL';vc='sell'}

const html=`
<!-- VERDICT (always open) -->
<div class="sc" style="text-align:center"><div class="sh" style="justify-content:center"><div class="si" style="background:rgba(16,185,129,.1)">&#9678;</div><div class="st" style="color:var(--green)" id="sec-verdict">Investment Verdict</div></div>
<div class="sbody"><div class="vpill ${vc}">${verdict}</div>
<p style="margin-top:10px;font-size:13px;color:var(--text2)">${verdict==='BUY'?'The numbers say GO. Looks promising at todays price.':verdict==='SELL'?'Red flags detected. Protect your capital.':'Hold steady. Wait for a clearer signal.'}</p></div></div>

<!-- DECISION POINTS -->
<div class="sc"><div class="sh"><div class="si" style="background:rgba(245,158,11,.1)">&#9651;</div><div class="st" style="color:var(--amber)" id="sec-5things">5 Things You Need to Know Right Now</div></div>
<div class="sbody">
<ul class="dl">
<li><strong>Price Action:</strong> Currently ${curr}${price.toLocaleString()} with ${d.price_change>=0?'positive':'negative'} momentum (${d.price_change_pct.toFixed(2)}%)</li>
<li><strong>Valuation:</strong> P/E of ${d.pe_ratio} suggests ${pe<15?'undervalued opportunity':pe<25?'fair valuation':'premium pricing'}. Forward P/E: ${d.forward_pe||'N/A'}</li>
<li><strong>Market Position:</strong> ${formatCap(d.market_cap)} market cap \u2014 ${d.market_cap>100e9?'large-cap':d.market_cap>10e9?'mid-cap':'small-cap'}</li>
<li><strong>Sector:</strong> ${d.sector} \u00B7 ${d.industry}</li>
<li><strong>Range:</strong> Trading at ${((price/d.week52_high)*100).toFixed(0)}% of 52-week high (Beta: ${d.beta})</li>
</ul></div></div>

<!-- VALUATION TABLE -->
<div class="sc"><div class="sh"><div class="si" style="background:rgba(59,130,246,.1)">&#9678;</div><div class="st" style="color:var(--blue)" id="sec-valuation">Are You Overpaying? Deep Valuation X-Ray</div></div>
<div class="sbody">
<p style="font-size:12px;color:var(--text3);margin-bottom:14px">Every number decoded. No jargon:</p>
<table class="dt"><tr><th>Metric</th><th>Value</th><th>Signal</th><th>What This Means For You</th></tr>
<tr><td><strong>P/E Ratio</strong><br><span style="font-size:10px;color:var(--text3)">Price-to-Earnings</span></td><td style="font-family:var(--mono);font-weight:700;font-size:16px">${d.pe_ratio}</td>
<td><span class="sig ${pe<15?'g':pe<25?'n':'c'}">${pe<15?'\u25CF Undervalued':pe<25?'\u25CF Fair':'\u25CF Expensive'}</span></td>
<td style="font-size:12px;line-height:1.7">${pe<15?'Under $15 per $1 of earnings. Potential bargain!':pe<25?'Reasonably priced at $'+d.pe_ratio+' per $1 of earnings.':'$'+d.pe_ratio+' per $1 earned. Growth must justify this.'}</td></tr>
<tr><td><strong>P/B Ratio</strong><br><span style="font-size:10px;color:var(--text3)">Price-to-Book</span></td><td style="font-family:var(--mono);font-weight:700;font-size:16px">${d.pb_ratio}</td>
<td><span class="sig ${parseFloat(d.pb_ratio)<3?'g':'c'}">${parseFloat(d.pb_ratio)<3?'\u25CF Reasonable':'\u25CF Premium'}</span></td>
<td style="font-size:12px;line-height:1.7">${parseFloat(d.pb_ratio)<3?'At '+d.pb_ratio+'x book value. Assets back up the price.':'At '+d.pb_ratio+'x book. Paying for brand & growth.'}</td></tr>
<tr><td><strong>Profit Margin</strong><br><span style="font-size:10px;color:var(--text3)">Profit per $ revenue</span></td><td style="font-family:var(--mono);font-weight:700;font-size:16px">${d.profit_margin}%</td>
<td><span class="sig ${parseFloat(d.profit_margin)>15?'g':parseFloat(d.profit_margin)>8?'n':'r'}">${parseFloat(d.profit_margin)>15?'\u25CF Excellent':parseFloat(d.profit_margin)>8?'\u25CF Moderate':'\u25CF Thin'}</span></td>
<td style="font-size:12px;line-height:1.7">${parseFloat(d.profit_margin)>15?'Keeps $'+d.profit_margin+' from every $100 in sales. Strong!':parseFloat(d.profit_margin)>8?'$'+d.profit_margin+' per $100 sales. Decent.':'Only $'+d.profit_margin+' per $100 sales. Tight margins.'}</td></tr>
<tr><td><strong>Operating Margin</strong><br><span style="font-size:10px;color:var(--text3)">Core profitability</span></td><td style="font-family:var(--mono);font-weight:700;font-size:16px">${d.operating_margin}%</td>
<td><span class="sig ${parseFloat(d.operating_margin)>20?'g':parseFloat(d.operating_margin)>10?'n':'r'}">${parseFloat(d.operating_margin)>20?'\u25CF Strong':parseFloat(d.operating_margin)>10?'\u25CF OK':'\u25CF Weak'}</span></td>
<td style="font-size:12px;line-height:1.7">${d.operating_margin}% core margin. ${parseFloat(d.operating_margin)>20?'Excellent efficiency.':'Room to improve.'}</td></tr>
<tr><td><strong>ROE</strong><br><span style="font-size:10px;color:var(--text3)">Return on Equity</span></td><td style="font-family:var(--mono);font-weight:700;font-size:16px">${d.roe}%</td>
<td><span class="sig ${parseFloat(d.roe)>15?'g':'n'}">${parseFloat(d.roe)>15?'\u25CF High':'\u25CF Moderate'}</span></td>
<td style="font-size:12px;line-height:1.7">${parseFloat(d.roe)>15?'$'+d.roe+' profit per $100 equity. Efficient!':'$'+d.roe+' per $100 invested. Average.'}</td></tr>
<tr><td><strong>Dividend Yield</strong><br><span style="font-size:10px;color:var(--text3)">Annual income</span></td><td style="font-family:var(--mono);font-weight:700;font-size:16px">${d.dividend_yield}%</td>
<td><span class="sig ${parseFloat(d.dividend_yield)>3?'g':parseFloat(d.dividend_yield)>1?'n':'c'}">${parseFloat(d.dividend_yield)>3?'\u25CF High Income':parseFloat(d.dividend_yield)>1?'\u25CF Some Income':'\u25CF Growth Focus'}</span></td>
<td style="font-size:12px;line-height:1.7">${parseFloat(d.dividend_yield)>3?'$'+d.dividend_yield+' yearly per $100. Great income!':parseFloat(d.dividend_yield)>1?'$'+d.dividend_yield+' per $100. Some income + growth.':'Reinvests profits for growth.'}</td></tr>
</table>
<div style="margin-top:14px;padding:14px;border-radius:8px;background:rgba(59,130,246,.04);border:1px solid rgba(59,130,246,.1)">
<p style="font-size:13px;color:var(--text2);line-height:1.7"><strong style="color:var(--blue)">\u25CF Bottom Line:</strong> ${pe<20?'Numbers lean in your favor. Fair or discounted pricing \u2014 could be a smart entry.':'Paying a growth premium. Fine IF the company delivers. Keep expectations realistic.'}</p></div>
</div></div>

<!-- ENTRY & EXIT -->
<div class="sc"><div class="sh"><div class="si" style="background:rgba(139,92,246,.1)">\u2B21</div><div class="st" style="color:var(--purple)" id="sec-entry">Exact Buy &amp; Sell Prices \u2014 Your Cheat Sheet</div></div>
<div class="sbody">
<table class="dt"><tr><th>Level</th><th>Price</th><th>% from Current</th><th>Action</th></tr>
<tr><td>\u25CF Buy Zone</td><td><span class="ptag buy">Below ${curr}${(price*.95).toFixed(2)}</span></td><td style="color:var(--green)">-5%</td><td style="font-size:12px">Accumulate \u2014 build position</td></tr>
<tr><td>\u25CF Current</td><td><span class="ptag cur">${curr}${price.toLocaleString()}</span></td><td>\u2014</td><td style="font-size:12px">Monitor for signals</td></tr>
<tr><td>\u25CF Take Profit 1</td><td><span class="ptag pro">Above ${curr}${(price*1.10).toFixed(2)}</span></td><td style="color:var(--amber)">+10%</td><td style="font-size:12px">Book 30\u201350% profits</td></tr>
<tr><td>\u25CF Take Profit 2</td><td><span class="ptag pro">Above ${curr}${(price*1.20).toFixed(2)}</span></td><td style="color:var(--amber)">+20%</td><td style="font-size:12px">Exit remaining</td></tr>
<tr><td>\u25CF Stop Loss</td><td><span class="ptag stp">Below ${curr}${(price*.90).toFixed(2)}</span></td><td style="color:var(--red)">-10%</td><td style="font-size:12px">Strict exit \u2014 limit downside</td></tr>
</table></div></div>

<!-- RISK ASSESSMENT -->
<div class="sc"><div class="sh"><div class="si" style="background:rgba(239,68,68,.1)">&#9888;</div><div class="st" style="color:var(--red)" id="sec-risk">What Could Go Wrong \u2014 Risk Reality Check</div></div>
<div class="sbody">
<table class="dt"><tr><th>Factor</th><th>Metric</th><th>Signal</th><th>Assessment</th></tr>
<tr><td>Debt Level</td><td style="font-family:var(--mono);font-weight:600">${d.debt_to_equity}</td>
<td><span class="sig ${parseFloat(d.debt_to_equity)>1.5?'r':parseFloat(d.debt_to_equity)>0.8?'c':'g'}">${parseFloat(d.debt_to_equity)>1.5?'High':parseFloat(d.debt_to_equity)>0.8?'Moderate':'Low'}</span></td>
<td style="font-size:12px">${parseFloat(d.debt_to_equity)>1.5?'High leverage \u2014 watch carefully':parseFloat(d.debt_to_equity)>0.8?'Moderate \u2014 manageable':'Conservative \u2014 low risk'}</td></tr>
<tr><td>Liquidity</td><td style="font-family:var(--mono);font-weight:600">${d.current_ratio}</td>
<td><span class="sig ${parseFloat(d.current_ratio)>1.5?'g':parseFloat(d.current_ratio)>1?'c':'r'}">${parseFloat(d.current_ratio)>1.5?'Strong':parseFloat(d.current_ratio)>1?'Adequate':'Weak'}</span></td>
<td style="font-size:12px">${parseFloat(d.current_ratio)>1.5?'Can meet obligations easily':parseFloat(d.current_ratio)>1?'Tight but OK':'Liquidity concerns'}</td></tr>
<tr><td>Volatility</td><td style="font-family:var(--mono);font-weight:600">${d.beta}</td>
<td><span class="sig ${Math.abs(parseFloat(d.beta))>1.5?'r':Math.abs(parseFloat(d.beta))<0.8?'g':'n'}">${Math.abs(parseFloat(d.beta))>1.5?'High':Math.abs(parseFloat(d.beta))<0.8?'Low':'Average'}</span></td>
<td style="font-size:12px">${Math.abs(parseFloat(d.beta))>1.5?'Expect bigger price swings':Math.abs(parseFloat(d.beta))<0.8?'Less volatile \u2014 defensive':'Average volatility'}</td></tr>
<tr><td>Sector</td><td>${d.sector}</td><td><span class="sig n">Monitor</span></td><td style="font-size:12px">Track trends &amp; regulation</td></tr>
</table></div></div>

<div class="sbody"><div id="earningsCard"></div></div></div>

<div class="sbody"><div id="insiderTable"></div></div></div>

<!-- AI ANALYSIS -->
<div class="sc"><div class="sh"><div class="si" style="background:rgba(59,130,246,.1)">&#9889;</div><div class="st" style="color:var(--blue)" id="sec-ai">The Full Picture \u2014 What Most Sites Hide</div></div>
<div class="sbody">
<div class="ic bl"><h5>Market Position</h5><p>${d.company_name||d.ticker} in ${d.sector} (${d.industry}). At ${curr}${price.toLocaleString()}, ${((price/d.week52_high)*100).toFixed(0)}% of 52-week high. Cap: ${formatCap(d.market_cap)} \u2014 ${d.market_cap>100e9?'large-cap':d.market_cap>10e9?'mid-cap':'small-cap'}.</p></div>
<div class="ic am"><h5>Making Money?</h5><p>Profit: ${d.profit_margin}% \u00B7 Operating: ${d.operating_margin}% \u00B7 ROE: ${d.roe}%. P/E of ${d.pe_ratio} = ${pe<15?'undervalued':pe<25?'fair value':'premium'}. Dividend: ${d.dividend_yield}%.</p></div>
<div class="ic gr"><h5>Price Direction</h5><p>${d.price_change>=0?'Positive':'Negative'} momentum (${Math.abs(d.price_change_pct).toFixed(2)}%). ${price<d.week52_low*1.1?'Near lows \u2014 value entry':price>d.week52_high*0.9?'Near highs \u2014 watch resistance':'Mid-range \u2014 balanced'}. Beta: ${d.beta}.</p></div>
<div class="ic rd"><h5>Red Flags</h5><p>D/E: ${d.debt_to_equity} \u2014 ${parseFloat(d.debt_to_equity)>1.5?'elevated':'manageable'}. Current ratio: ${d.current_ratio} \u2014 ${parseFloat(d.current_ratio)>1.5?'strong':'adequate'} liquidity. Monitor earnings &amp; macro.</p></div>
<div class="ic pu"><h5>What Should You Do?</h5><p style="font-weight:600">${verdict==='BUY'?'\u2705 BUY \u2014 Math checks out. Sensible price. Consider a position.':verdict==='SELL'?'\u26A0\uFE0F SELL/AVOID \u2014 Numbers do not justify the price. Stay on sidelines.':'\u2194\uFE0F HOLD \u2014 Not cheap enough to buy, not expensive enough to sell. Patience.'}</p></div>
<div id="aiAnalysisFormatted"></div>
<div style="margin-top:16px;padding:16px;border-radius:10px;background:var(--bg);border:1px solid var(--border)">
<span class="aix" onclick="const e=document.getElementById('fullAIraw');e.style.display=e.style.display==='none'?'block':'none';this.innerHTML=e.style.display==='none'?'\u25B8 Read the complete AI report':'\u25BE Close AI report'">\u25B8 Read the complete AI report</span>
<div id="fullAIraw" class="ait" style="display:none;margin-top:10px;max-height:400px;overflow-y:auto;padding-right:8px">${report}</div>
</div></div></div>

<!-- SMALL CAPS -->
<div class="sc"><div class="sh"><div class="si" style="background:rgba(245,158,11,.1)">\u2605</div><div class="st" style="color:var(--amber)" id="sec-gems">Hidden Gems \u2014 Small-Caps That Could 10x</div></div>
<div class="sbody">
<p style="font-size:12px;color:var(--text3);margin-bottom:14px">Under-the-radar picks in <strong id="smallCapSector" style="color:var(--amber)">${d.sector}</strong>:</p>
<div id="smallCapTable"></div>
<div class="ic am" style="margin-top:14px"><p><strong>Real talk:</strong> Small-caps = high risk, high reward. Same sector as <strong id="smallCapTicker">${d.ticker}</strong>. Only invest what you can lose. Spread across 5\u20138 picks. Think 10+ years.</p></div>
</div></div>
`;

document.getElementById('analysisContainer').innerHTML=html;
formatAIAnalysis(report);
generateSmallCapRecommendations(d)}

// CHARTS (5 total) - with beginner-friendly tooltips
function createCharts(d){
if(valChart)valChart.destroy();if(trendChart)trendChart.destroy();if(healthChart)healthChart.destroy();if(riskChart)riskChart.destroy();if(marginChart)marginChart.destroy();
const gc='rgba(59,130,246,.05)';
Chart.defaults.color='#94a3b8';Chart.defaults.font.family="'DM Sans',sans-serif";
const ttBase={backgroundColor:'rgba(6,10,19,.95)',titleColor:'#fff',bodyColor:'#94a3b8',borderColor:'rgba(59,130,246,.2)',borderWidth:1,cornerRadius:8,padding:12,titleFont:{size:13,weight:'700'},bodyFont:{size:12},displayColors:false};

// 1. Valuation Bar
const pe=parseFloat(d.pe_ratio)||0,pb=parseFloat(d.pb_ratio)||0,dy=parseFloat(d.dividend_yield)||0;
const valExplain=['P/E Ratio: How much you pay per $1 of earnings.\n'+( pe<15?'Below 15 = potential bargain!':pe<25?'15-25 = fairly priced':'Above 25 = you are paying a premium'),'P/B Ratio: Stock price vs actual assets.\n'+(pb<3?'Below 3 = reasonably valued':'Above 3 = high premium over assets'),'Dividend Yield: Cash you earn yearly.\n'+(dy>3?'Above 3% = great passive income':dy>1?'1-3% = some income + growth':'Below 1% = growth-focused, low income')];
valChart=new Chart(document.getElementById('valChart').getContext('2d'),{type:'bar',data:{labels:['P/E','P/B','Div%'],datasets:[{data:[pe,pb,dy],backgroundColor:['rgba(59,130,246,.35)','rgba(139,92,246,.35)','rgba(16,185,129,.35)'],borderColor:['#3b82f6','#8b5cf6','#10b981'],borderWidth:1.5,borderRadius:5}]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{...ttBase,callbacks:{title:function(c){return['P/E Ratio','P/B Ratio','Dividend Yield'][c[0].dataIndex]},label:function(c){return['Value: '+c.formattedValue,'',valExplain[c.dataIndex]].join('\n')}}}},scales:{y:{beginAtZero:true,grid:{color:gc}},x:{grid:{display:false}}}}});

// 2. Financial Health Radar
const hVals=[Math.min(100,parseFloat(d.profit_margin)||0),Math.min(100,parseFloat(d.roe)||0),Math.min(100,(parseFloat(d.current_ratio)||0)*25),Math.min(100,parseFloat(d.operating_margin)||0),Math.min(100,(parseFloat(d.dividend_yield)||0)*10)];
const hLabels=['Profit Margin','ROE','Current Ratio','Op. Margin','Div Yield'];
const hExplain=['How much profit per $1 of sales. Higher = better pricing power.','Return on equity. Above 15% = excellent use of shareholder money.','Can the company pay its short-term bills? Above 1.5 = safe.','Profit from core business before taxes. Higher = efficient operations.','Cash returned to you yearly. Higher = more passive income.'];
healthChart=new Chart(document.getElementById('healthChart').getContext('2d'),{type:'radar',data:{labels:hLabels,datasets:[{data:hVals,backgroundColor:'rgba(16,185,129,.12)',borderColor:'#10b981',borderWidth:2,pointBackgroundColor:'#10b981',pointRadius:4,pointHoverRadius:7,pointHoverBackgroundColor:'#fff',pointHoverBorderColor:'#10b981',pointHoverBorderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{...ttBase,callbacks:{title:function(c){return hLabels[c[0].dataIndex]},label:function(c){return['Score: '+c.formattedValue+'/100','',hExplain[c.dataIndex]].join('\n')}}}},scales:{r:{beginAtZero:true,max:100,grid:{color:'rgba(59,130,246,.06)'},angleLines:{color:'rgba(59,130,246,.06)'},ticks:{display:false},pointLabels:{font:{size:9},color:'#94a3b8'}}}}});

// 3. Risk Radar
const beta=Math.abs(parseFloat(d.beta)||1),de=parseFloat(d.debt_to_equity)||0,cr=parseFloat(d.current_ratio)||1;
const rVals=[Math.min(100,beta*40),Math.min(100,de*30),Math.min(100,Math.max(0,100-cr*40)),Math.min(100,(parseFloat(d.pe_ratio)||15)*2),50];
const rLabels=['Volatility','Debt','Liquidity Risk','Valuation Risk','Sector Risk'];
const rExplain=['How wildly the price swings vs the market.\nHigher = bumpier ride for your portfolio.','How much the company owes vs owns.\nHigh debt = more risk if business slows down.','Can the company cover its bills right now?\nHigh risk here = cash flow concerns.','Is the stock overpriced for what it earns?\nHigher = you might be overpaying.','General risk from the industry and economy.\nAll sectors carry some baseline risk.'];
riskChart=new Chart(document.getElementById('riskChart').getContext('2d'),{type:'radar',data:{labels:rLabels,datasets:[{data:rVals,backgroundColor:'rgba(239,68,68,.1)',borderColor:'#ef4444',borderWidth:2,pointBackgroundColor:'#ef4444',pointRadius:4,pointHoverRadius:7,pointHoverBackgroundColor:'#fff',pointHoverBorderColor:'#ef4444',pointHoverBorderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{...ttBase,callbacks:{title:function(c){return rLabels[c[0].dataIndex]+' Risk'},label:function(c){const v=c.raw;const lv=v>70?'HIGH RISK':v>40?'MODERATE':'LOW';return['Risk Score: '+Math.round(v)+'/100 ('+lv+')','',rExplain[c.dataIndex]].join('\n')}}}},scales:{r:{beginAtZero:true,max:100,grid:{color:'rgba(59,130,246,.06)'},angleLines:{color:'rgba(59,130,246,.06)'},ticks:{display:false},pointLabels:{font:{size:9},color:'#94a3b8'}}}}});

// 4. Price Trend
const price=d.current_price||100,trend=[];for(let i=6;i>=0;i--)trend.push(price*(1+(Math.random()-.5)*.12*i/6));
const curr=d.currency==='INR'?'\u20B9':'$';
trendChart=new Chart(document.getElementById('trendChart').getContext('2d'),{type:'line',data:{labels:['6 Months Ago','5 Months','4 Months','3 Months','2 Months','1 Month','Today'],datasets:[{data:trend,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,.06)',fill:true,tension:.4,borderWidth:2.5,pointBackgroundColor:'#3b82f6',pointBorderColor:'#0b1120',pointBorderWidth:2,pointRadius:4,pointHoverRadius:8,pointHoverBackgroundColor:'#fff',pointHoverBorderColor:'#3b82f6',pointHoverBorderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{...ttBase,callbacks:{title:function(c){return 'Price \u2014 '+c[0].label},label:function(c){const p=c.raw;const diff=p-price;const pct=((p/price-1)*100).toFixed(1);return['Price: '+curr+p.toFixed(2),'vs Today: '+(diff>=0?'+':'')+pct+'%','','Hover each point to track the price journey'].join('\n')}}}},scales:{y:{grid:{color:gc},ticks:{callback:function(v){return curr+v.toFixed(0)}}},x:{grid:{display:false}}}}});

// 5. Margin Comparison
const pm=parseFloat(d.profit_margin)||0,om=parseFloat(d.operating_margin)||0,roe=parseFloat(d.roe)||0;
const mExplain={0:['Profit Margin: '+pm+'% vs 15% benchmark','',pm>15?'Beating the benchmark = strong pricing power!':pm>8?'Close to benchmark. Decent but room to improve.':'Below benchmark. Tight margins = competitive pressure.'],1:['Operating Margin: '+om+'% vs 12% benchmark','',om>12?'Core business is running efficiently.':'Core operations could be more profitable.'],2:['Return on Equity: '+roe+'% vs 15% benchmark','',roe>15?'Great returns for shareholders!':'Average returns. Capital could work harder.']};
marginChart=new Chart(document.getElementById('marginChart').getContext('2d'),{type:'bar',data:{labels:['Profit Margin','Operating Margin','ROE'],datasets:[{label:'This Company',data:[pm,om,roe],backgroundColor:['rgba(59,130,246,.4)','rgba(6,182,212,.4)','rgba(16,185,129,.4)'],borderColor:['#3b82f6','#06b6d4','#10b981'],borderWidth:1.5,borderRadius:5},{label:'Industry Average',data:[15,12,15],backgroundColor:['rgba(148,163,184,.1)','rgba(148,163,184,.1)','rgba(148,163,184,.1)'],borderColor:['#475569','#475569','#475569'],borderWidth:1,borderRadius:5}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{position:'bottom',labels:{font:{size:10},boxWidth:12,padding:10,color:'#94a3b8'}},tooltip:{...ttBase,callbacks:{title:function(c){return c[0].label},afterBody:function(c){return mExplain[c[0].dataIndex]||[]}}}},scales:{x:{beginAtZero:true,grid:{color:gc},ticks:{callback:function(v){return v+'%'}}},y:{grid:{display:false}}}}});}

// SMALL CAP DATABASE (ALL sectors)
function generateSmallCapRecommendations(d){
const sector=d.sector||'Technology',isIndian=d.ticker&&(d.ticker.includes('.NS')||d.ticker.includes('.BO')||d.currency==='INR');
const db={
'Technology_US':[{n:'Palantir (PLTR)',s:'AI/Big Data',k:'Gov + enterprise AI platform',p:'Very High',r:5},{n:'CrowdStrike (CRWD)',s:'Cybersecurity',k:'Cloud-native endpoint protection',p:'Very High',r:5},{n:'Datadog (DDOG)',s:'Monitoring',k:'Unified observability platform',p:'Very High',r:4},{n:'MongoDB (MDB)',s:'Database',k:'Modern document DB, dev-first',p:'High',r:4},{n:'Cloudflare (NET)',s:'Edge',k:'CDN, security, serverless',p:'Very High',r:4},{n:'Unity (U)',s:'3D/Gaming',k:'Real-time 3D engine',p:'High',r:3}],
'Technology_India':[{n:'Kaynes Technology',s:'IoT/Defense',k:'Defense electronics, govt contracts',p:'Exceptional',r:5},{n:'Dixon Technologies',s:'Electronics Mfg',k:'PLI beneficiary, contract mfg',p:'Very High',r:5},{n:'Persistent Systems',s:'Software',k:'Digital engineering, healthcare IT',p:'Very High',r:4},{n:'Coforge',s:'IT Services',k:'Insurance & banking tech',p:'High',r:4},{n:'KPIT Technologies',s:'Auto SW',k:'EV software, T25 auto clients',p:'Very High',r:4},{n:'Happiest Minds',s:'Digital',k:'Cloud, IoT, security',p:'High',r:3}],
'Financial Services_US':[{n:'SoFi (SOFI)',s:'Fintech',k:'Digital banking, lending',p:'Very High',r:5},{n:'Markel (MKL)',s:'Insurance',k:'Mini Berkshire model',p:'High',r:4},{n:'Shift4 (FOUR)',s:'Payments',k:'Integrated processing',p:'Very High',r:4},{n:'Ally Financial (ALLY)',s:'Banking',k:'Top online bank, auto lending',p:'High',r:3},{n:'Houlihan Lokey (HLI)',s:'IB',k:'M&A advisory, restructuring',p:'High',r:4},{n:'Kinsale Capital (KNSL)',s:'Insurance',k:'E&S, tech underwriting',p:'High',r:3}],
'Financial Services_India':[{n:'Bajaj Finance',s:'NBFC',k:'Consumer lending leader',p:'Very High',r:5},{n:'Chola Finance',s:'Vehicle Finance',k:'Vehicle + home loans',p:'Very High',r:4},{n:'SBI Cards',s:'Credit Cards',k:'SBI network, card growth',p:'High',r:4},{n:'CDSL',s:'Depository',k:'Duopoly, demat growth',p:'High',r:4},{n:'Angel One',s:'Broking',k:'Discount broking platform',p:'Very High',r:4},{n:'Motilal Oswal',s:'Financial',k:'Broking, AMC, wealth',p:'High',r:3}],
'Healthcare_US':[{n:'Intuitive Surgical (ISRG)',s:'Robotic Surgery',k:'Da Vinci monopoly',p:'Very High',r:5},{n:'Dexcom (DXCM)',s:'Devices',k:'CGM leader diabetes',p:'Very High',r:4},{n:'Veeva (VEEV)',s:'Life Sci IT',k:'Cloud for pharma',p:'High',r:4},{n:'Shockwave (SWAV)',s:'Cardiology',k:'Intravascular lithotripsy',p:'Very High',r:4},{n:'Axonics (AXNX)',s:'Neuro',k:'Bladder/bowel therapy',p:'High',r:3},{n:'Inspire Medical (INSP)',s:'Sleep',k:'Implantable neurostim',p:'High',r:3}],
'Healthcare_India':[{n:'Max Healthcare',s:'Hospitals',k:'Premium hospitals',p:'Very High',r:5},{n:'Narayana Health',s:'Hospitals',k:'Affordable healthcare',p:'Very High',r:4},{n:'Laurus Labs',s:'Pharma',k:'API + formulations',p:'High',r:4},{n:'Metropolis',s:'Diagnostics',k:'Premium diagnostics',p:'High',r:3},{n:'Syngene',s:'CRAMS',k:'Contract research',p:'Very High',r:4},{n:'Gland Pharma',s:'Injectables',k:'Global injectables',p:'High',r:3}],
'Consumer Cyclical_US':[{n:'Airbnb (ABNB)',s:'Travel',k:'Global marketplace',p:'Very High',r:5},{n:'Lululemon (LULU)',s:'Athleisure',k:'Premium cult brand',p:'High',r:4},{n:'DraftKings (DKNG)',s:'Betting',k:'Online gaming leader',p:'Very High',r:4},{n:'Carvana (CVNA)',s:'Auto',k:'Online used car marketplace',p:'High',r:3},{n:'Floor & Decor (FND)',s:'Home',k:'Specialty flooring',p:'High',r:3},{n:'Five Below (FIVE)',s:'Retail',k:'Teen/tween value',p:'High',r:3}],
'Consumer Cyclical_India':[{n:'Trent Limited',s:'Retail',k:'Zara India + Zudio',p:'Exceptional',r:5},{n:'Page Industries',s:'Innerwear',k:'Jockey India',p:'Very High',r:4},{n:'Devyani Intl',s:'QSR',k:'KFC + Pizza Hut India',p:'Very High',r:4},{n:'Varun Beverages',s:'Beverages',k:'PepsiCo franchise',p:'Very High',r:4},{n:'Jubilant FoodWorks',s:'QSR',k:'Dominos India',p:'High',r:3},{n:'Bata India',s:'Footwear',k:'Brand heritage',p:'High',r:3}],
'Industrials_US':[{n:'Chart Industries (GTLS)',s:'Equipment',k:'LNG, hydrogen',p:'Very High',r:4},{n:'Generac (GNRC)',s:'Power',k:'Generators, clean energy',p:'High',r:4},{n:'Bloom Energy (BE)',s:'Fuel Cells',k:'Solid oxide cells',p:'Very High',r:4},{n:'AAON (AAON)',s:'HVAC',k:'Commercial HVAC',p:'High',r:3},{n:'AZEK (AZEK)',s:'Building',k:'Sustainable decking',p:'High',r:3},{n:'Fluence (FLNC)',s:'Storage',k:'Battery systems',p:'Very High',r:4}],
'Industrials_India':[{n:'Kaynes Technology',s:'Defense',k:'Defense & space, IoT',p:'Exceptional',r:5},{n:'Dixon Technologies',s:'Electronics',k:'PLI, diversified',p:'Very High',r:5},{n:'Polycab India',s:'Cables',k:'Infra growth, FMEG',p:'Very High',r:4},{n:'KEI Industries',s:'Cables',k:'Power cables',p:'High',r:3},{n:'Kalpataru Projects',s:'EPC',k:'Power transmission',p:'High',r:3},{n:'Apar Industries',s:'Conductors',k:'Specialty cables',p:'High',r:4}],
'Energy_US':[{n:'Enphase (ENPH)',s:'Solar',k:'Microinverters',p:'Very High',r:4},{n:'Array Tech (ARRY)',s:'Trackers',k:'Utility-scale solar',p:'High',r:3},{n:'Chord Energy (CHRD)',s:'O&G',k:'Bakken, low-cost',p:'High',r:3},{n:'Magnolia Oil (MGY)',s:'O&G',k:'Eagle Ford',p:'High',r:3},{n:'Shoals Tech (SHLS)',s:'Solar',k:'EBOS',p:'High',r:3},{n:'NextEra Partners (NEP)',s:'Renewables',k:'Wind & solar',p:'High',r:3}],
'Energy_India':[{n:'Adani Green',s:'Renewables',k:'Solar/wind capacity',p:'Very High',r:4},{n:'Tata Power',s:'Power',k:'Renewable transition',p:'Very High',r:4},{n:'SJVN',s:'Hydro',k:'Hydro, PSU backing',p:'High',r:3},{n:'Borosil Renewables',s:'Solar Glass',k:'Solar glass mfg',p:'Very High',r:4},{n:'Suzlon Energy',s:'Wind',k:'Wind turnaround',p:'High',r:3},{n:'Waaree Energies',s:'Solar',k:'PV manufacturing',p:'Very High',r:4}]
};
let geo=isIndian?'India':'US',sectorKey=sector.replace(' Services','').replace('Financial','Financial Services').trim();
let key=`${sectorKey}_${geo}`;
let recs=db[key];
if(!recs){key=`${sector.split(' ')[0]}_${geo}`;recs=db[key]}
if(!recs){recs=db[`Technology_${geo}`]};
let t=`<table class="dt"><tr><th>Company</th><th>Focus</th><th>Strengths</th><th>Rating</th><th>Potential</th></tr>`;
recs.forEach(c=>{const clr=c.p.includes('Exceptional')||c.p.includes('Very High')?'var(--green)':'var(--amber)';
const stars='\u2605'.repeat(c.r)+'\u2606'.repeat(5-c.r);
t+=`<tr><td><strong>${c.n}</strong></td><td>${c.s}</td><td style="font-size:12px">${c.k}</td><td style="color:var(--amber);letter-spacing:1px">${stars}</td><td style="color:${clr};font-weight:600;font-size:12px">${c.p}</td></tr>`});
t+='</table>';document.getElementById('smallCapTable').innerHTML=t}

// ═══════════════════════════════════════════════
// AI ANALYSIS PARSING ENGINE - Educational Tables
// ═══════════════════════════════════════════════
function formatAIAnalysis(rawText){
const sections=[
{title:'\ud83d\udcca Valuation Check \u2014 Is The Price Right?',icon:'\ud83d\udcb0',color:'var(--blue)',data:extractValuationInsights(rawText)},
{title:'\ud83d\udcc8 Price Momentum \u2014 Where Is It Heading?',icon:'\ud83c\udfaf',color:'var(--green)',data:extractMomentumInsights(rawText)},
{title:'\u26a0\ufe0f Risk Factors \u2014 What Could Go Wrong?',icon:'\ud83d\udee1\ufe0f',color:'var(--red)',data:extractRiskInsights(rawText)},
{title:'\ud83d\udca1 Investment Strategy \u2014 Should You Buy?',icon:'\ud83c\udfaf',color:'var(--purple)',data:extractStrategyInsights(rawText)}
];
let h=`<div style="padding:16px;border-radius:10px;margin-bottom:18px;background:rgba(59,130,246,.04);border:1px solid rgba(59,130,246,.12);text-align:center">
<div style="font-family:'Sora',sans-serif;font-size:15px;font-weight:700;color:var(--blue);margin-bottom:6px">\ud83c\udf93 EASY-TO-UNDERSTAND AI ANALYSIS</div>
<div style="font-size:12px;color:var(--text3);line-height:1.7">We've broken down the AI analysis into simple, actionable insights.<br><strong>Look for <span style="color:var(--green)">\ud83d\udfe2 GREEN</span> (good), <span style="color:var(--amber)">\ud83d\udfe1 YELLOW</span> (caution), <span style="color:var(--red)">\ud83d\udd34 RED</span> (warning)</strong></div></div>`;
sections.forEach(s=>{h+=createEducationalSection(s)});
h+=`<div style="padding:16px;border-radius:10px;margin-top:18px;background:var(--bg);border:1px solid var(--border)">
<span class="aix" onclick="const e=document.getElementById('fullAIedu');e.style.display=e.style.display==='none'?'block':'none';this.innerHTML=e.style.display==='none'?'\u25b8 View detailed AI breakdown':'\u25be Close AI breakdown'">\u25b8 View detailed AI breakdown</span>
<div id="fullAIedu" class="ait" style="display:none;margin-top:10px;max-height:400px;overflow-y:auto;padding-right:8px">${rawText}</div></div>`;
const el=document.getElementById('aiAnalysisFormatted');if(el)el.innerHTML=h}

function createEducationalSection(section){
if(!section.data||!section.data.length)return'';
return`<div style="background:var(--surface);padding:20px;border-radius:12px;margin-bottom:14px;border-left:4px solid ${section.color};border:1px solid var(--border)">
<div style="color:${section.color};font-family:'Sora',sans-serif;font-size:15px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px">
<span style="font-size:22px">${section.icon}</span>${section.title}</div>
<table class="dt"><thead><tr><th style="width:25%">Factor</th><th style="width:22%">Status</th><th>What This Means For You</th></tr></thead>
<tbody>${section.data.map(r=>createTableRow(r)).join('')}</tbody></table></div>`}

function createTableRow(row){
const sc={'good':'var(--green)','caution':'var(--amber)','concern':'var(--red)','neutral':'var(--text3)'};
const si={'good':'\ud83d\udfe2','caution':'\ud83d\udfe1','concern':'\ud83d\udd34','neutral':'\u26aa'};
return`<tr><td style="font-weight:600;font-size:13px">${row.factor}</td>
<td style="color:${sc[row.signal]};font-weight:700;font-size:13px">${si[row.signal]} ${row.status}</td>
<td style="font-size:12px;line-height:1.7;color:var(--text2)">${row.explanation}</td></tr>`}

function extractValuationInsights(text){
const insights=[],tl=text.toLowerCase();
if(tl.includes('p/e')||tl.includes('price-to-earnings')){const m=text.match(/p\/e.*?(\d+\.?\d*)/i);if(m){const pe=parseFloat(m[1]);
insights.push({factor:'P/E Ratio',status:pe<15?'Undervalued':pe<25?'Fair Value':'Expensive',signal:pe<15?'good':pe<25?'neutral':'caution',
explanation:pe<15?'Trading below average multiples. Could be a buying opportunity if fundamentals are strong.':pe<25?'Reasonably priced compared to earnings. Not too cheap, not too expensive.':'Trading at a premium. Make sure growth justifies the higher price.'})}}
if(tl.includes('undervalued'))insights.push({factor:'Overall Valuation',status:'Below Fair Value',signal:'good',explanation:'Appears to be trading below intrinsic worth. Potential buying opportunity for long-term investors.'});
else if(tl.includes('overvalued')||tl.includes('expensive'))insights.push({factor:'Overall Valuation',status:'Above Fair Value',signal:'caution',explanation:'May be above fundamental value. Consider waiting for better entry or ensure growth justifies premium.'});
else if(tl.includes('fairly valued')||tl.includes('reasonable'))insights.push({factor:'Overall Valuation',status:'Fair Value',signal:'neutral',explanation:'Priced appropriately based on fundamentals. Neither a bargain nor overpriced.'});
if(tl.includes('margin')){const m=text.match(/margin.*?(\d+\.?\d*)%/i);if(m){const v=parseFloat(m[1]);
insights.push({factor:'Profit Margins',status:v>15?'Healthy':v>8?'Moderate':'Weak',signal:v>15?'good':v>8?'neutral':'concern',
explanation:v>15?`Strong margins (${v}%) indicate efficient operations and pricing power.`:v>8?`Moderate margins (${v}%). Profitable but facing competitive pressure.`:`Low margins (${v}%) suggest intense competition. Monitor carefully.`})}}
if(tl.includes('growth'))insights.push({factor:'Growth Prospects',status:tl.includes('high growth')||tl.includes('strong growth')?'Strong Growth':'Moderate Growth',
signal:tl.includes('high growth')||tl.includes('strong growth')?'good':'neutral',
explanation:tl.includes('high growth')||tl.includes('strong growth')?'Expected to grow faster than market average. Can justify higher valuations.':'Steady but not spectacular growth. Suitable for conservative investors.'});
return insights.length?insights:[{factor:'Valuation',status:'Under Review',signal:'neutral',explanation:'AI is analyzing multiple valuation metrics. Check detailed analysis below.'}]}

function extractMomentumInsights(text){
const insights=[],tl=text.toLowerCase();
if(tl.includes('uptrend')||tl.includes('rising')||tl.includes('bullish'))insights.push({factor:'Price Trend',status:'Upward Momentum',signal:'good',explanation:'Price is trending up. Buyers in control, sentiment positive. Good for momentum investors.'});
else if(tl.includes('downtrend')||tl.includes('falling')||tl.includes('bearish'))insights.push({factor:'Price Trend',status:'Downward Momentum',signal:'concern',explanation:'Price is trending down. Sellers dominate. Wait for stabilization before buying.'});
else if(tl.includes('sideways')||tl.includes('range-bound'))insights.push({factor:'Price Trend',status:'Consolidating',signal:'neutral',explanation:'Moving sideways in a range. Market undecided. Watch for breakout in either direction.'});
if(tl.includes('volume'))insights.push({factor:'Trading Volume',status:tl.includes('high volume')?'High Interest':'Normal',signal:tl.includes('high volume')?'good':'neutral',
explanation:tl.includes('high volume')?'High volume confirms the price move. More reliable trend.':'Normal activity. Price moves less significant without volume confirmation.'});
if(tl.includes('support'))insights.push({factor:'Support Levels',status:'Support Identified',signal:'good',explanation:'Key support levels provide downside protection. Buyers tend to step in at these prices.'});
if(tl.includes('resistance'))insights.push({factor:'Resistance Levels',status:'Resistance Present',signal:'caution',explanation:'Overhead resistance may cap near-term gains. Watch for a breakout above these levels.'});
if(tl.includes('52-week')||tl.includes('52 week')){if(tl.includes('high'))insights.push({factor:'52-Week Position',status:'Near Yearly High',signal:'caution',explanation:'Trading near its highest price this year. Limited short-term upside. Be cautious about chasing.'});
else if(tl.includes('low'))insights.push({factor:'52-Week Position',status:'Near Yearly Low',signal:'neutral',explanation:'Near lowest price this year. Value opportunity if fundamentals intact, or value trap if problems persist.'})}
return insights.length?insights:[{factor:'Price Momentum',status:'Analyzing',signal:'neutral',explanation:'AI reviewing price patterns and momentum. Check the price chart above for visual trends.'}]}

function extractRiskInsights(text){
const insights=[],tl=text.toLowerCase();
if(tl.includes('debt')){if(tl.includes('high debt')||tl.includes('leverage'))insights.push({factor:'Debt Burden',status:'High Leverage',signal:'concern',explanation:'Significant debt increases risk during downturns. Interest payments must be met. Monitor cash flow.'});
else if(tl.includes('low debt')||tl.includes('strong balance sheet'))insights.push({factor:'Financial Health',status:'Low Debt',signal:'good',explanation:'Manageable debt provides financial flexibility and reduces downturn risk.'})}
if(tl.includes('volatile')||tl.includes('volatility'))insights.push({factor:'Volatility',status:'High Swings',signal:'caution',explanation:'Large price swings. Higher risk but also higher reward. Suitable for risk-tolerant investors.'});
if(tl.includes('competition')||tl.includes('competitive'))insights.push({factor:'Competition',status:'Competitive Pressure',signal:'caution',explanation:'Faces competitive threats. Monitor market share and pricing power trends.'});
if(tl.includes('regulation')||tl.includes('regulatory'))insights.push({factor:'Regulatory',status:'Regulatory Risk',signal:'caution',explanation:'Subject to regulatory changes that could impact operations and profitability.'});
if(tl.includes('sector')||tl.includes('industry'))insights.push({factor:'Industry',status:'Sector Risks',signal:'neutral',explanation:'Monitor industry trends, regulatory changes, and competitive dynamics.'});
if(tl.includes('market')||tl.includes('economy'))insights.push({factor:'Macro',status:'Market Conditions',signal:'neutral',explanation:'Overall market and economic factors affect this stock. Stay informed about rates, inflation, and growth.'});
return insights.length?insights:[{factor:'Risk',status:'Standard Risks',signal:'neutral',explanation:'All investments carry risk. Diversify and invest only what you can afford to lose.'}]}

function extractStrategyInsights(text){
const insights=[],tu=text.toUpperCase(),tl=text.toLowerCase();
if(tu.includes('BUY')&&!tu.includes("DON'T BUY"))insights.push({factor:'Recommendation',status:'BUY',signal:'good',explanation:'Appears to be a good opportunity at current levels. Consider building position gradually.'});
else if(tu.includes('SELL')||tu.includes('AVOID'))insights.push({factor:'Recommendation',status:'SELL / AVOID',signal:'concern',explanation:'Risk factors outweigh potential rewards at current prices. Consider exiting or avoiding.'});
else if(tu.includes('HOLD'))insights.push({factor:'Recommendation',status:'HOLD',signal:'neutral',explanation:'If you own it, hold. If looking to buy, wait for better entry or more positive catalysts.'});
if(tl.includes('long-term')||tl.includes('long term'))insights.push({factor:'Horizon',status:'Long-Term Hold',signal:'good',explanation:'Suitable for 3-5+ year horizon. Expect and tolerate short-term volatility.'});
else if(tl.includes('short-term')||tl.includes('trading'))insights.push({factor:'Horizon',status:'Short-Term Trade',signal:'caution',explanation:'Better for active traders. Requires close monitoring and quick decisions.'});
insights.push({factor:'Position Sizing',status:'Diversify',signal:'neutral',explanation:"Should represent no more than 5-10% of total portfolio. Spread risk across multiple investments."});
if(tl.includes('dip')||tl.includes('pullback'))insights.push({factor:'Entry',status:'Buy on Dips',signal:'good',explanation:'Build position on pullbacks for better average entry price.'});
return insights}

function formatCap(c){if(!c)return'N/A';if(c>=1e12)return'$'+(c/1e12).toFixed(2)+'T';if(c>=1e9)return'$'+(c/1e9).toFixed(2)+'B';if(c>=1e6)return'$'+(c/1e6).toFixed(2)+'M';return'$'+c.toLocaleString()}

// ==========================================
// FEATURE VOTING SYSTEM
// ==========================================
const featureKeys=['pdf','cmp','share','tech','peer','earn','insider','theme'];
const featureNames=['PDF Export','Compare Stocks','Share (WhatsApp/Email)','Technical Indicators','Peer Comparison','Earnings Countdown','Insider Activity','Dark/Light Theme'];
const votes={};
featureKeys.forEach(k=>{votes[k]={up:0,dn:0}});
let voteChart=null;
let userVotes={};

function vote(feature,dir,btn){
// Prevent double-voting same direction on same feature
const voteKey=feature+(dir>0?'up':'dn');
const oppKey=feature+(dir>0?'dn':'up');
if(userVotes[voteKey])return;

// If they voted opposite before, undo it
if(userVotes[oppKey]){
const oppDir=dir>0?-1:1;
votes[feature][oppDir>0?'up':'dn']--;
const oppBtn=btn.parentElement.querySelector(dir>0?'.dn':'.up');
oppBtn.classList.remove('voted');
delete userVotes[oppKey];
}

// Record vote
if(dir>0)votes[feature].up++;
else votes[feature].dn++;
userVotes[voteKey]=true;
btn.classList.add('voted');

// Update counters
document.getElementById(feature+'-up').textContent=votes[feature].up;
document.getElementById(feature+'-dn').textContent=votes[feature].dn;

// Update bar
const total=votes[feature].up+votes[feature].dn;
const pct=total>0?Math.round((votes[feature].up/total)*100):0;
document.getElementById(feature+'-bar').style.width=pct+'%';

// Update chart
updateVoteChart();

// Send to backend
fetch('/api/vote',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({feature:feature,direction:dir})}).catch(()=>{});
}

function updateVoteChart(){
if(!voteChart)return;
voteChart.data.datasets[0].data=featureKeys.map(k=>votes[k].up);
voteChart.data.datasets[1].data=featureKeys.map(k=>-votes[k].dn);
voteChart.update('none');
}

function initVoteChart(){
const ctx=document.getElementById('voteChart');
if(!ctx)return;
voteChart=new Chart(ctx,{
type:'bar',
data:{
labels:featureNames,
datasets:[
{label:'Want It',data:featureKeys.map(k=>votes[k].up),backgroundColor:'rgba(16,185,129,0.7)',borderRadius:4,barPercentage:.6},
{label:'Not Needed',data:featureKeys.map(k=>-votes[k].dn),backgroundColor:'rgba(239,68,68,0.5)',borderRadius:4,barPercentage:.6}
]
},
options:{
indexAxis:'y',
responsive:true,
maintainAspectRatio:false,
scales:{
x:{stacked:true,grid:{color:'rgba(148,163,184,0.06)'},ticks:{color:'#64748b',font:{size:10},callback:v=>Math.abs(v)},border:{display:false}},
y:{stacked:true,grid:{display:false},ticks:{color:'#e2e8f0',font:{family:"'DM Sans',sans-serif",size:11,weight:'600'}},border:{display:false}}
},
plugins:{
legend:{labels:{color:'#94a3b8',font:{size:10},usePointStyle:true,pointStyle:'rectRounded'}},
tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+Math.abs(ctx.raw)}}
}
}
});
}

function loadVotes(){
fetch('/api/votes').then(r=>r.json()).then(data=>{
if(data&&data.votes){
featureKeys.forEach(k=>{
if(data.votes[k]){
votes[k].up=data.votes[k].up||0;
votes[k].dn=data.votes[k].dn||0;
document.getElementById(k+'-up').textContent=votes[k].up;
document.getElementById(k+'-dn').textContent=votes[k].dn;
const total=votes[k].up+votes[k].dn;
const pct=total>0?Math.round((votes[k].up/total)*100):0;
document.getElementById(k+'-bar').style.width=pct+'%';
}
});
updateVoteChart();
}
}).catch(()=>{});
}

function sendVoteResults(){
let body='SENTINEL AI RESEARCH - Feature Vote Results\n\n';
const sorted=featureKeys.map((k,i)=>({key:k,name:featureNames[i],up:votes[k].up,dn:votes[k].dn,net:votes[k].up-votes[k].dn})).sort((a,b)=>b.net-a.net);
sorted.forEach((f,i)=>{
body+=(i+1)+'. '+f.name+' | Upvotes: '+f.up+' | Downvotes: '+f.dn+' | Net: '+f.net+'\n';
});
body+='\nTotal votes cast: '+featureKeys.reduce((s,k)=>s+votes[k].up+votes[k].dn,0);
body+='\nTimestamp: '+new Date().toISOString();
const mailto='mailto:support@sentinelai.research?subject='+encodeURIComponent('Feature Vote Results - '+new Date().toLocaleDateString())+'&body='+encodeURIComponent(body);
window.open(mailto);
}

// Initialize vote chart on page load
document.addEventListener('DOMContentLoaded',()=>{initVoteChart();loadVotes();
fetch('/api/stats').then(r=>r.json()).then(d=>{
if(d.total_reports){document.getElementById('navRC').textContent=d.total_reports;document.getElementById('globalRC').textContent=d.total_reports.toLocaleString()}
}).catch(()=>{})});

// Anti-copy protection
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if(e.ctrlKey&&(e.key==='u'||e.key==='s'||e.key==='c'||e.key==='a'||e.key==='p'))e.preventDefault();if(e.key==='F12')e.preventDefault()});
document.addEventListener('copy',e=>e.preventDefault());
document.addEventListener('cut',e=>e.preventDefault());
</script>

<!-- FLOATING FEEDBACK BUTTON -->
<button class="fab" onclick="document.getElementById('fpanel').classList.add('open');document.getElementById('fpbk').classList.add('open')">
<div class="pulse"></div> What's Next? Vote on Features
</button>

<!-- BACKDROP -->
<div class="fpbk" id="fpbk" onclick="document.getElementById('fpanel').classList.remove('open');this.classList.remove('open')"></div>

<!-- SLIDE PANEL -->
<div class="fpanel" id="fpanel">
<div class="fphdr">
<h3>&#128640; What Should We Build Next?</h3>
<button class="fpclose" onclick="document.getElementById('fpanel').classList.remove('open');document.getElementById('fpbk').classList.remove('open')">&times;</button>
</div>
<div class="fpbody">
<p class="sub">You just got a free analysis worth $50+. Now imagine what happens when we add <em>these</em>. Your vote decides what ships first.</p>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#128196;</div><div class="pfinfo"><div class="pfname">PDF Export <span class="ftag hot">Most Wanted</span></div><div class="pfdesc">Download your full report as a branded PDF. Save it, print it, share it.</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('pdf',1,this)">&#9650; Want it <span class="cnt" id="pdf-up">0</span></button><button class="pvbtn dn" onclick="vote('pdf',-1,this)">&#9660; Skip <span class="cnt" id="pdf-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="pdf-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#9878;&#65039;</div><div class="pfinfo"><div class="pfname">Compare 2 Stocks <span class="ftag hot">Most Wanted</span></div><div class="pfdesc">Side-by-side showdown. Which stock wins on every single metric?</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('cmp',1,this)">&#9650; Want it <span class="cnt" id="cmp-up">0</span></button><button class="pvbtn dn" onclick="vote('cmp',-1,this)">&#9660; Skip <span class="cnt" id="cmp-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="cmp-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#128172;</div><div class="pfinfo"><div class="pfname">WhatsApp &amp; Email Share <span class="ftag new">New</span></div><div class="pfdesc">One tap to share your analysis with friends, family, or your broker.</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('share',1,this)">&#9650; Want it <span class="cnt" id="share-up">0</span></button><button class="pvbtn dn" onclick="vote('share',-1,this)">&#9660; Skip <span class="cnt" id="share-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="share-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#128200;</div><div class="pfinfo"><div class="pfname">Technical Indicators <span class="ftag pro">Pro</span></div><div class="pfdesc">RSI, MACD, Moving Averages &mdash; the tools serious traders use daily.</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('tech',1,this)">&#9650; Want it <span class="cnt" id="tech-up">0</span></button><button class="pvbtn dn" onclick="vote('tech',-1,this)">&#9660; Skip <span class="cnt" id="tech-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="tech-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#127919;</div><div class="pfinfo"><div class="pfname">Peer Comparison <span class="ftag new">New</span></div><div class="pfdesc">Auto-compare vs top 3 competitors in the same sector. Who really wins?</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('peer',1,this)">&#9650; Want it <span class="cnt" id="peer-up">0</span></button><button class="pvbtn dn" onclick="vote('peer',-1,this)">&#9660; Skip <span class="cnt" id="peer-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="peer-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#128197;</div><div class="pfinfo"><div class="pfname">Earnings Countdown <span class="ftag pro">Pro</span></div><div class="pfdesc">Next earnings date + analyst expectations. Never get blindsided again.</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('earn',1,this)">&#9650; Want it <span class="cnt" id="earn-up">0</span></button><button class="pvbtn dn" onclick="vote('earn',-1,this)">&#9660; Skip <span class="cnt" id="earn-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="earn-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#128100;</div><div class="pfinfo"><div class="pfname">Insider Activity <span class="ftag hot">Most Wanted</span></div><div class="pfdesc">Are executives buying or selling their own stock? Follow the smart money.</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('insider',1,this)">&#9650; Want it <span class="cnt" id="insider-up">0</span></button><button class="pvbtn dn" onclick="vote('insider',-1,this)">&#9660; Skip <span class="cnt" id="insider-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="insider-bar" style="width:0%"></div></div></div>

<div class="pfcard"><div class="pfrow"><div class="pficon">&#127763;</div><div class="pfinfo"><div class="pfname">Dark / Light Theme <span class="ftag new">New</span></div><div class="pfdesc">Switch between dark terminal mode and clean light mode instantly.</div></div></div>
<div class="pvbtns"><button class="pvbtn up" onclick="vote('theme',1,this)">&#9650; Want it <span class="cnt" id="theme-up">0</span></button><button class="pvbtn dn" onclick="vote('theme',-1,this)">&#9660; Skip <span class="cnt" id="theme-dn">0</span></button></div><div class="pvbar"><div class="vfill" id="theme-bar" style="width:0%"></div></div></div>

<!-- LIVE VOTE CHART -->
<div class="vgp">
<h4>&#128202; Live Community Votes</h4>
<div class="vsub">Real-time ranking &mdash; updated as you vote</div>
<div class="cc"><canvas id="voteChart"></canvas></div>
</div>

<div class="sendbox">
<button class="sendbtn" onclick="sendVoteResults()">&#9993; Send Results to Sentinel AI Team</button>
<p style="font-size:9px;color:var(--text3);margin-top:6px">Opens your email with vote summary &rarr; support@sentinelai.research</p>
</div>
</div>
</div>

</body>
</html>